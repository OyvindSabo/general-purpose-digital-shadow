
<meta charset="utf-8" />
<script>
const modules = {}
const include = path => modules[path];

modules['src/libraries/observable/Observable.js'] = (() => {
  const module = { exports: {} };
  class Observable {
  constructor(value) {
    // Maybe this can cause an id collision of two observables created almost at the same time
    this._id = `${Math.random()}${+new Date()}`;
    this._value = value;
  }
  emit() {
    window.dispatchEvent(
      new CustomEvent(this._id, {
        detail: this._value,
      })
    );
  }
  get id() {
    return this._id;
  }
  get value() {
    return this._value;
  }
  set value(value) {
    // Maybe this should do a deep compare in case value is an object?
    if (value === this._value) return;
    this._value = value;
    this.emit();
  }
}

module.exports = Observable;

  return module.exports;
})();

modules['src/libraries/router/Router.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

function Router(routes) {
  /**
   * @param {string} routes
   */
  this.setRoutes = function(routes) {
    Object.entries(routes).forEach(([route, title]) => {
      this.routes[route] = route;
      this.titles[route] = title;
      if (route === '/') {
        this.routes[''] = route;
        this.titles[''] = title;
      }
    });
    this.syncWithHash();
  };
  Router.getTokens = function(hash) {
    return hash
      .split('/')
      .filter(Boolean)
      .filter(element => element !== '#')
      .filter(element => element !== '#!');
  };
  /**
   * @param {string} token
   * @returns {boolean}
   */
  Router.isParameterRouteToken = function(token) {
    if (
      token.indexOf('<') !== 0 ||
      !token.slice(2, -4).includes(':') ||
      token.indexOf('>') !== token.length - 1
    ) {
      return false;
    }
    const [parameter, type] = token
      .slice(token.indexOf('<') + 1, token.indexOf('>'))
      .split(':');

    if (!['int', 'string', 'number'].includes(type)) {
      return false;
    }
    return true;
  };
  Router.appendTokenToHash = function(hash, token) {
    return `${hash}/${token}`;
  };
  Router.parseParameterRouteToken = function(token) {
    const [parameter, type] = token
      .slice(token.indexOf('<') + 1, token.indexOf('>'))
      .split(':');
    return {
      parameter,
      type,
    };
  };
  // (hash: string, route: string) => false | { [key: string]: number | string }
  Router.getMatch = function(hash, route) {
    const hashTokens = Router.getTokens(hash);
    const routeTokens = Router.getTokens(route);
    const params = {};
    let reconstructedHash = '#!';
    if (hashTokens.length !== routeTokens.length) return false;
    for (let i of Object.keys(hashTokens)) {
      const hashToken = hashTokens[i];
      const routeToken = routeTokens[i];
      if (Router.isParameterRouteToken(routeToken)) {
        const { parameter, type } = Router.parseParameterRouteToken(routeToken);
        if (type === 'int') {
          if (!Router.isInt(hashToken)) return false;
          params[parameter] = parseInt(hashToken);
          reconstructedHash = Router.appendTokenToHash(
            reconstructedHash,
            hashToken
          );
        } else if (type === 'number' && !Router.isNumber(hasToken)) {
          if (!Router.isNumber(hashToken)) return false;
          params[parameter] = Number(hashToken);
          reconstructedHash = Router.appendTokenToHash(
            reconstructedHash,
            hashToken
          );
        } else if (type === 'string') {
          params[parameter] = hashToken;
          reconstructedHash = Router.appendTokenToHash(
            reconstructedHash,
            hashToken
          );
        }
      } else {
        if (hashToken !== routeToken) return false;
        reconstructedHash = Router.appendTokenToHash(
          reconstructedHash,
          hashToken
        );
      }
    }
    return { params, reconstructedHash };
  };
  Router.getRouteAndParamsFromHash = function(hash, routes) {
    for (let route of Object.keys(routes)) {
      const match = Router.getMatch(hash, route);
      if (match) {
        const { params, reconstructedHash } = match;
        return { route, params, reconstructedHash };
      }
    }
    return { route: '', params: {}, reconstructedHash: '' };
  };
  /**
   * @param {Object.<string, number | string>} params
   */
  this.setParams = function(params) {
    this.params = params;
    // Todo: Maybe dispatch some kind of event
  };
  this.setCurrentRoute = function(route) {
    this.currentRoute$.value = route;
  };
  this.setCurrentTitle = function(title) {
    this.currentTitle = title;
  };
  Router.removeHash = function() {
    return history.replaceState(null, null, ' ');
  };
  // Rather than passing data, this one should pass a string saying which attribute has been updated
  this.emit = function() {
    this.observers.forEach(observer => {
      if (!observer)
        console.warn('Non-existing element registered as router observer');

      observer({ currentRoute$: this.currentRoute$, params: this.params });
    });
  };
  this.syncWithHash = function() {
    const { hash } = location;
    const {
      route,
      params,
      reconstructedHash,
    } = Router.getRouteAndParamsFromHash(hash, this.routes);
    this.setParams(params);
    this.setCurrentRoute(this.routes[route]);
    this.setCurrentTitle(this.titles[route]);
    if (reconstructedHash === '#!') {
      Router.removeHash();
    } else {
      history.replaceState(undefined, undefined, reconstructedHash);
    }
    document.title = this.currentTitle;
    this.emit();
  };
  this.params = {};
  this.currentRoute$ = new Observable('');
  this.routes = {};
  this.titles = {};
  this.observers = [];
  this.hashChangeListeners = [];
  this.setRoutes(routes);
  window.addEventListener('hashchange', () => {
    this.syncWithHash();
    this.callHashChangeListeners();
  });
  /**
   * @param {string} route
   * One of the registered routes, without hashbang
   */
  this.navigateTo = route => {
    location.hash = `#!${route}`;
  };

  this.refresh = () => this.syncWithHash();

  // @possiblyNumber: string
  Router.isNumber = function(possiblyNumber) {
    return !isNaN(Number(possiblyNumber));
  };
  Router.isInt = function(possiblyInt) {
    return (
      Router.isNumber(possiblyInt) &&
      parseInt(possiblyInt) === Number(possiblyInt)
    );
  };
  this.onHashChange = callback => {
    this.hashChangeListeners.push(callback);
    this.callHashChangeListeners();
  };
  this.callHashChangeListeners = function() {
    this.hashChangeListeners.forEach(hashChangeListener =>
      hashChangeListener({
        params: this.params,
        currentRoute$: this.currentRoute$,
      })
    );
  };
  this.getParams = () => this.params;
  this.getCurrentTitle = () => this.currentTitle;
  Router.isProp = propsOrChild =>
    !(propsOrChild instanceof HTMLElement || typeof propsOrChild === 'string');

  /**
   * @param {function({ params: Object.<string, string | number> }): void} observer
   */
  this.subscribe = observer => {
    observer({
      currentRoute$: this.currentRoute$,
      params: this.params,
    });
    this.observers.push(observer);
  };
}

module.exports = Router;

  return module.exports;
})();

modules['src/data/Data.js'] = (() => {
  const module = { exports: {} };
  let projects = [
  {
    id: '0',
    name: 'Double wishbone suspension',
    derivedValuesCode: `derivedValues['Compression (cm)'] = Math.random() * 10;`,
    widgetsCode: `
/*******************************************************************************
DOUBLE WISHBONE SUSPENSION
*******************************************************************************/
    
const compression = derivedValues['Compression (cm)'];
widgets['Double Wisbone Suspension'] = {
  edges: [
    // Front frame
    { points: [[-25, 0, 0], [25, 0, 0]], color: 'black', width: 2 },
    { points: [[-25, 40, 0], [25, 40, 0]], color: 'black', width: 2 },
    { points: [[-25, 0, 0], [-25, 40, 0]], color: 'black', width: 2 },
    { points: [[25, 0, 0], [25, 40, 0]], color: 'black', width: 2 },
  
    // Rear frame
    { points: [[-25, 0, 275], [25, 0, 275]], color: 'black', width: 2 },
    { points: [[-25, 40, 275], [25, 40, 275]], color: 'black', width: 2 },
    { points: [[-25, 0, 275], [-25, 40, 275]], color: 'black', width: 2 },
    { points: [[25, 0, 275], [25, 40, 275]], color: 'black', width: 2 },
  
    // Bottom left frame rails
    { points: [[25, 0, 0], [25, 0, 25]], color: 'black', width: 2 },
    { points: [[25, 0, 25], [50, 0, 150]], color: 'black', width: 2 },
    { points: [[50, 0, 150], [50, 0, 225]], color: 'black', width: 2 },
    { points: [[50, 0, 225], [25, 0, 250]], color: 'black', width: 2 },
    { points: [[25, 0, 250], [25, 0, 275]], color: 'black', width: 2 },
  
    // Bottom right frame rails
    { points: [[-25, 0, 0], [-25, 0, 25]], color: 'black', width: 2 },
    { points: [[-25, 0, 25], [-50, 0, 150]], color: 'black', width: 2 },
    { points: [[-50, 0, 150], [-50, 0, 225]], color: 'black', width: 2 },
    { points: [[-50, 0, 225], [-25, 0, 250]], color: 'black', width: 2 },
    { points: [[-25, 0, 250], [-25, 0, 275]], color: 'black', width: 2 },
  
    // Top left frame rails
    { points: [[25, 40, 0], [25, 40, 25]], color: 'black', width: 2 },
    { points: [[25, 40, 25], [50, 40, 150]], color: 'black', width: 2 },
    { points: [[50, 40, 150], [50, 40, 225]], color: 'black', width: 2 },
    { points: [[50, 40, 225], [25, 40, 250]], color: 'black', width: 2 },
    { points: [[25, 40, 250], [25, 40, 275]], color: 'black', width: 2 },
  
    // Top right frame rails
    { points: [[-25, 40, 0], [-25, 40, 25]], color: 'black', width: 2 },
    { points: [[-25, 40, 25], [-50, 40, 150]], color: 'black', width: 2 },
    { points: [[-50, 40, 150], [-50, 40, 225]], color: 'black', width: 2 },
    { points: [[-50, 40, 225], [-25, 40, 250]], color: 'black', width: 2 },
    { points: [[-25, 40, 250], [-25, 40, 275]], color: 'black', width: 2 },
  
    // Left diagonal struts
    { points: [[25, 40, 25], [25, 0, 25]], color: 'black', width: 2 },
    { points: [[25, 0, 25], [50, 40, 150]], color: 'black', width: 2 },
    { points: [[50, 40, 150], [50, 0, 150]], color: 'black', width: 2 },
    { points: [[50, 0, 150], [50, 40, 225]], color: 'black', width: 2 },
    { points: [[50, 0, 225], [25, 40, 250]], color: 'black', width: 2 },
    { points: [[25, 0, 250], [25, 40, 275]], color: 'black', width: 2 },
  
    // Right diagonal struts
    { points: [[-25, 40, 25], [-25, 0, 25]], color: 'black', width: 2 },
    { points: [[-25, 0, 25], [-50, 40, 150]], color: 'black', width: 2 },
    { points: [[-50, 40, 150], [-50, 0, 150]], color: 'black', width: 2 },
    { points: [[-50, 0, 150], [-50, 40, 225]], color: 'black', width: 2 },
    { points: [[-50, 0, 225], [-25, 40, 250]], color: 'black', width: 2 },
    { points: [[-25, 0, 250], [-25, 40, 275]], color: 'black', width: 2 },
  
    // Top
    { points: [[50, 40, 225], [50, 60, 250]], color: 'black', width: 2 },
    { points: [[50, 60, 250], [50, 60, 275]], color: 'black', width: 2 },
    { points: [[50, 60, 275], [25, 40, 275]], color: 'black', width: 2 },
    { points: [[50, 60, 250], [25, 40, 250]], color: 'black', width: 2 },
    { points: [[-25, 40, 25], [25, 40, 25]], color: 'black', width: 2 },
  
    { points: [[-50, 40, 225], [-50, 60, 250]], color: 'black', width: 2 },
    { points: [[-50, 60, 250], [-50, 60, 275]], color: 'black', width: 2 },
    { points: [[-50, 60, 275], [-25, 40, 275]], color: 'black', width: 2 },
    { points: [[-50, 60, 250], [-25, 40, 250]], color: 'black', width: 2 },
  
    { points: [[-50, 60, 250], [50, 60, 250]], color: 'black', width: 2 },
    { points: [[-50, 60, 275], [50, 60, 275]], color: 'black', width: 2 },
    { points: [[-25, 40, 250], [25, 40, 250]], color: 'black', width: 2 },
    { points: [[-50, 40, 150], [50, 40, 150]], color: 'black', width: 2 },
  
    // Bottom
    { points: [[-50, 0, 150], [50, 0, 150]], color: 'black', width: 2 },
    { points: [[-25, 0, 25], [25, 0, 25]], color: 'black', width: 2 },
        
    // Front left wishbones
    { points: [[25, 0, 0], [75, -5 + compression, 12.5]], color: 'black', width: 2 },
    { points: [[25, 0, 25], [75, -5 + compression, 12.5]], color: 'black', width: 2 },
    { points: [[25, 40, 0], [75, 35 + compression, 12.5]], color: 'black', width: 2 },
    { points: [[25, 40, 25], [75, 35 + compression, 12.5]], color: 'black', width: 2 },
  
    // Front right wishbones
    { points: [[-25, 0, 0], [-75, -5 + compression, 12.5]], color: 'black', width: 2 },
    { points: [[-25, 0, 25], [-75, -5 + compression, 12.5]], color: 'black', width: 2 },
    { points: [[-25, 40, 0], [-75, 35 + compression, 12.5]], color: 'black', width: 2 },
    { points: [[-25, 40, 25], [-75, 35 + compression, 12.5]], color: 'black', width: 2 },
  
    // Rear left wishbones
    { points: [[25, 0, 250], [75, -5 + compression, 262.5]], color: 'black', width: 2 },
    { points: [[25, 0, 275], [75, -5 + compression, 262.5]], color: 'black', width: 2 },
    { points: [[25, 40, 250], [75, 35 + compression, 262.5]], color: 'black', width: 2 },
    { points: [[25, 40, 275], [75, 35 + compression, 262.5]], color: 'black', width: 2 },
  
    // Rear right wishbones
    { points: [[-25, 0, 250], [-75, -5 + compression, 262.5]], color: 'black', width: 2 },
    { points: [[-25, 0, 275], [-75, -5 + compression, 262.5]], color: 'black', width: 2 },
    { points: [[-25, 40, 250], [-75, 35 + compression, 262.5]], color: 'black', width: 2 },
    { points: [[-25, 40, 275], [-75, 35 + compression, 262.5]], color: 'black', width: 2 },
  ],
  center: [0, 20, 125],
  is3d: true,
}
`,
  },
  {
    id: '1',
    name: '3D pyramid',
    derivedValuesCode: `
derivedValues['Pyramid Width (cm)' ] = 100 + Math.random() * 10;
derivedValues['Pyramid Height (cm)'] = 100 + Math.random() * 10;
derivedValues['Pyramid Depth (cm)' ] = 100 + Math.random() * 10;
`,
    widgetsCode: `
/*******************************************************************************
3D PYRAMID
*******************************************************************************/
   
const height = derivedValues['Pyramid Height (cm)'];
const width = derivedValues['Pyramid Width (cm)'];
const depth = derivedValues['Pyramid Depth (cm)'];
const profit = 100 + derivedValues.Profit;
  
const point0 = [    0,      0,     0];
const point1 = [    0,      0, depth];
const point2 = [    0, height,     0];
const point3 = [width,      0,     0];
  
const surfaceColor = 'rgba(128, 128, 255, 0.5)';
const edgeColor = 'blue';
  
// We create the faces
const surface0 = { color: surfaceColor, points: [point0, point1, point2] };
const surface1 = { color: surfaceColor, points: [point0, point1, point3] };
const surface2 = { color: surfaceColor, points: [point1, point2, point3] };
const surface3 = { color: surfaceColor, points: [point0, point2, point3] };
  
// We create the edges
const edge0 = { color: edgeColor, points: [point0, point1], width: 2 };
const edge1 = { color: edgeColor, points: [point0, point2], width: 2 };
const edge2 = { color: edgeColor, points: [point0, point3], width: 2 };
const edge3 = { color: edgeColor, points: [point1, point2], width: 2 };
const edge4 = { color: edgeColor, points: [point1, point3], width: 2 };
const edge5 = { color: edgeColor, points: [point2, point3], width: 2 };
  
// We create the widget
widgets.Pyramid = {
  surfaces: [surface0, surface1, surface2, surface3],
  edges: [edge0, edge1, edge2, edge3, edge4, edge5],
  is3d: true,
};
`,
  },
  {
    id: '2',
    name: 'Bar charts',
    derivedValuesCode: `derivedValues['Profit'] = values.sellPrice - values.buyPrice;`,
    widgetsCode: `
/*******************************************************************************
2D BAR CHART
*******************************************************************************/
const profit = 100 + derivedValues.Profit;
    
widgets['Bar Chart'] = {
  surfaces: [{
    color: \`rgba(0, 255, 0, 0.5)\`,
    points: [[ 0,      0, 0],
             [ 0, profit, 0],
             [10, profit, 0],
             [10,      0, 0]]
  },
  {
    color: \`rgba(0, 255, 0, 0.5)\`,
    points: [[20,      0, 0],
             [20, profit, 0],
             [30, profit, 0],
             [30,      0, 0]]
  }],
  center: [15, 50, 0],
}
  
/*******************************************************************************
3D BAR CHART
*******************************************************************************/
widgets['3D Bar Chart'] = {
  surfaces: [
    {
      color: 'black',
      points: [[ 0, 0,       0],
               [ 0, 0, profit],
               [10, 0, profit],
               [10, 0,      0 ]],
    },
    {
      color: 'black',
      points: [[20, 0,       0],
               [20, 0, profit],
               [30, 0, profit],
               [30, 0,      0 ]],
    },
    {
      color: \`rgba(0, 255, 0, 0.5)\`,
      points: [[ 0,      0, 0],
               [ 0, profit, 0],
               [10, profit, 0],
               [10,      0, 0]],
    },
    {
      color: \`rgba(0, 255, 0, 0.5)\`,
      points: [[20,      0, 0],
               [20, profit, 0],
               [30, profit, 0],
               [30,      0, 0]],
    },
  ],
  center: [15, 50, 0],
  is3d: true,
}
`,
  },
];

const getAllProjects = () => projects;

const getProjectById = (projectIdId) =>
  projects.find(({ id }) => id == projectId);

const createProject = (project) => {
  projects = [
    ...projects,
    {
      ...project,
      id: `${Math.random()}${+new Date()}`,
    },
  ];
};

const updateProjectById = (projectId, project) => {
  const projectIndex = projects.findIndex(({ id }) => id === projectId);
  if (projectIndex === -1) {
    console.warn('Tried to update nonexistent project');
    return;
  }
  Object.assign(projects[projectIndex], project);
};

const deleteProjectById = (projectId) => {
  projects = projects.filter(({ id }) => id !== projectId);
};

module.exports = {
  getAllProjects,
  getProjectById,
  createProject,
  updateProjectById,
  deleteProjectById,
};

  return module.exports;
})();

modules['src/model/Model.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const {
  getAllProjects,
  getProjectById,
  createProject,
  updateProjectById,
  deleteProjectById,
} = include('src/data/Data.js');

const MAX_AMOUNT_OF_PROJECTS = 100;
const MAX_AMOUNT_OF_VALUES = 100;
const MAX_AMOUNT_OF_DERIVED_VALUES = 100;
const MAX_AMOUNT_OF_WIDGETS = 100;

const evaluateCode = (valuesCode, derivedValuesCode, widgetsCode) => {
  return eval(`
    const values = {};
    const derivedValues = {};
    const widgets = {};
    ${valuesCode}
    ${derivedValuesCode}
    ${widgetsCode}
    result = {
      values,
      derivedValues,
      widgets,
    };
  `);
};

const buyPrice$ = new Observable(100);
const sellPrice$ = new Observable(100);

const Model = ({ router }) => {
  const model = {
    // All values
    projects: [...new Array(MAX_AMOUNT_OF_PROJECTS).keys()].map(() => ({
      id$: new Observable(''),
      name$: new Observable(''),
      nameInputValue$: new Observable(''),
      isEditing$: new Observable(false),
      isEmpty$: new Observable(true),
      derivedValuesCode$: new Observable(''),
      widgetsCode$: new Observable(''),
    })),

    // Selected values
    selectedProjectId$: new Observable(null),
    selectedProjectName$: new Observable(null),

    lastVisitedProjectView$: new Observable(null),

    derivedValuesEditorIsOpen$: new Observable(false),

    valuesCode$: new Observable(''),
    derivedValuesCode$: new Observable(''),
    widgetsCode$: new Observable(''),

    values: [...new Array(MAX_AMOUNT_OF_VALUES).keys()].map(() => ({
      label$: new Observable(''),
      value$: new Observable(0),
      isEmpty$: new Observable(true),
    })),
    derivedValues: [...new Array(MAX_AMOUNT_OF_DERIVED_VALUES).keys()].map(
      () => ({
        label$: new Observable(''),
        value$: new Observable(0),
        isEmpty$: new Observable(true),
      })
    ),
    widgets: [...new Array(MAX_AMOUNT_OF_WIDGETS).keys()].map(() => ({
      label$: new Observable(''),
      edges$: new Observable([]),
      surfaces$: new Observable([]),
      center$: new Observable([0, 0, 0]),
      isEmpty$: new Observable(true),
      is3d$: new Observable(false),
    })),
  };

  model.loadAllProjects = () => {
    for (let i = 0; i < MAX_AMOUNT_OF_PROJECTS; i++) {
      model.projects[i].id$.value = '';
      model.projects[i].name$.value = '';
      model.projects[i].nameInputValue$.value = '';
      model.projects[i].isEditing$.value = false;
      model.projects[i].isEmpty$.value = true;
      model.projects[i].derivedValuesCode$.value = '';
      model.projects[i].widgetsCode$.value = '';
    }
    getAllProjects().forEach(
      ({ id, name, derivedValuesCode, widgetsCode }, index) => {
        model.projects[index].id$.value = id;
        model.projects[index].name$.value = name;
        model.projects[index].nameInputValue$.value = name;
        model.projects[index].isEmpty$.value = false;
        model.projects[index].derivedValuesCode$.value = derivedValuesCode;
        model.projects[index].widgetsCode$.value = widgetsCode;
      }
    );
    const selectedProject = model.projects.find(
      ({ id$ }) => id$.value === model.selectedProjectId$.value
    );
    if (!selectedProject) {
      model.selectedProjectId$.value = null;
      model.selectedProjectName$.value = null;
      return;
    }
    model.selectedProjectName$.value = selectedProject.name$.value;
  };
  model.loadAllProjects();

  model.createNewProject = () => {
    createProject({
      name: 'Untitled project',
      derivedValuesCode: '',
      widgetsCode: '',
    });
    model.loadAllProjects();
  };

  model.setProjectNameInputValue = (projectId, inputValue) => {
    const project = model.projects.find(({ id$ }) => id$.value === projectId);
    if (!project) {
      console.warn(
        'Tried to update project name input value of nonexistent project.'
      );
    }
    project.nameInputValue$.value = inputValue;
  };

  model.editProjectName = (projectId) => {
    const project = model.projects.find(({ id$ }) => id$.value === projectId);
    if (!project) {
      console.warn(
        'Tried to cancel editing the name input value of nonexistent project.'
      );
    }
    project.isEditing$.value = true;
  };

  model.cancelEditingProjectName = (projectId) => {
    const project = model.projects.find(({ id$ }) => id$.value === projectId);
    if (!project) {
      console.warn(
        'Tried to cancel editing the name input value of nonexistent project.'
      );
    }
    project.nameInputValue$.value = project.name$.value;
    project.isEditing$.value = false;
  };

  model.saveProjectName = (projectId) => {
    const project = model.projects.find(({ id$ }) => id$.value === projectId);
    updateProjectById(projectId, { name: project.nameInputValue$.value });
    model.loadAllProjects();
  };

  model.deleteProject = (projectId) => {
    deleteProjectById(projectId);
    model.loadAllProjects();
  };

  window.addEventListener(model.valuesCode$.id, () => {
    const evaluatedCode = evaluateCode(
      model.valuesCode$.value,
      model.derivedValuesCode$.value,
      model.widgetsCode$.value
    );

    const valuesEntries = Object.entries(evaluatedCode.values);
    model.values.forEach(({ label$, value$, isEmpty$ }, index) => {
      label$.value = valuesEntries[index] ? valuesEntries[index][0] : '';
      value$.value = valuesEntries[index] ? valuesEntries[index][1] : 0;
      isEmpty$.value = !Boolean(valuesEntries[index]);
    });

    const derivedValuesEntries = Object.entries(evaluatedCode.derivedValues);
    model.derivedValues.forEach(({ label$, value$, isEmpty$ }, index) => {
      label$.value = derivedValuesEntries[index]
        ? derivedValuesEntries[index][0]
        : '';
      value$.value = derivedValuesEntries[index]
        ? derivedValuesEntries[index][1]
        : 0;
      isEmpty$.value = !derivedValuesEntries[index];
    });

    const widgetsEntries = Object.entries(evaluatedCode.widgets);
    model.widgets.forEach(
      ({ label$, edges$, surfaces$, is3d$, center$, isEmpty$ }, index) => {
        label$.value = widgetsEntries[index] ? widgetsEntries[index][0] : '';
        edges$.value = widgetsEntries[index]
          ? widgetsEntries[index][1].edges || []
          : [];
        surfaces$.value = widgetsEntries[index]
          ? widgetsEntries[index][1].surfaces || []
          : [];
        center$.value = widgetsEntries[index]
          ? widgetsEntries[index][1].center || [0, 0, 0]
          : [0, 0, 0]; // TODO
        is3d$.value = widgetsEntries[index]
          ? widgetsEntries[index][1].is3d || false
          : false; // TODO
        isEmpty$.value = !widgetsEntries[index];
      }
    );
  });

  // We can pretend we are fetching data from an api here
  const updateValues = () => {
    setTimeout(() => {
      buyPrice$.value =
        Math.floor(Math.random() * 2) == 1
          ? buyPrice$.value * 1.01
          : buyPrice$.value / 1.01;
      sellPrice$.value =
        Math.floor(Math.random() * 2) == 1
          ? sellPrice$.value * 1.01
          : sellPrice$.value / 1.01;
      model.valuesCode$.value = `
          values.buyPrice = ${buyPrice$.value};
          values.sellPrice = ${sellPrice$.value};
          `;
      updateValues();
    }, 100);
  };
  updateValues();

  const syncSelectedProjectWithRouter = ({ params, currentRoute$ }) => {
    if (currentRoute$.value.indexOf('/projects/<projectId:string>') === 0) {
      const selectedProject = model.projects.find(
        ({ id$ }) => id$.value === params.projectId
      );
      model.selectedProjectId$.value = selectedProject.id$.value;
      model.selectedProjectName$.value = selectedProject.name$.value;
      model.derivedValuesCode$.value = selectedProject.derivedValuesCode$.value;
      model.widgetsCode$.value = selectedProject.widgetsCode$.value;
      if (
        currentRoute$.value.indexOf(
          '/projects/<projectId:string>/data-sources'
        ) === 0
      ) {
        model.lastVisitedProjectView$.value = 'data-sources';
      }
      if (
        currentRoute$.value.indexOf('/projects/<projectId:string>/values') === 0
      ) {
        model.lastVisitedProjectView$.value = 'values';
      }
      if (
        currentRoute$.value.indexOf(
          '/projects/<projectId:string>/dashboards'
        ) === 0
      ) {
        model.lastVisitedProjectView$.value = 'dashboards';
      }
    }
  };
  syncSelectedProjectWithRouter(router);
  router.onHashChange(syncSelectedProjectWithRouter);

  return model;
};
module.exports = Model;

  return module.exports;
})();

modules['src/libraries/observable/utils.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

const valueOf$ = observable$ =>
  observable$ instanceof Observable ? observable$.value : observable$;

const isObservable$ = observable$ => observable$ instanceof Observable;

// Currently needs at least two arguments
const add$ = (...observables) => {
  const sum = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a + b);
  const sum$ = new Observable(sum);
  observables
    .filter(observable => observable instanceof Observable)
    .forEach(observable => {
      window.addEventListener(observable.id, ({ detail }) => {
        const sum = observables
          .map(observable =>
            observable instanceof Observable ? observable.value : observable
          )
          .reduce((a, b) => a + b);
        sum$.value = sum;
      });
    });
  return sum$;
};

// Currently needs at least two arguments
const subtract$ = (...observables) => {
  const difference = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a - b);
  const difference$ = new Observable(difference);
  observables.forEach(observable => {
    window.addEventListener(observable.id, ({ detail }) => {
      const difference = observables
        .map(observable =>
          observable instanceof Observable ? observable.value : observable
        )
        .reduce((a, b) => a - b);
      difference$.value = difference;
    });
  });
  return difference$;
};

// Currently needs at least two arguments
const multiply$ = (...observables) => {
  const product = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a * b);
  const product$ = new Observable(product);
  observables.forEach(observable => {
    window.addEventListener(observable.id, ({ detail }) => {
      const product = observables
        .map(observable =>
          observable instanceof Observable ? observable.value : observable
        )
        .reduce((a, b) => a * b);
      product$.value = product;
    });
  });
  return product$;
};

// Currently needs at least two arguments
const divide$ = (...observables) => {
  const quotient = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a / b);
  const quotient$ = new Observable(quotient);
  observables.forEach(observable => {
    window.addEventListener(observable.id, ({ detail }) => {
      const quotient = observables
        .map(observable =>
          observable instanceof Observable ? observable.value : observable
        )
        .reduce((a, b) => a / b);
      quotient$.value = quotient;
    });
  });
  return quotient$;
};

const choose$ = (observable, option1, option2) => {
  const result$ = new Observable(
    (observable instanceof Observable
    ? observable.value
    : observable)
      ? option1 instanceof Observable
        ? option1.value
        : option1
      : option2 instanceof Observable
      ? option2.value
      : option2
  );
  [observable, option1, option2]
    .filter(observable => observable instanceof Observable)
    .forEach(observable => {
      window.addEventListener(observable.id, ({ detail }) => {
        // TODO: Make it possible to set a specific child of an observable
        result$.value = (observable instanceof Observable
        ? observable.value
        : observable)
          ? option1 instanceof Observable
            ? option1.value
            : option1
          : option2 instanceof Observable
          ? option2.value
          : option2;
      });
    });
  return result$;
};

const cond$ = (...clauses) => {
  const result = clauses
    .map(([test, expression]) => [
      test instanceof Observable ? test.value : test,
      expression instanceof Observable ? expression.value : expression,
    ])
    .reduce((result, [test, expression]) => {
      if (result !== null) return result;
      if (test) return expression;
      return null;
    }, null);

  const result$ = new Observable(result);

  clauses
    .flat()
    .filter(testOrExpression => testOrExpression instanceof Observable)
    .forEach(testOrExpression => {
      window.addEventListener(testOrExpression.id, ({ detail }) => {
        const result = clauses
          .map(([test, expression]) => [
            test instanceof Observable ? test.value : test,
            expression instanceof Observable ? expression.value : expression,
          ])
          .reduce((result, [test, expression]) => {
            if (result !== null) return result;
            if (test) return expression;
            return null;
          }, null);
        result$.value = result;
      });
    });

  return result$;
};

const eq$ = (...observables) => {
  const equality = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .every((element, _, array) => element === array[0]);
  const equality$ = new Observable(equality);
  observables.forEach(observable => {
    window.addEventListener(observable.id, ({ detail }) => {
      const equality = observables
        .map(observable =>
          observable instanceof Observable ? observable.value : observable
        )
        .every((element, _, array) => element === array[0]);
      equality$.value = equality;
    });
  });
  return equality$;
};

const and$ = (...observables) => {
  const allTruthy = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .every(Boolean);
  const allTruthy$ = new Observable(allTruthy);
  observables.forEach(observable => {
    window.addEventListener(observable.id, ({ detail }) => {
      const allTruthy = observables
        .map(observable =>
          observable instanceof Observable ? observable.value : observable
        )
        .every(Boolean);
      allTruthy$.value = allTruthy;
    });
  });
  return allTruthy$;
};

const or$ = (...observables) => {
  const someTruthy = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .some(Boolean);
  const someTruthy$ = new Observable(someTruthy);
  observables
    .filter(observable => observable instanceof Observable)
    .forEach(observable => {
      window.addEventListener(observable.id, ({ detail }) => {
        const someTruthy = observables
          .map(observable =>
            observable instanceof Observable ? observable.value : observable
          )
          .some(Boolean);
        someTruthy$.value = someTruthy;
      });
    });
  return someTruthy$;
};

const not$ = observable => {
  const conditional =
    observable instanceof Observable ? observable.value : observable;
  const opposite$ = new Observable(!conditional);
  if (observable instanceof Observable) {
    window.addEventListener(observable.id, ({ detail }) => {
      opposite$.value = !detail;
    });
  }
  return opposite$;
};

const toFixed$ = (number$, decimals$) => {
  const number = number$ instanceof Observable ? number$.value : number$;
  const decimals =
    decimals$ instanceof Observable ? decimals$.value : decimals$;
  const formattedNumber = number.toFixed(decimals);
  const formattedNumber$ = new Observable(formattedNumber);
  [number$, decimals$]
    .filter(observable => observable instanceof Observable)
    .forEach(observable => {
      window.addEventListener(observable.id, ({ detail }) => {
        const number = number$ instanceof Observable ? number$.value : number$;
        const decimals =
          decimals$ instanceof Observable ? decimals$.value : decimals$;
        const formattedNumber = number.toFixed(decimals);
        formattedNumber$.value = formattedNumber;
      });
    });
  return formattedNumber$;
};

const slice$ = (stringOrArray$, start$, stop$) => {
  const stringOrArray =
    stringOrArray$ instanceof Observable
      ? stringOrArray$.value
      : stringOrArray$;
  const start = start$ instanceof Observable ? start$.value : start$;
  const stop = stop$ instanceof Observable ? stop$.value : stop$;
  const slicedStringOrArray$ = new Observable(stringOrArray.slice(start, stop));
  [stringOrArray$, start$, stop$]
    .filter(observable => observable instanceof Observable)
    .forEach(observable => {
      window.addEventListener(observable.id, ({ detail }) => {
        const stringOrArray =
          stringOrArray$ instanceof Observable
            ? stringOrArray$.value
            : stringOrArray$;
        const start = start$ instanceof Observable ? start$.value : start$;
        const stop = stop$ instanceof Observable ? stop$.value : stop$;
        slicedStringOrArray$.value = stringOrArray.slice(start, stop);
      });
    });
  return slicedStringOrArray$;
};

const length$ = stringOrArray$ => {
  const length$ = new Observable(valueOf$(stringOrArray$).length);
  if (isObservable$(stringOrArray$)) {
    window.addEventListener(stringOrArray$.id, () => {
      lenth$.value = valueOf$(stringOrArray$).length;
    });
  }
  return length$;
};

const map$ = (array$, function$) => {
  const mappedArray$ = new Observable(
    valueOf$(array$).map(valueOf$(function$))
  );

  [array$, function$].filter(isObservable$).forEach(observable => {
    window.addEventListener(observable.id, () => {
      mappedArray$.value = valueOf$(array$).map(valueOf$(function$));
    });
  });

  return mappedArray$;
};

const startsWith$ = (includingString$, includedString$) => {
  const includingString =
    includingString$ instanceof Observable
      ? includingString$.value
      : includingString$;

  const includedString =
    includedString$ instanceof Observable
      ? includedString$.value
      : includedString$;

  const includingStringIncludesIncludedString =
    includingString.indexOf(includedString) === 0;

  const includingStringIncludesIncludedString$ = new Observable(
    includingStringIncludesIncludedString
  );

  [includingString$, includedString$]
    .filter(string => string instanceof Observable)
    .forEach(string => {
      window.addEventListener(string.id, ({ detail }) => {
        const includingString =
          includingString$ instanceof Observable
            ? includingString$.value
            : includingString$;

        const includedString =
          includedString$ instanceof Observable
            ? includedString$.value
            : includedString$;

        const includingStringIncludesIncludedString =
          includingString.indexOf(includedString) === 0;

        includingStringIncludesIncludedString$.value = includingStringIncludesIncludedString;
      });
    });
  return includingStringIncludesIncludedString$;
};

module.exports = {
  valueOf$,
  isObservable$,
  add$,
  subtract$,
  multiply$,
  divide$,
  choose$,
  cond$,
  eq$,
  and$,
  or$,
  not$,
  toFixed$,
  slice$,
  length$,
  map$,
  startsWith$,
};

  return module.exports;
})();

modules['src/libraries/observableHtml/ObservableHtml.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

const observableToNode$ = observable$ => {
  if (
    // If it is observable value
    observable$ instanceof Observable
  ) {
    if (['string', 'number'].includes(typeof observable$.value)) {
      const textElement = document.createElement('span');
      const textNode = document.createTextNode(observable$.value);
      textElement.appendChild(textNode);
      textElement.classList.add(observable$.id);
      window.addEventListener(observable$.id, ({ detail }) => {
        textElement.innerHTML = '';
        textElement.appendChild(document.createTextNode(detail));
      });
      return textElement;
    }
    if (Array.isArray(observable$.value)) {
      const elements = observable$.value.map(observableToNode$).flat();
      elements.forEach((element, index) => {
        element.classList.add(`${observable$.id}${index}`);
        window.addEventListener(observable$.id, ({ detail }) => {
          // Remove all the existing elements except the first
          let insertionPositions = [];
          for (let index = 0; index < 100; index++) {
            Array.from(
              document.getElementsByClassName(`${observable$.id}${index}`)
            ).forEach((elementToReplace, i) => {
              const insertionParent = elementToReplace.parentNode;
              const insertionIndex = Array.from(
                elementToReplace.parentNode.children
              ).indexOf(elementToReplace);
              insertionPositions.push({
                parent: insertionParent,
                insertionIndex: insertionIndex,
              });
              elementToReplace.parentNode.removeChild(elementToReplace);
            });
          }

          // For each of the first existing elements
          insertionPositions.forEach(({ parent, insertionIndex }, index) => {
            // Create a fragment and add all the elements inside it
            const fragment = document.createDocumentFragment();
            observable$.value.forEach((arrayElement, index) => {
              // I might need to have another level of loop here in case observableToNode$ returns more than one node
              const node = observableToNode$(arrayElement);
              node.classList.add(`${observable$.id}${index}`);
              fragment.appendChild(node);
            });
            // Repalact the first elemet with the fragments containing the new elements
            parent.insertBefore(fragment, parent.children[insertionIndex]);
          });
        });
      });
      return elements;
    }
  }
  if (
    // If it is non-observable value
    ['string', 'number'].includes(typeof observable$)
  ) {
    const textNode = document.createTextNode(observable$);
    return textNode;
  }
  // If it is a dom node
  return observable$;
};

const createElement$ = (elementType, ...observables) => {
  const element = document.createElement(elementType);
  const nodes = observables.map(observableToNode$).flat();
  nodes.forEach(node => element.appendChild(node));

  // Note that styleObject$ is an object with observable values, not an observable object
  element.setStyle = styleObject$ => {
    Object.entries(styleObject$).forEach(([styleProperty, styleValue$]) => {
      if (styleValue$ instanceof Observable) {
        element.style[styleProperty] = styleValue$.value;
        window.addEventListener(styleValue$.id, ({ detail }) => {
          element.style[styleProperty] = detail;
        });
        return;
      }
      element.style[styleProperty] = styleValue$;
    });
    return element;
  };
  element.setProps = propsObject => {
    Object.entries(propsObject).forEach(([propKey, propValue$]) => {
      if (propValue$ instanceof Observable) {
        element[propKey] = propValue$.value;
        window.addEventListener(propValue$.id, ({ detail }) => {
          element[propKey] = detail;
        });
        return;
      }
      element[propKey] = propValue$;
    });
    return element;
  };
  element.onClick = clickCallback => {
    element.style.cursor = 'pointer';
    element.onclick = () => clickCallback(element);
    return element;
  };
  element.onMouseEnter = mouseEnterCallback => {
    element.onmouseenter = () => mouseEnterCallback(element);
    return element;
  };
  element.onMouseLeave = mouseLeaveCallback => {
    element.onmouseleave = () => mouseLeaveCallback(element);
    return element;
  };
  element.onInput = inputCallback => {
    element.oninput = () => inputCallback(element);
    return element;
  };
  element.onChange = changeCallback => {
    element.onchange = () => changeCallback(element);
    return element;
  };
  return element;
};
const div$ = (...children) => createElement$('div', ...children);
const span$ = (...children) => createElement$('span', ...children);
const h1$ = (...children) => createElement$('h1', ...children);
const textArea$ = (value = '') =>
  createElement$('textarea').setProps({ value });
const br$ = () => createElement('br');
const select$ = (...children) => createElement$('select', ...children);
const button$ = (...children) => createElement$('button', ...children);
const option$ = ({ value, label }) =>
  createElement$('option', label).setProps({ value });
const input$ = (value = '') => createElement$('input').setProps({ value });
const canvas$ = ({ width$, height$ }) =>
  createElement$('canvas').setProps({
    width: width$,
    height: height$,
  });

module.exports = {
  createElement$,
  div$,
  span$,
  h1$,
  textArea$,
  br$,
  select$,
  button$,
  option$,
  input$,
  canvas$,
};

  return module.exports;
})();

modules['src/views/dataSources/DataSources.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const DataSourcesView$ = () => div$('DataSourcesView');

module.exports = DataSourcesView$;

  return module.exports;
})();

modules['src/libraries/styled/styled.js'] = (() => {
  const module = { exports: {} };
  const styled = style => Component => (...children) =>
  Component(...children).setStyle(style);

module.exports = styled;

  return module.exports;
})();

modules['src/libraries/observableHtml/utils.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const { valueOf$ } = include('src/libraries/observable/utils.js');
const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const Choose$ = (observable, element1, element2) => {
  let element = valueOf$(observable) ? element1 : element2;
  if (observable instanceof Observable) {
    window.addEventListener(observable.id, ({ detail }) => {
      // TODO: Make it possible to set a specific child of an observable
      newElement = valueOf$(observable) ? element1 : element2;

      if (newElement !== element) {
        element.parentNode.replaceChild(newElement, element);
        element = newElement;
      }
    });
  }
  return element;
};

const Switch$ = (statement$, ...clauses) => {
  const cases = clauses.filter((_, i) => i % 2 === 0);
  const elements = clauses.filter((_, i) => i % 2 !== 0);
  return div$(
    ...cases.map((theCase, i) => {
      const element = elements[i];
      // Warning: Assumes that display is not initially dynamic
      const display = element.style.display;
      return element.setStyle({
        display: choose$(eq$(statement$, theCase), display, 'none'),
      });
    })
  );
};

const Nothing$ = styled({ display: 'none' })(div$);

const If$ = (observable, element) => Choose$(observable, element, Nothing$());

module.exports = {
  Choose$,
  Switch$,
  Nothing$,
  If$,
};

  return module.exports;
})();

modules['src/components/horizontalNavigator/HorizontalNavigator.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const HorizontalNavigator$ = styled({ height: '64px' })(div$);

module.exports = HorizontalNavigator$;

  return module.exports;
})();

modules['src/app/appContainer/AppContainer.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const AppContainer$ = styled({
  height: 'calc(100% - 64px)',
  position: 'absolute',
  left: '0',
  right: '0',
})(div$);

module.exports = AppContainer$;

  return module.exports;
})();

modules['src/app/appContentContainer/AppContentContainer.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const AppContentContainer$ = styled({
  position: 'absolute',
  top: '0',
  left: '64px',
  right: '0',
  bottom: '0',
})(div$);

module.exports = AppContentContainer$;

  return module.exports;
})();

modules['src/views/project/projectContainer/ProjectContainer.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const ProjectContainer$ = styled({
  height: 'calc(100% - 64px)',
  position: 'absolute',
  left: '0',
  right: '0',
})(div$);

module.exports = ProjectContainer$;

  return module.exports;
})();

modules['src/components/horizontalNavigatorButton/HorizontalNavigatorButton.js'] = (() => {
  const module = { exports: {} };
  const { add$, choose$ } = include('src/libraries/observable/utils.js');

const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const HorizontalNavigatorButton$ = ({
  label,
  route$,
  isActive$,
  labelColor$,
  highlightLabelColor$,
}) => {
  return div$(label)
    .setStyle({
      height: '64px',
      width: '192px',
      display: 'inline-block',
      textAlign: 'center',
      lineHeight: '64px',
      boxSizing: 'border-box',
      borderBottom: choose$(isActive$, '2px solid deepskyblue', 'none'),
      color: choose$(isActive$, highlightLabelColor$, labelColor$),
      userSelect: 'none',
    })
    .onMouseEnter(element => {
      element.setStyle({
        color: highlightLabelColor$,
      });
    })
    .onMouseLeave(element => {
      element.setStyle({
        borderBottom: choose$(isActive$, '2px solid deepskyblue', 'none'),
        color: choose$(isActive$, highlightLabelColor$, labelColor$),
      });
    })
    .onClick(() => (location.hash = add$('#!', route$).value));
};

module.exports = HorizontalNavigatorButton$;

  return module.exports;
})();

modules['src/app/utils.js'] = (() => {
  const module = { exports: {} };
  const { cond$, eq$ } = include('src/libraries/observable/utils.js');

const getViewTitle$ = currentRoute$ =>
  cond$(
    [eq$(currentRoute$, '/'), 'Projects'],
    [eq$(currentRoute$, '/projects/<projectId:string>'), 'Data sources'],
    [
      eq$(currentRoute$, '/projects/<projectId:string>/data-sources'),
      'Data sources',
    ],
    [eq$(currentRoute$, '/projects/<projectId:string>/values'), 'Values'],
    [
      eq$(currentRoute$, '/projects/<projectId:string>/values/edit'),
      'Edit values',
    ],
    [
      eq$(currentRoute$, '/projects/<projectId:string>/dashboards'),
      'Dashboards',
    ],
    [
      eq$(currentRoute$, '/projects/<projectId:string>/dashboards/edit'),
      'Edit dashboards',
    ]
  );

module.exports = {
  getViewTitle$,
};

  return module.exports;
})();

modules['src/views/project/projectNavigator/ProjectNavigator.js'] = (() => {
  const module = { exports: {} };
  const HorizontalNavigatorButton$ = include(
  'src/components/horizontalNavigatorButton/HorizontalNavigatorButton.js'
);
const HorizontalNavigator$ = include(
  'src/components/horizontalNavigator/HorizontalNavigator.js'
);
const { eq$, or$, startsWith$, add$ } = include(
  'src/libraries/observable/utils.js'
);
const { getViewTitle$ } = include('src/app/utils.js');

const ProjectNavigator$ = ({ currentRoute$, model }) =>
  HorizontalNavigator$(
    HorizontalNavigatorButton$({
      label: getViewTitle$('/projects/<projectId:string>/data-sources'),
      route$: add$('/projects/', model.selectedProjectId$, '/data-sources'),
      isActive$: or$(
        eq$(currentRoute$, '/projects/<projectId:string>'),
        eq$(currentRoute$, '/projects/<projectId:string>/data-sources')
      ),
      labelColor$: 'slategray',
      highlightLabelColor$: 'darkslategray',
    }),
    HorizontalNavigatorButton$({
      label: getViewTitle$('/projects/<projectId:string>/values'),
      route$: add$('/projects/', model.selectedProjectId$, '/values'),
      isActive$: startsWith$(
        currentRoute$,
        '/projects/<projectId:string>/values'
      ),
      labelColor$: 'slategray',
      highlightLabelColor$: 'darkslategray',
    }),
    HorizontalNavigatorButton$({
      label: getViewTitle$('/projects/<projectId:string>/dashboards'),
      route$: add$('/projects/', model.selectedProjectId$, '/dashboards'),
      isActive$: startsWith$(
        currentRoute$,
        '/projects/<projectId:string>/dashboards'
      ),
      labelColor$: 'slategray',
      highlightLabelColor$: 'darkslategray',
    })
  );

module.exports = ProjectNavigator$;

  return module.exports;
})();

modules['src/app/titleBar/atoms.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const ViewTitle$ = styled({
  fontSize: '32px',
  padding: '16px',
})(div$);

module.exports = { ViewTitle$ };

  return module.exports;
})();

modules['src/styleWrappers/withShadow.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');

const withShadow = styled({
  boxShadow: 'rgba(0, 0, 0, 0.25) 0px 0px 8px -4px',
});

module.exports = withShadow;

  return module.exports;
})();

modules['src/app/titleBar/TitleBar.js'] = (() => {
  const module = { exports: {} };
  const HorizontalNavigator$ = include(
  'src/components/horizontalNavigator/HorizontalNavigator.js'
);
const { ViewTitle$ } = include('src/app/titleBar/atoms.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { add$, startsWith$, choose$ } = include(
  'src/libraries/observable/utils.js'
);
const { span$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const TitleBar$ = ({ currentRoute$, model }) => {
  return withShadow(HorizontalNavigator$)(
    ViewTitle$(
      span$('Projects').onClick(() => (location.hash = '#!/projects')),
      span$(
        choose$(
          model.selectedProjectName$,
          add$(' / ', model.selectedProjectName$),
          ''
        )
      )
        .setStyle({
          color: choose$(
            startsWith$(currentRoute$, '/projects/<projectId:string>'),
            'darkslategray',
            'lightgray'
          ),
        })
        .onClick(
          () =>
            (location.hash = `#!/projects/${
              model.selectedProjectId$.value
            }/${model.lastVisitedProjectView$.value || ''}`)
        )
    )
  ).setStyle({
    background: 'white',
    color: 'darkslategray',
  });
};

module.exports = TitleBar$;

  return module.exports;
})();

modules['src/views/projects/newProject/NewProject.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const { span$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const NewProject$ = ({ model }) => {
  const color$ = new Observable('slategray');
  return span$('New project')
    .setStyle({
      color: color$,
      margin: '32px',
      padding: '0 16px',
      height: '64px',
      background: 'none',
      lineHeight: '64px',
      fontSize: '16px',
      display: 'inline-block',
    })
    .onMouseEnter(() => (color$.value = 'darkslategray'))
    .onMouseLeave(() => (color$.value = 'slategray'))
    .onClick(model.createNewProject);
};

module.exports = NewProject$;

  return module.exports;
})();

modules['src/components/verticalNavigator/VerticalNavigator.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const VerticalNavigator$ = withShadow(
  styled({
    height: '100%',
    width: '64px',
    position: 'absolute',
  })(div$)
);

module.exports = VerticalNavigator$;

  return module.exports;
})();

modules['src/components/codeEditor/CodeEditor.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { textArea$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const CodeEditor$ = styled({
  width: '100%',
  height: 'calc(100vh - 192px)',
  padding: '20px',
  background: 'black',
  color: 'white',
  fontFamily: '"Courier New", Courier, monospace',
  fontSize: '14px',
  lineHeight: '20px',
  whiteSpace: 'nowrap',
})(textArea$);

module.exports = CodeEditor$;

  return module.exports;
})();

modules['src/components/expandCodeEditorButton/ExpandCodeEditorButton.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { choose$ } = include('src/libraries/observable/utils.js');

const ExpandCodeEditorButton$ = ({ icon, label$, isOpen$ }) => {
  const isHovered$ = new Observable(false);
  return div$(
    div$(choose$(isOpen$, '−', '+')).setStyle({
      fontSize: '30px',
      textAlign: 'center',
      marginTop: '15px',
      pointerEvents: 'none',
      userSelect: 'none',
      transform: choose$(isOpen$, 'rotate(180deg)', 'rotate(0deg)'),
      transition: '0.5s',
    })
  )
    .setStyle({
      position: 'absolute',
      background: choose$(isHovered$, 'dodgerblue', 'royalblue'),
      borderRadius: '50%',
      color: 'white',
      height: '60px',
      width: '60px',
      margin: '10px',
      overflow: 'hidden',
      transition: '0.5s',
      cursor: 'pointer',
      zIndex: '1',
    })
    .onMouseEnter(element => {
      isHovered$.value = true;
    })
    .onMouseLeave(element => {
      isHovered$.value = false;
    });
};

module.exports = ExpandCodeEditorButton$;

  return module.exports;
})();

modules['src/views/projects/projectPreviewContainer/ProjectPreviewContainer.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const ProjectPreviewContainer$ = withShadow(
  styled({
    color: 'dimgray',
    margin: '32px 32px 0 32px',
    height: '64px',
    background: 'white',
    lineHeight: '64px',
    fontSize: '16px',
  })(div$)
);

module.exports = ProjectPreviewContainer$;

  return module.exports;
})();

modules['src/views/projects/projectPreviewButton/ProjectPreviewButton.js'] = (() => {
  const module = { exports: {} };
  const { button$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const Observable = include('src/libraries/observable/Observable.js');
const { choose$ } = include('src/libraries/observable/utils.js');

const ProjectPreviewButton$ = value$ => {
  const isHovered$ = new Observable(false);
  return button$(value$)
    .setStyle({
      color: choose$(isHovered$, 'darkslategray', 'slategray'),
      height: '64px',
      background: 'white',
      lineHeight: '64px',
      fontSize: '16px',
      width: '64px',
      textAlign: 'center',
      border: 'none',
      outline: 'none',
      cursor: 'pointer',
    })
    .onMouseEnter(() => (isHovered$.value = true))
    .onMouseLeave(element => (isHovered$.value = false));
};

module.exports = ProjectPreviewButton$;

  return module.exports;
})();

modules['src/views/projects/projectPreview/ProjectPreview.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const ProjectPreviewContainer$ = include(
  'src/views/projects/projectPreviewContainer/ProjectPreviewContainer.js'
);
const ProjectPreviewButton$ = include(
  'src/views/projects/projectPreviewButton/ProjectPreviewButton.js'
);

const ProjectPreview$ = ({ model, id$, name$ }) =>
  ProjectPreviewContainer$(
    styled({
      padding: '0 16px',
      width: 'calc(100% - 128px)',
      boxSizing: 'border-box',
      display: 'inline-block',
    })(div$)(name$).onClick(
      () =>
        (location.hash = `#!/projects/${id$.value}/${model
          .lastVisitedProjectView$.value || ''}`)
    ),
    ProjectPreviewButton$('Delete').onClick(() =>
      model.deleteProject(id$.value)
    ),
    ProjectPreviewButton$('Edit').onClick(() =>
      model.editProjectName(id$.value)
    )
  );
module.exports = ProjectPreview$;

  return module.exports;
})();

modules['src/views/projects/projectNameInput/ProjectNameInput.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { input$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const ProjectPreviewButton$ = include(
  'src/views/projects/projectPreviewButton/ProjectPreviewButton.js'
);
const ProjectPreviewContainer$ = include(
  'src/views/projects/projectPreviewContainer/ProjectPreviewContainer.js'
);

const ProjectNameInput$ = ({ model, id$, nameInputValue$ }) =>
  ProjectPreviewContainer$(
    styled({
      color: 'dimgray',
      height: '64px',
      padding: '0 16px',
      lineHeight: '64px',
      fontSize: '16px',
      width: 'calc(100% - 128px)',
      border: 'none',
      outline: 'none',
    })(input$)(nameInputValue$).onInput(({ value }) => {
      model.setProjectNameInputValue(id$.value, value);
    }),
    ProjectPreviewButton$('Cancel').onClick(() =>
      model.cancelEditingProjectName(id$.value)
    ),
    ProjectPreviewButton$('Save').onClick(() =>
      model.saveProjectName(id$.value)
    )
  );

module.exports = ProjectNameInput$;

  return module.exports;
})();

modules['src/views/projects/Projects.js'] = (() => {
  const module = { exports: {} };
  const { Choose$, If$ } = include('src/libraries/observableHtml/utils.js');
const { div$, input$ } = include(
  'src/libraries/observableHtml/ObservableHtml.js'
);
const { not$, or$, map$, startsWith$, choose$ } = include(
  'src/libraries/observable/utils.js'
);
const ProjectPreview$ = include(
  'src/views/projects/projectPreview/ProjectPreview.js'
);
const ProjectNameInput$ = include(
  'src/views/projects/projectNameInput/ProjectNameInput.js'
);
const NewProject$ = include('src/views/projects/newProject/NewProject.js');

const Projects$ = ({ model }) => {
  return div$(
    ...model.projects.map(
      ({ id$, name$, nameInputValue$, isEditing$, isEmpty$ }) => [
        ProjectNameInput$({ model, id$, nameInputValue$ }).setStyle({
          display: choose$(or$(isEmpty$, not$(isEditing$)), 'none', 'block'),
        }),
        ProjectPreview$({ model, id$, name$ }).setStyle({
          display: choose$(or$(isEmpty$, isEditing$), 'none', 'block'),
        }),
      ]
    ),
    NewProject$({ model })
  );
};

module.exports = Projects$;

  return module.exports;
})();

modules['src/components/verticalNavigatorButton/atoms.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const Button$ = styled({
  height: '64px',
  width: '64px',
  overflow: 'hidden',
  transition: '0.5s',
  cursor: 'pointer',
})(div$);
const Icon$ = styled({
  ///TODO: continue
  fontSize: '30px',
  textAlign: 'center',
  marginTop: '15px',
  pointerEvents: 'none',
  userSelect: 'none',
})(div$);
const Label$ = styled({
  fontSize: '15px',
  textAlign: 'center',
  pointerEvents: 'none',
  userSelect: 'none',
})(div$);

module.exports = {
  Button$,
  Icon$,
  Label$,
};

  return module.exports;
})();

modules['src/components/verticalNavigatorButton/VerticalNavigatorButton.js'] = (() => {
  const module = { exports: {} };
  const { add$, choose$ } = include('src/libraries/observable/utils.js');

const { Button$, Icon$, Label$ } = include(
  'src/components/verticalNavigatorButton/atoms.js'
);
const VerticalNavigatorButton$ = ({
  icon,
  label,
  route$,
  isActive$,
  labelColor$,
  highlightLabelColor$,
  backgroundColor$,
  highlightBackgroundColor$,
}) => {
  return Button$(Icon$(icon), Label$(label))
    .setStyle({
      background: choose$(
        isActive$,
        highlightBackgroundColor$,
        backgroundColor$
      ),
      color: choose$(isActive$, highlightLabelColor$, labelColor$),
    })
    .onMouseEnter(element => {
      element.setStyle({
        background: highlightBackgroundColor$,
        color: highlightLabelColor$,
      });
    })
    .onMouseLeave(element => {
      element.setStyle({
        background: choose$(
          isActive$,
          highlightBackgroundColor$,
          backgroundColor$
        ),
        color: choose$(isActive$, highlightLabelColor$, labelColor$),
      });
    })
    .onClick(() => (location.hash = add$('#!', route$).value));
};

module.exports = VerticalNavigatorButton$;

  return module.exports;
})();

modules['src/app/appNavigator/AppNavigator.js'] = (() => {
  const module = { exports: {} };
  const VerticalNavigatorButton$ = include(
  'src/components/verticalNavigatorButton/VerticalNavigatorButton.js'
);
const VerticalNavigator$ = include(
  'src/components/verticalNavigator/VerticalNavigator.js'
);
const { eq$ } = include('src/libraries/observable/utils.js');
const { getViewTitle$ } = include('src/app/utils.js');

const AppNavigator$ = ({ currentRoute$ }) =>
  VerticalNavigator$(
    VerticalNavigatorButton$({
      icon: '🏠',
      label: getViewTitle$('/'),
      route$: '/',
      isActive$: eq$(currentRoute$, '/'),
      labelColor$: 'whitesmoke',
      highlightLabelColor$: 'white',
      backgroundColor$: 'lightslategray',
      highlightBackgroundColor$: 'slategray',
    })
  ).setStyle({ background: 'lightslategrey' });

module.exports = AppNavigator$;

  return module.exports;
})();

modules['src/components/widgetLabel/WidgetLabel.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const WidgetLabel$ = ({ label$ }) =>
  div$(label$).setStyle({
    fontSize: '20px',
    marginTop: '20px',
    textAlign: 'center',
    position: 'absolute',
    width: '100%',
    pointerEvents: 'none',
    userSelect: 'none',
  });

module.exports = WidgetLabel$;

  return module.exports;
})();

modules['src/components/widgetValue/WidgetValue.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { toFixed$ } = include('src/libraries/observable/utils.js');

const WidgetValue$ = ({ value$ }) =>
  div$(toFixed$(value$, 2)).setStyle({
    fontSize: '60px',
    textAlign: 'center',
    width: '100%',
    position: 'absolute',
    top: '50%',
    transform: 'translate(0, -50%)',
  });

module.exports = WidgetValue$;

  return module.exports;
})();

modules['src/components/widgetCard/WidgetCard.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { add$ } = include('src/libraries/observable/utils.js');

const WidgetCard$ = ({ width$, height$ }) =>
  styled({
    margin: '32px 0 0 32px',
    width: add$(width$, 'px'),
    height: add$(height$, 'px'),
    display: 'inline-block',
    verticalAlign: 'top',
    background: 'white',
  })(div$);

module.exports = WidgetCard$;

  return module.exports;
})();

modules['src/components/valueWidget/ValueWidget.js'] = (() => {
  const module = { exports: {} };
  const WidgetLabel$ = include('src/components/widgetLabel/WidgetLabel.js');
const WidgetValue$ = include('src/components/widgetValue/WidgetValue.js');
const WidgetCard$ = include('src/components/widgetCard/WidgetCard.js');
const { not$ } = include('src/libraries/observable/utils.js');
const { If$ } = include('src/libraries/observableHtml/utils.js');
const withShadow = include('src/styleWrappers/withShadow.js');

const ValueWidget$ = ({ label$, value$, isEmpty$ }) =>
  If$(
    not$(isEmpty$),
    // Height + margin = 4 x navigator buttons
    // Width + margin = 6 x navigator buttons
    withShadow(WidgetCard$({ height$: 224, width$: 352 }))(
      WidgetLabel$({ label$ }),
      WidgetValue$({ value$ })
    ).setStyle({ position: 'relative', color: 'dimgray' })
  );

module.exports = ValueWidget$;

  return module.exports;
})();

modules['src/views/values/Values.js'] = (() => {
  const module = { exports: {} };
  const CodeEditor$ = include('src/components/codeEditor/CodeEditor.js');
const ExpandCodeEditorButton$ = include(
  'src/components/expandCodeEditorButton/ExpandCodeEditorButton.js'
);
const ValueWidget$ = include('src/components/valueWidget/ValueWidget.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { eq$, choose$ } = include('src/libraries/observable/utils.js');

const Values$ = ({ model, currentRoute$ }) => {
  const codeEditorIsOpen$ = eq$(
    currentRoute$,
    '/projects/<projectId:string>/values/edit'
  );
  return div$(
    ExpandCodeEditorButton$({
      icon: '{}',
      label$: choose$(codeEditorIsOpen$, 'Hide editor', 'Show editor'),
      isOpen$: codeEditorIsOpen$,
    }).onClick(() => {
      location.hash = codeEditorIsOpen$.value
        ? `#!/projects/${model.selectedProjectId$.value}/values`
        : `#!/projects/${model.selectedProjectId$.value}/values/edit`;
    }),
    div$(
      CodeEditor$(model.derivedValuesCode$)
        .onInput(({ value }) => {
          model.derivedValuesCode$.value = value;
        })
        .setStyle({ paddingLeft: '80px' })
    ).setStyle({
      display: 'inline-block',
      width: choose$(codeEditorIsOpen$, '50%', '0'),
      transition: '0.5s',
      overflow: 'hidden',
    }),
    div$(
      div$(
        ...model.derivedValues.map(({ label$, value$, isEmpty$ }) =>
          ValueWidget$({ label$, value$, isEmpty$ })
        )
      ).setStyle({ position: 'relative', top: '0' })
    ).setStyle({
      display: 'inline-block',
      position: 'absolute',
      paddingLeft: choose$(codeEditorIsOpen$, '0', '80px'),
      transition: '0.5s',
    })
  ).setStyle({ width: '100%' });
};

module.exports = Values$;

  return module.exports;
})();

modules['src/components/visualization/threeDimVisualization/camera/Camera.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

const Camera = function({
  target = new Observable([0, 0, 0]),
  horizontalRotation$ = new Observable(0),
  verticalRotation$ = new Observable(0),
  distance$ = new Observabe(100),
  focalLength$ = new Observable(100),
}) {
  this.target = target;
  this.horizontalRotation$ = horizontalRotation$;
  this.verticalRotation$ = new Observable(
    Math.max(Math.min(verticalRotation$.value, Math.PI / 4), -Math.PI / 2)
  );
  this.distance$ = new Observable(
    Math.max(distance$.value, -focalLength$.value / 2)
  );
  this.focalLength$ = focalLength$;
  this.setDistance = distance => {
    this.distance$.value = Math.max(distance, -focalLength$.value / 2);
  };
  this.setVerticalRotation = verticalRotation => {
    this.verticalRotation$.value = Math.max(
      Math.min(verticalRotation, Math.PI / 2),
      -Math.PI / 2
    );
  };
};

module.exports = Camera;

  return module.exports;
})();

modules['src/components/visualization/render/toCenterOfWidget/toCenterOfWidget.js'] = (() => {
  const module = { exports: {} };
  const toCenterOfWidget = ([x, y, z], ctx) => [
  x + ctx.canvas.width / 2,
  y - ctx.canvas.height / 2,
  z,
];

module.exports = toCenterOfWidget;

  return module.exports;
})();

modules['src/components/visualization/render/toPerspective/toPerspective.js'] = (() => {
  const module = { exports: {} };
  const toPerspective = ([x, y, z], d, focalLength) =>
  focalLength
    ? [
        x * (focalLength / (d + focalLength + z)),
        y * (focalLength / (d + focalLength + z)),
        z,
      ]
    : [x, y, z];

module.exports = toPerspective;

  return module.exports;
})();

modules['src/components/visualization/render/toCenterOfStructure/toCenterOfStructure.js'] = (() => {
  const module = { exports: {} };
  const toCenterOfStructure = ([x, y, z], transformedCenterOfStructure) => [
  x - transformedCenterOfStructure[0],
  y - transformedCenterOfStructure[1],
  z - transformedCenterOfStructure[2],
];

module.exports = toCenterOfStructure;

  return module.exports;
})();

modules['src/components/visualization/render/rotate/rotate.js'] = (() => {
  const module = { exports: {} };
  const rotate = ([x, y, z], rx, ry) => {
  const theta = rx;
  const phi = ry;

  const horizontallyRotatedVertex = [
    x * Math.cos(theta) + z * Math.sin(theta),
    y,
    z * Math.cos(theta) - x * Math.sin(theta),
  ];

  return [
    horizontallyRotatedVertex[0],
    horizontallyRotatedVertex[1] * Math.cos(phi) -
      horizontallyRotatedVertex[2] * Math.sin(phi),
    horizontallyRotatedVertex[1] * Math.sin(phi) +
      horizontallyRotatedVertex[2] * Math.cos(phi),
  ];
};

module.exports = rotate;

  return module.exports;
})();

modules['src/components/visualization/render/render.js'] = (() => {
  const module = { exports: {} };
  const toCenterOfWidget = include(
  'src/components/visualization/render/toCenterOfWidget/toCenterOfWidget.js'
);
const toPerspective = include(
  'src/components/visualization/render/toPerspective/toPerspective.js'
);
const toCenterOfStructure = include(
  'src/components/visualization/render/toCenterOfStructure/toCenterOfStructure.js'
);
const rotate = include('src/components/visualization/render/rotate/rotate.js');

/**
 * @param {number} dx
 * Defines the x coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} dy
 * Defines the y coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} dz
 * Defines the z coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} d
 * Defines the distance from the defined center of the structure, to the
 * camera.
 */
const render = (
  surfaces$,
  edges$,
  ctx,
  center,
  rx = 0,
  ry = 0,
  d = 0,
  focalLength = 0
) => {
  // Render the faces
  surfaces$.value.forEach(({ color, points }) => {
    points
      .map(point => toCenterOfStructure(point, center))
      .map(point => rotate(point, rx, ry))
      .map(point => toPerspective(point, d, focalLength))
      .map(point => toCenterOfWidget(point, ctx))
      .forEach((point, index) => {
        if (index === 0) {
          ctx.beginPath();
          ctx.moveTo(point[0], -point[1]);
          return;
        }
        if (index < points.length - 1) {
          ctx.lineTo(point[0], -point[1]);
          return;
        }
        if (index === points.length - 1) {
          ctx.lineTo(point[0], -point[1]);
          ctx.closePath();
          ctx.fillStyle = color;
          ctx.fill();
          return;
        }
      });
  });

  // Render the edges
  edges$.value.forEach(({ color, points, width }) => {
    // Draw the first vertex
    const startPoint = toCenterOfWidget(
      toPerspective(
        rotate(toCenterOfStructure(points[0], center), rx, ry),
        d,
        focalLength
      ),

      ctx
    );
    const endPoint = toCenterOfWidget(
      toPerspective(
        rotate(toCenterOfStructure(points[1], center), rx, ry),
        d,
        focalLength
      ),
      ctx
    );
    ctx.beginPath();
    ctx.lineCap = 'round';
    ctx.moveTo(startPoint[0], -startPoint[1]);
    ctx.lineTo(endPoint[0], -endPoint[1]);
    ctx.lineWidth = width;
    ctx.strokeStyle = color;
    ctx.stroke();
  });
};

module.exports = render;

  return module.exports;
})();

modules['src/components/visualization/threeDimVisualization/ThreeDimVisualization.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const { canvas$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const Camera = include(
  'src/components/visualization/threeDimVisualization/camera/Camera.js'
);
const render = include('src/components/visualization/render/render.js');

const ThreeDimVisualization$ = ({
  height$,
  width$,
  surfaces$,
  edges$,
  center$,
}) => {
  const state = { mouseDown: false };
  const canvas = canvas$({ height$, width$ }).setStyle({
    position: 'absolute',
  });
  const camera = new Camera({
    target: center$,
    horizontalRotation$: new Observable(0),
    verticalRotation$: new Observable(0),
    distance$: new Observable(100),
    focalLength$: new Observable(100),
  });
  const ctx = canvas.getContext('2d');
  const rerender = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    render(
      surfaces$,
      edges$,
      ctx,
      camera.target.value,
      camera.horizontalRotation$.value,
      camera.verticalRotation$.value,
      camera.distance$.value,
      camera.focalLength$.value
    );
  };
  rerender();
  canvas.onwheel = event => {
    camera.setDistance(camera.distance$.value + event.deltaY / 5);
  };
  window.addEventListener('mousedown', event => {
    state.mouseDown = true;
  });
  window.addEventListener(
    'mouseup',
    (canvas.onmouseup = event => {
      state.mouseDown = false;
    })
  );
  canvas.onmousemove = event => {
    if (state.mouseDown) {
      camera.horizontalRotation$.value =
        camera.horizontalRotation$.value - event.movementX / 100;
      camera.setVerticalRotation(
        camera.verticalRotation$.value - event.movementY / 100
      );
    }
  };
  window.addEventListener(camera.horizontalRotation$.id, () => rerender());
  window.addEventListener(camera.verticalRotation$.id, () => rerender());
  window.addEventListener(camera.distance$.id, () => rerender());
  window.addEventListener(camera.focalLength$.id, () => rerender());
  window.addEventListener(surfaces$.id, () => rerender());
  window.addEventListener(edges$.id, () => rerender());
  window.addEventListener(center$.id, () => rerender());
  return canvas;
};

module.exports = ThreeDimVisualization$;

  return module.exports;
})();

modules['src/components/visualization/twoDimVisualization/TwoDimVisualization.js'] = (() => {
  const module = { exports: {} };
  const { canvas$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const render = include('src/components/visualization/render/render.js');

const TwoDimVisualization$ = ({
  height$,
  width$,
  surfaces$,
  edges$,
  center$,
}) => {
  const canvas = canvas$({ height$, width$ }).setStyle({
    position: 'absolute',
  });
  const ctx = canvas.getContext('2d');
  const rerender = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    render(surfaces$, edges$, ctx, center$.value);
  };
  rerender();
  window.addEventListener(surfaces$.id, () => rerender());
  window.addEventListener(edges$.id, () => rerender());
  window.addEventListener(center$.id, () => rerender());
  return canvas;
};

module.exports = TwoDimVisualization$;

  return module.exports;
})();

modules['src/components/canvasWidget/CanvasWidget.js'] = (() => {
  const module = { exports: {} };
  const WidgetCard$ = include('src/components/widgetCard/WidgetCard.js');
const ThreeDimVisualization$ = include(
  'src/components/visualization/threeDimVisualization/ThreeDimVisualization.js'
);
const TwoDimVisualization$ = include(
  'src/components/visualization/twoDimVisualization/TwoDimVisualization.js'
);
const WidgetLabel$ = include('src/components/widgetLabel/WidgetLabel.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { not$ } = include('src/libraries/observable/utils.js');
const { Choose$, If$ } = include('src/libraries/observableHtml/utils.js');

const CanvasWidget$ = ({
  label$,
  surfaces$,
  edges$,
  center$,
  is3d$,
  isEmpty$,
}) => {
  return If$(
    not$(isEmpty$),
    // Height + margin = 5 x navigator buttons
    // Width + margin = 7.5 x navigator buttons
    withShadow(WidgetCard$({ height$: 288, width$: 448 }))(
      Choose$(
        is3d$,
        ThreeDimVisualization$({
          height$: 288,
          width$: 448,
          surfaces$,
          edges$,
          center$,
        }),
        TwoDimVisualization$({
          height$: 288,
          width$: 448,
          surfaces$,
          edges$,
          center$,
        })
      ),
      WidgetLabel$({ label$ })
    ).setStyle({
      position: 'relative',
      color: 'dimgray',
    })
  );
};

module.exports = CanvasWidget$;

  return module.exports;
})();

modules['src/views/dashboards/Dashboards.js'] = (() => {
  const module = { exports: {} };
  const CodeEditor$ = include('src/components/codeEditor/CodeEditor.js');
const ExpandCodeEditorButton$ = include(
  'src/components/expandCodeEditorButton/ExpandCodeEditorButton.js'
);
const CanvasWidget$ = include('src/components/canvasWidget/CanvasWidget.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { eq$, choose$ } = include('src/libraries/observable/utils.js');

const Dashboards$ = ({ model, currentRoute$ }) => {
  const codeEditorIsOpen$ = eq$(
    currentRoute$,
    '/projects/<projectId:string>/dashboards/edit'
  );
  return div$(
    ExpandCodeEditorButton$({
      icon: '+',
      label$: choose$(codeEditorIsOpen$, 'Hide editor', 'Show editor'),
      isOpen$: codeEditorIsOpen$,
    }).onClick(() => {
      location.hash = codeEditorIsOpen$.value
        ? `#!/projects/${model.selectedProjectId$.value}/dashboards`
        : `#!/projects/${model.selectedProjectId$.value}/dashboards/edit`;
    }),
    div$(
      CodeEditor$(model.widgetsCode$)
        .onInput(({ value }) => {
          model.widgetsCode$.value = value;
        })
        .setStyle({ paddingLeft: '80px' })
    ).setStyle({
      display: 'inline-block',
      width: choose$(codeEditorIsOpen$, '50%', '0'),
      transition: '0.5s',
      overflow: 'hidden',
    }),
    div$(
      div$(
        ...model.widgets.map(
          ({ label$, surfaces$, edges$, is3d$, center$, isEmpty$ }) =>
            CanvasWidget$({
              label$,
              surfaces$,
              edges$,
              is3d$,
              center$,
              isEmpty$,
            })
        )
      ).setStyle({
        position: 'relative',
        top: '0',
      })
    ).setStyle({
      display: 'inline-block',
      position: 'absolute',
      paddingLeft: choose$(codeEditorIsOpen$, '0', '80px'),
      transition: '0.5s',
    })
  ).setStyle({ width: '100%' });
};

module.exports = Dashboards$;

  return module.exports;
})();

modules['src/app/App.js'] = (() => {
  const module = { exports: {} };
  const { eq$, or$, startsWith$ } = include('src/libraries/observable/utils.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { If$ } = include('src/libraries/observableHtml/utils.js');

const HorizontalNavigator$ = include(
  'src/components/horizontalNavigator/HorizontalNavigator.js'
);
const ProjectNavigator$ = include(
  'src/views/project/projectNavigator/ProjectNavigator.js'
);
const AppContainer$ = include('src/app/appContainer/AppContainer.js');
const AppContentContainer$ = include(
  'src/app/appContentContainer/AppContentContainer.js'
);
const ProjectContainer$ = include(
  'src/views/project/projectContainer/ProjectContainer.js'
);
const TitleBar$ = include('src/app/titleBar/TitleBar.js');
const Projects$ = include('src/views/projects/Projects.js');
const DataSources$ = include('src/views/dataSources/DataSources.js');
const AppNavigator$ = include('src/app/appNavigator/AppNavigator.js');
const Values$ = include('src/views/values/Values.js');
const Dashboards$ = include('src/views/dashboards/Dashboards.js');

const App = ({ currentRoute$, model }) => {
  return div$(
    HorizontalNavigator$().setStyle({ background: 'black' }),
    AppContainer$(
      AppNavigator$({ currentRoute$ }),
      AppContentContainer$(
        TitleBar$({ currentRoute$, model }),
        If$(eq$(currentRoute$, '/'), Projects$({ model })),
        If$(
          startsWith$(currentRoute$, '/projects/<projectId:string>'),
          ProjectContainer$(
            ProjectNavigator$({ currentRoute$, model }),
            If$(
              or$(
                eq$(currentRoute$, '/projects/<projectId:string>/data-sources'),
                eq$(currentRoute$, '/projects/<projectId:string>')
              ),
              DataSources$()
            ),
            If$(
              startsWith$(currentRoute$, '/projects/<projectId:string>/values'),
              Values$({ model, currentRoute$ })
            ),
            If$(
              startsWith$(
                currentRoute$,
                '/projects/<projectId:string>/dashboards'
              ),
              Dashboards$({ model, currentRoute$ })
            )
          )
        )
      )
    )
  );
};

module.exports = App;

  return module.exports;
})();

window.addEventListener('load', () => {
const Router = include('src/libraries/router/Router.js');
const Model = include('src/model/Model.js');
const App = include('src/app/App.js');

Object.assign(document.body.style, {
  margin: 0,
  fontFamily: 'sans-serif',
  background: 'GhostWhite',
  height: '100%',
});
//const FIREBASE_API_KEY = 'AIzaSyCeGXLqw0MEwiSFHG1Wks1HfQHXRZoOuFY';

// Create router
const router = new Router({
  '/': 'Projects',
  '/projects/<projectId:string>': 'Data sources',
  '/projects/<projectId:string>/data-sources': 'Data sources',
  '/projects/<projectId:string>/values': 'Values',
  '/projects/<projectId:string>/values/edit': 'Edit values',
  '/projects/<projectId:string>/dashboards': 'Dashboards',
  '/projects/<projectId:string>/dashboards/edit': 'Edit dashboards',
});

const model = Model({ router });

document.body.appendChild(
  App({
    model,
    params: router.getParams,
    currentRoute$: router.currentRoute$,
  })
);
document.body.update = props =>
  document.body.childNodes.forEach(childNode => {
    if (typeof childNode.update === 'function') {
      childNode.update(props);
    }
  });

router.subscribe(() => document.body.update());

})
</script>
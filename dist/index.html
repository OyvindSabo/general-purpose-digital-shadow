
<meta charset="utf-8" />
<script>
const modules = {}
const include = path => modules[path];

modules['src/libraries/observable/Observable.js'] = (() => {
  const module = { exports: {} };
  class Observable {
  constructor(value) {
    // Maybe this can cause an id collision of two observables created almost at the same time
    this._id = `${Math.random()}${+new Date()}`;
    this._value = value;
  }
  emit() {
    window.dispatchEvent(
      new CustomEvent(this._id, {
        detail: this._value,
      })
    );
  }
  get id() {
    return this._id;
  }
  get value() {
    return this._value;
  }
  set value(value) {
    // Maybe this should do a deep compare in case value is an object?
    if (value === this._value) return;
    this._value = value;
    this.emit();
  }
}

module.exports = Observable;

  return module.exports;
})();

modules['src/libraries/router/Router.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

function Router(routes) {
  /**
   * @param {string} routes
   */
  this.setRoutes = function(routes) {
    Object.entries(routes).forEach(([route, title]) => {
      this.routes[route] = route;
      this.titles[route] = title;
      if (route === '/') {
        this.routes[''] = route;
        this.titles[''] = title;
      }
    });
    this.syncWithHash();
  };
  Router.getTokens = function(hash) {
    return hash
      .split('/')
      .filter(Boolean)
      .filter(element => element !== '#')
      .filter(element => element !== '#!');
  };
  /**
   * @param {string} token
   * @returns {boolean}
   */
  Router.isParameterRouteToken = function(token) {
    if (
      token.indexOf('<') !== 0 ||
      !token.slice(2, -4).includes(':') ||
      token.indexOf('>') !== token.length - 1
    ) {
      return false;
    }
    const [parameter, type] = token
      .slice(token.indexOf('<') + 1, token.indexOf('>'))
      .split(':');

    if (!['int', 'string', 'number'].includes(type)) {
      return false;
    }
    return true;
  };
  Router.appendTokenToHash = function(hash, token) {
    return `${hash}/${token}`;
  };
  Router.parseParameterRouteToken = function(token) {
    const [parameter, type] = token
      .slice(token.indexOf('<') + 1, token.indexOf('>'))
      .split(':');
    return {
      parameter,
      type,
    };
  };
  // (hash: string, route: string) => false | { [key: string]: number | string }
  Router.getMatch = function(hash, route) {
    const hashTokens = Router.getTokens(hash);
    const routeTokens = Router.getTokens(route);
    const params = {};
    let reconstructedHash = '#!';
    if (hashTokens.length !== routeTokens.length) return false;
    for (let i of Object.keys(hashTokens)) {
      const hashToken = hashTokens[i];
      const routeToken = routeTokens[i];
      if (Router.isParameterRouteToken(routeToken)) {
        const { parameter, type } = Router.parseParameterRouteToken(routeToken);
        if (type === 'int') {
          if (!Router.isInt(hashToken)) return false;
          params[parameter] = parseInt(hashToken);
          reconstructedHash = Router.appendTokenToHash(
            reconstructedHash,
            hashToken
          );
        } else if (type === 'number' && !Router.isNumber(hasToken)) {
          if (!Router.isNumber(hashToken)) return false;
          params[parameter] = Number(hashToken);
          reconstructedHash = Router.appendTokenToHash(
            reconstructedHash,
            hashToken
          );
        } else if (type === 'string') {
          params[parameter] = hashToken;
          reconstructedHash = Router.appendTokenToHash(
            reconstructedHash,
            hashToken
          );
        }
      } else {
        if (hashToken !== routeToken) return false;
        reconstructedHash = Router.appendTokenToHash(
          reconstructedHash,
          hashToken
        );
      }
    }
    return { params, reconstructedHash };
  };
  Router.getRouteAndParamsFromHash = function(hash, routes) {
    for (let route of Object.keys(routes)) {
      const match = Router.getMatch(hash, route);
      if (match) {
        const { params, reconstructedHash } = match;
        return { route, params, reconstructedHash };
      }
    }
    return { route: '', params: {}, reconstructedHash: '' };
  };
  /**
   * @param {Object.<string, number | string>} params
   */
  this.setParams = function(params) {
    this.params = params;
    // Todo: Maybe dispatch some kind of event
  };
  this.setCurrentRoute = function(route) {
    this.currentRoute$.value = route;
  };
  this.setCurrentTitle = function(title) {
    this.currentTitle = title;
  };
  Router.removeHash = function() {
    return history.replaceState(null, null, ' ');
  };
  // Rather than passing data, this one should pass a string saying which attribute has been updated
  this.emit = function() {
    this.observers.forEach(observer => {
      if (!observer)
        console.warn('Non-existing element registered as router observer');

      observer({ currentRoute$: this.currentRoute$, params: this.params });
    });
  };
  this.syncWithHash = function() {
    const { hash } = location;
    const {
      route,
      params,
      reconstructedHash,
    } = Router.getRouteAndParamsFromHash(hash, this.routes);
    this.setParams(params);
    this.setCurrentRoute(this.routes[route]);
    this.setCurrentTitle(this.titles[route]);
    if (reconstructedHash === '#!') {
      Router.removeHash();
    } else {
      history.replaceState(undefined, undefined, reconstructedHash);
    }
    document.title = this.currentTitle;
    this.emit();
  };
  this.params = {};
  this.currentRoute$ = new Observable('');
  this.routes = {};
  this.titles = {};
  this.observers = [];
  this.hashChangeListeners = [];
  this.setRoutes(routes);
  window.addEventListener('hashchange', () => {
    this.syncWithHash();
    this.callHashChangeListeners();
  });
  /**
   * @param {string} route
   * One of the registered routes, without hashbang
   */
  this.navigateTo = route => {
    location.hash = `#!${route}`;
  };

  this.refresh = () => this.syncWithHash();

  // @possiblyNumber: string
  Router.isNumber = function(possiblyNumber) {
    return !isNaN(Number(possiblyNumber));
  };
  Router.isInt = function(possiblyInt) {
    return (
      Router.isNumber(possiblyInt) &&
      parseInt(possiblyInt) === Number(possiblyInt)
    );
  };
  this.onHashChange = callback => {
    this.hashChangeListeners.push(callback);
    this.callHashChangeListeners();
  };
  this.callHashChangeListeners = function() {
    this.hashChangeListeners.forEach(hashChangeListener =>
      hashChangeListener({
        params: this.params,
        currentRoute$: this.currentRoute$,
      })
    );
  };
  this.getParams = () => this.params;
  this.getCurrentTitle = () => this.currentTitle;
  Router.isProp = propsOrChild =>
    !(propsOrChild instanceof HTMLElement || typeof propsOrChild === 'string');

  /**
   * @param {function({ params: Object.<string, string | number> }): void} observer
   */
  this.subscribe = observer => {
    observer({
      currentRoute$: this.currentRoute$,
      params: this.params,
    });
    this.observers.push(observer);
  };
}

module.exports = Router;

  return module.exports;
})();

modules['src/model/Model.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

const MAX_AMOUNT_OF_DERIVED_VALUES = 100;
const MAX_AMOUNT_OF_WIDGETS = 100;

const evaluateCode = (valuesCode, derivedValuesCode, widgetsCode) => {
  return eval(`
    const values = {};
    const derivedValues = {};
    const widgets = {};
    ${valuesCode}
    ${derivedValuesCode}
    ${widgetsCode}
    result = {
      values,
      derivedValues,
      widgets,
    };
  `);
};

const buyPrice$ = new Observable(100);
const sellPrice$ = new Observable(100);

const model = {
  projects: new Observable([
    { id: '0', name: 'Double wishbone suspension' },
    { id: '1', name: 'Bar charts' },
  ]),

  derivedValuesEditorIsOpen$: new Observable(false),

  valuesCode$: new Observable(''),
  derivedValuesCode$: new Observable(''),
  widgetsCode$: new Observable(''),

  values: [...new Array(MAX_AMOUNT_OF_DERIVED_VALUES).keys()].map(() => ({
    label$: new Observable(''),
    value$: new Observable(0),
    isEmpty$: new Observable(true),
  })),
  derivedValues: [...new Array(MAX_AMOUNT_OF_DERIVED_VALUES).keys()].map(
    () => ({
      label$: new Observable(''),
      value$: new Observable(0),
      isEmpty$: new Observable(true),
    })
  ),
  widgets: [...new Array(MAX_AMOUNT_OF_DERIVED_VALUES).keys()].map(() => ({
    label$: new Observable(''),
    edges$: new Observable([]),
    surfaces$: new Observable([]),
    center$: new Observable([0, 0, 0]),
    isEmpty$: new Observable(true),
    is3d$: new Observable(false),
  })),
};

window.addEventListener(model.valuesCode$.id, () => {
  const evaluatedCode = evaluateCode(
    model.valuesCode$.value,
    model.derivedValuesCode$.value,
    model.widgetsCode$.value
  );

  const valuesEntries = Object.entries(evaluatedCode.values);
  model.values.forEach(({ label$, value$, isEmpty$ }, index) => {
    label$.value = valuesEntries[index] ? valuesEntries[index][0] : '';
    value$.value = valuesEntries[index] ? valuesEntries[index][1] : 0;
    isEmpty$.value = !Boolean(valuesEntries[index]);
  });

  const derivedValuesEntries = Object.entries(evaluatedCode.derivedValues);
  model.derivedValues.forEach(({ label$, value$, isEmpty$ }, index) => {
    label$.value = derivedValuesEntries[index]
      ? derivedValuesEntries[index][0]
      : '';
    value$.value = derivedValuesEntries[index]
      ? derivedValuesEntries[index][1]
      : 0;
    isEmpty$.value = !derivedValuesEntries[index];
  });

  const widgetsEntries = Object.entries(evaluatedCode.widgets);
  model.widgets.forEach(
    ({ label$, edges$, surfaces$, is3d$, center$, isEmpty$ }, index) => {
      label$.value = widgetsEntries[index] ? widgetsEntries[index][0] : '';
      edges$.value = widgetsEntries[index]
        ? widgetsEntries[index][1].edges || []
        : [];
      surfaces$.value = widgetsEntries[index]
        ? widgetsEntries[index][1].surfaces || []
        : [];
      center$.value = widgetsEntries[index]
        ? widgetsEntries[index][1].center || [0, 0, 0]
        : [0, 0, 0]; // TODO
      is3d$.value = widgetsEntries[index]
        ? widgetsEntries[index][1].is3d || false
        : false; // TODO
      isEmpty$.value = !widgetsEntries[index];
    }
  );
});

// We can pretend we are fetching data from an api here
const updateValues = () => {
  setTimeout(() => {
    buyPrice$.value =
      Math.floor(Math.random() * 2) == 1
        ? buyPrice$.value * 1.01
        : buyPrice$.value / 1.01;
    sellPrice$.value =
      Math.floor(Math.random() * 2) == 1
        ? sellPrice$.value * 1.01
        : sellPrice$.value / 1.01;
    model.valuesCode$.value = `
      values.buyPrice = ${buyPrice$.value};
      values.sellPrice = ${sellPrice$.value};
    `;
    updateValues();
  }, 100);
};
updateValues();

model.derivedValuesCode$.value = `
  derivedValues['A constant value'] = 45;
  derivedValues['Profit']           = values.sellPrice - values.buyPrice;
  derivedValues['Dollar Profit']    = derivedValues.Profit / 8;
  derivedValues['Compression (cm)'] = Math.random() * 10;
`;
model.widgetsCode$.value = `
  /*******************************************************************************
  DOUBLE WISHBONE SUSPENSION
  *******************************************************************************/
  
  const compression = derivedValues['Compression (cm)'];
  widgets['Double Wisbone Suspension'] = {
    edges: [
      // Front frame
      { points: [[-25, 0, 0], [25, 0, 0]], color: 'black', width: 2 },
      { points: [[-25, 40, 0], [25, 40, 0]], color: 'black', width: 2 },
      { points: [[-25, 0, 0], [-25, 40, 0]], color: 'black', width: 2 },
      { points: [[25, 0, 0], [25, 40, 0]], color: 'black', width: 2 },

      // Rear frame
      { points: [[-25, 0, 275], [25, 0, 275]], color: 'black', width: 2 },
      { points: [[-25, 40, 275], [25, 40, 275]], color: 'black', width: 2 },
      { points: [[-25, 0, 275], [-25, 40, 275]], color: 'black', width: 2 },
      { points: [[25, 0, 275], [25, 40, 275]], color: 'black', width: 2 },

      // Bottom left frame rails
      { points: [[25, 0, 0], [25, 0, 25]], color: 'black', width: 2 },
      { points: [[25, 0, 25], [50, 0, 150]], color: 'black', width: 2 },
      { points: [[50, 0, 150], [50, 0, 225]], color: 'black', width: 2 },
      { points: [[50, 0, 225], [25, 0, 250]], color: 'black', width: 2 },
      { points: [[25, 0, 250], [25, 0, 275]], color: 'black', width: 2 },

      // Bottom right frame rails
      { points: [[-25, 0, 0], [-25, 0, 25]], color: 'black', width: 2 },
      { points: [[-25, 0, 25], [-50, 0, 150]], color: 'black', width: 2 },
      { points: [[-50, 0, 150], [-50, 0, 225]], color: 'black', width: 2 },
      { points: [[-50, 0, 225], [-25, 0, 250]], color: 'black', width: 2 },
      { points: [[-25, 0, 250], [-25, 0, 275]], color: 'black', width: 2 },

      // Top left frame rails
      { points: [[25, 40, 0], [25, 40, 25]], color: 'black', width: 2 },
      { points: [[25, 40, 25], [50, 40, 150]], color: 'black', width: 2 },
      { points: [[50, 40, 150], [50, 40, 225]], color: 'black', width: 2 },
      { points: [[50, 40, 225], [25, 40, 250]], color: 'black', width: 2 },
      { points: [[25, 40, 250], [25, 40, 275]], color: 'black', width: 2 },

      // Top right frame rails
      { points: [[-25, 40, 0], [-25, 40, 25]], color: 'black', width: 2 },
      { points: [[-25, 40, 25], [-50, 40, 150]], color: 'black', width: 2 },
      { points: [[-50, 40, 150], [-50, 40, 225]], color: 'black', width: 2 },
      { points: [[-50, 40, 225], [-25, 40, 250]], color: 'black', width: 2 },
      { points: [[-25, 40, 250], [-25, 40, 275]], color: 'black', width: 2 },

      // Left diagonal struts
      { points: [[25, 40, 25], [25, 0, 25]], color: 'black', width: 2 },
      { points: [[25, 0, 25], [50, 40, 150]], color: 'black', width: 2 },
      { points: [[50, 40, 150], [50, 0, 150]], color: 'black', width: 2 },
      { points: [[50, 0, 150], [50, 40, 225]], color: 'black', width: 2 },
      { points: [[50, 0, 225], [25, 40, 250]], color: 'black', width: 2 },
      { points: [[25, 0, 250], [25, 40, 275]], color: 'black', width: 2 },

      // Right diagonal struts
      { points: [[-25, 40, 25], [-25, 0, 25]], color: 'black', width: 2 },
      { points: [[-25, 0, 25], [-50, 40, 150]], color: 'black', width: 2 },
      { points: [[-50, 40, 150], [-50, 0, 150]], color: 'black', width: 2 },
      { points: [[-50, 0, 150], [-50, 40, 225]], color: 'black', width: 2 },
      { points: [[-50, 0, 225], [-25, 40, 250]], color: 'black', width: 2 },
      { points: [[-25, 0, 250], [-25, 40, 275]], color: 'black', width: 2 },

      // Top
      { points: [[50, 40, 225], [50, 60, 250]], color: 'black', width: 2 },
      { points: [[50, 60, 250], [50, 60, 275]], color: 'black', width: 2 },
      { points: [[50, 60, 275], [25, 40, 275]], color: 'black', width: 2 },
      { points: [[50, 60, 250], [25, 40, 250]], color: 'black', width: 2 },
      { points: [[-25, 40, 25], [25, 40, 25]], color: 'black', width: 2 },

      { points: [[-50, 40, 225], [-50, 60, 250]], color: 'black', width: 2 },
      { points: [[-50, 60, 250], [-50, 60, 275]], color: 'black', width: 2 },
      { points: [[-50, 60, 275], [-25, 40, 275]], color: 'black', width: 2 },
      { points: [[-50, 60, 250], [-25, 40, 250]], color: 'black', width: 2 },

      { points: [[-50, 60, 250], [50, 60, 250]], color: 'black', width: 2 },
      { points: [[-50, 60, 275], [50, 60, 275]], color: 'black', width: 2 },
      { points: [[-25, 40, 250], [25, 40, 250]], color: 'black', width: 2 },
      { points: [[-50, 40, 150], [50, 40, 150]], color: 'black', width: 2 },

      // Bottom
      { points: [[-50, 0, 150], [50, 0, 150]], color: 'black', width: 2 },
      { points: [[-25, 0, 25], [25, 0, 25]], color: 'black', width: 2 },
      
      // Front left wishbones
      { points: [[25, 0, 0], [75, -5 + compression, 12.5]], color: 'black', width: 2 },
      { points: [[25, 0, 25], [75, -5 + compression, 12.5]], color: 'black', width: 2 },
      { points: [[25, 40, 0], [75, 35 + compression, 12.5]], color: 'black', width: 2 },
      { points: [[25, 40, 25], [75, 35 + compression, 12.5]], color: 'black', width: 2 },

      // Front right wishbones
      { points: [[-25, 0, 0], [-75, -5 + compression, 12.5]], color: 'black', width: 2 },
      { points: [[-25, 0, 25], [-75, -5 + compression, 12.5]], color: 'black', width: 2 },
      { points: [[-25, 40, 0], [-75, 35 + compression, 12.5]], color: 'black', width: 2 },
      { points: [[-25, 40, 25], [-75, 35 + compression, 12.5]], color: 'black', width: 2 },

      // Rear left wishbones
      { points: [[25, 0, 250], [75, -5 + compression, 262.5]], color: 'black', width: 2 },
      { points: [[25, 0, 275], [75, -5 + compression, 262.5]], color: 'black', width: 2 },
      { points: [[25, 40, 250], [75, 35 + compression, 262.5]], color: 'black', width: 2 },
      { points: [[25, 40, 275], [75, 35 + compression, 262.5]], color: 'black', width: 2 },

      // Rear right wishbones
      { points: [[-25, 0, 250], [-75, -5 + compression, 262.5]], color: 'black', width: 2 },
      { points: [[-25, 0, 275], [-75, -5 + compression, 262.5]], color: 'black', width: 2 },
      { points: [[-25, 40, 250], [-75, 35 + compression, 262.5]], color: 'black', width: 2 },
      { points: [[-25, 40, 275], [-75, 35 + compression, 262.5]], color: 'black', width: 2 },
    ],
    center: [0, 20, 125],
    is3d: true,
  }

  /*******************************************************************************
  3D PYRAMID
  *******************************************************************************/
  
  const profit = 100 + derivedValues.Profit;

  const point0 = [     0,      0,      0];
  const point1 = [     0,      0, profit];
  const point2 = [     0, profit,      0];
  const point3 = [profit,      0,      0];

  const surfaceColor = 'rgba(128, 128, 255, 0.5)';
  const edgeColor = 'blue';

  // We create the faces
  const surface0 = { color: surfaceColor, points: [point0, point1, point2] };
  const surface1 = { color: surfaceColor, points: [point0, point1, point3] };
  const surface2 = { color: surfaceColor, points: [point1, point2, point3] };
  const surface3 = { color: surfaceColor, points: [point0, point2, point3] };

  // We create the edges
  const edge0 = { color: edgeColor, points: [point0, point1], width: 2 };
  const edge1 = { color: edgeColor, points: [point0, point2], width: 2 };
  const edge2 = { color: edgeColor, points: [point0, point3], width: 2 };
  const edge3 = { color: edgeColor, points: [point1, point2], width: 2 };
  const edge4 = { color: edgeColor, points: [point1, point3], width: 2 };
  const edge5 = { color: edgeColor, points: [point2, point3], width: 2 };

  // We create the widget
  widgets.Pyramid = {
    surfaces: [surface0, surface1, surface2, surface3],
    edges: [edge0, edge1, edge2, edge3, edge4, edge5],
    is3d: true,
  };

  /*******************************************************************************
  2D BAR CHART
  *******************************************************************************/
  widgets['Bar Chart'] = {
    surfaces: [{
      color: \`rgba(0, 255, 0, 0.5)\`,
      points: [[ 0,      0, 0],
               [ 0, profit, 0],
               [10, profit, 0],
               [10,      0, 0]]
    },
    {
      color: \`rgba(0, 255, 0, 0.5)\`,
      points: [[20,      0, 0],
               [20, profit, 0],
               [30, profit, 0],
               [30,      0, 0]]
    }],
    center: [15, 50, 0],
  }

  /*******************************************************************************
  3D BAR CHART
  *******************************************************************************/
  widgets['3D Bar Chart'] = {
    surfaces: [
      {
        color: 'black',
        points: [[ 0, 0,       0],
                 [ 0, 0, profit],
                 [10, 0, profit],
                 [10, 0,      0 ]],
      },
      {
        color: 'black',
        points: [[20, 0,       0],
                 [20, 0, profit],
                 [30, 0, profit],
                 [30, 0,      0 ]],
      },
      {
        color: \`rgba(0, 255, 0, 0.5)\`,
        points: [[ 0,      0, 0],
                 [ 0, profit, 0],
                 [10, profit, 0],
                 [10,      0, 0]],
      },
      {
        color: \`rgba(0, 255, 0, 0.5)\`,
        points: [[20,      0, 0],
                 [20, profit, 0],
                 [30, profit, 0],
                 [30,      0, 0]],
      },
    ],
    center: [15, 50, 0],
    is3d: true,
  }
`;

module.exports = model;

  return module.exports;
})();

modules['src/libraries/observable/utils.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

// Currently needs at least two arguments
const add$ = (...observables) => {
  const sum = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a + b);
  const sum$ = new Observable(sum);
  observables
    .filter(observable => observable instanceof Observable)
    .forEach(observable => {
      window.addEventListener(observable.id, ({ detail }) => {
        const sum = observables
          .map(observable =>
            observable instanceof Observable ? observable.value : observable
          )
          .reduce((a, b) => a + b);
        sum$.value = sum;
      });
    });
  return sum$;
};

// Currently needs at least two arguments
const subtract$ = (...observables) => {
  const difference = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a - b);
  const difference$ = new Observable(difference);
  observables.forEach(observable => {
    window.addEventListener(observable.id, ({ detail }) => {
      const difference = observables
        .map(observable =>
          observable instanceof Observable ? observable.value : observable
        )
        .reduce((a, b) => a - b);
      difference$.value = difference;
    });
  });
  return difference$;
};

// Currently needs at least two arguments
const multiply$ = (...observables) => {
  const product = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a * b);
  const product$ = new Observable(product);
  observables.forEach(observable => {
    window.addEventListener(observable.id, ({ detail }) => {
      const product = observables
        .map(observable =>
          observable instanceof Observable ? observable.value : observable
        )
        .reduce((a, b) => a * b);
      product$.value = product;
    });
  });
  return product$;
};

// Currently needs at least two arguments
const divide$ = (...observables) => {
  const quotient = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a / b);
  const quotient$ = new Observable(quotient);
  observables.forEach(observable => {
    window.addEventListener(observable.id, ({ detail }) => {
      const quotient = observables
        .map(observable =>
          observable instanceof Observable ? observable.value : observable
        )
        .reduce((a, b) => a / b);
      quotient$.value = quotient;
    });
  });
  return quotient$;
};

const choose$ = (observable, option1, option2) => {
  const result$ = new Observable(
    (observable instanceof Observable
    ? observable.value
    : observable)
      ? option1 instanceof Observable
        ? option1.value
        : option1
      : option2 instanceof Observable
      ? option2.value
      : option2
  );
  [observable, option1, option2]
    .filter(observable => observable instanceof Observable)
    .forEach(observable => {
      window.addEventListener(observable.id, ({ detail }) => {
        // TODO: Make it possible to set a specific child of an observable
        result$.value = (observable instanceof Observable
        ? observable.value
        : observable)
          ? option1 instanceof Observable
            ? option1.value
            : option1
          : option2 instanceof Observable
          ? option2.value
          : option2;
      });
    });
  return result$;
};

const cond$ = (...clauses) => {
  const result = clauses
    .map(([test, expression]) => [
      test instanceof Observable ? test.value : test,
      expression instanceof Observable ? expression.value : expression,
    ])
    .reduce((result, [test, expression]) => {
      if (result !== null) return result;
      if (test) return expression;
      return null;
    }, null);

  const result$ = new Observable(result);

  clauses
    .flat()
    .filter(testOrExpression => testOrExpression instanceof Observable)
    .forEach(testOrExpression => {
      window.addEventListener(testOrExpression.id, ({ detail }) => {
        const result = clauses
          .map(([test, expression]) => [
            test instanceof Observable ? test.value : test,
            expression instanceof Observable ? expression.value : expression,
          ])
          .reduce((result, [test, expression]) => {
            if (result !== null) return result;
            if (test) return expression;
            return null;
          }, null);
        result$.value = result;
      });
    });

  return result$;
};

const eq$ = (...observables) => {
  const equality = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .every((element, _, array) => element === array[0]);
  const equality$ = new Observable(equality);
  observables.forEach(observable => {
    window.addEventListener(observable.id, ({ detail }) => {
      const equality = observables
        .map(observable =>
          observable instanceof Observable ? observable.value : observable
        )
        .every((element, _, array) => element === array[0]);
      equality$.value = equality;
    });
  });
  return equality$;
};

const and$ = (...observables) => {
  const allTruthy = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .every(Boolean);
  const allTruthy$ = new Observable(allTruthy);
  observables.forEach(observable => {
    window.addEventListener(observable.id, ({ detail }) => {
      const allTruthy = observables
        .map(observable =>
          observable instanceof Observable ? observable.value : observable
        )
        .every(Boolean);
      allTruthy$.value = allTruthy;
    });
  });
  return allTruthy$;
};

const or$ = (...observables) => {
  const someTruthy = observables
    .map(observable =>
      observable instanceof Observable ? observable.value : observable
    )
    .some(Boolean);
  const someTruthy$ = new Observable(someTruthy);
  observables
    .filter(observable => observable instanceof Observable)
    .forEach(observable => {
      window.addEventListener(observable.id, ({ detail }) => {
        const someTruthy = observables
          .map(observable =>
            observable instanceof Observable ? observable.value : observable
          )
          .some(Boolean);
        someTruthy$.value = someTruthy;
      });
    });
  return someTruthy$;
};

const not$ = observable => {
  const conditional =
    observable instanceof Observable ? observable.value : observable;
  const opposite$ = new Observable(!conditional);
  if (observable instanceof Observable) {
    window.addEventListener(observable.id, ({ detail }) => {
      opposite$.value = !detail;
    });
  }
  return opposite$;
};

const toFixed$ = (number$, decimals$) => {
  const number = number$ instanceof Observable ? number$.value : number$;
  const decimals =
    decimals$ instanceof Observable ? decimals$.value : decimals$;
  const formattedNumber = number.toFixed(decimals);
  const formattedNumber$ = new Observable(formattedNumber);
  [number$, decimals$]
    .filter(observable => observable instanceof Observable)
    .forEach(observable => {
      window.addEventListener(observable.id, ({ detail }) => {
        const number = number$ instanceof Observable ? number$.value : number$;
        const decimals =
          decimals$ instanceof Observable ? decimals$.value : decimals$;
        const formattedNumber = number.toFixed(decimals);
        formattedNumber$.value = formattedNumber;
      });
    });
  return formattedNumber$;
};

module.exports = {
  add$,
  subtract$,
  multiply$,
  divide$,
  choose$,
  cond$,
  eq$,
  and$,
  or$,
  not$,
  toFixed$,
};

  return module.exports;
})();

modules['src/libraries/observableHtml/ObservableHtml.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

const createElement$ = (elementType, ...observables) => {
  const element = document.createElement(elementType);
  observables.forEach(observable => {
    if (
      // If it is observable value
      observable instanceof Observable &&
      ['string', 'number'].includes(typeof observable.value)
    ) {
      const textNode = document.createTextNode(observable.value);
      element.appendChild(textNode);
      window.addEventListener(observable.id, ({ detail }) => {
        textNode.nodeValue = detail;
      });
      return;
    }
    if (
      // If it is non-observable value
      ['string', 'number'].includes(typeof observable)
    ) {
      const textNode = document.createTextNode(observable);
      element.appendChild(textNode);
      return;
    }
    // If it is a dom node
    element.appendChild(observable);
  });
  // Note that styleObject$ is an object with observable values, not an observable object
  // TODO: It should also be possible to set the style as a non-observable object
  element.setStyle = styleObject$ => {
    Object.entries(styleObject$).forEach(([styleProperty, styleValue$]) => {
      if (styleValue$ instanceof Observable) {
        element.style[styleProperty] = styleValue$.value;
        window.addEventListener(styleValue$.id, ({ detail }) => {
          element.style[styleProperty] = detail;
        });
        return;
      }
      element.style[styleProperty] = styleValue$;
    });
    return element;
  };
  element.setProps = propsObject => {
    Object.entries(propsObject).forEach(([propKey, propValue$]) => {
      if (propValue$ instanceof Observable) {
        element[propKey] = propValue$.value;
        window.addEventListener(propValue$.id, ({ detail }) => {
          element[propKey] = detail;
        });
        return;
      }
      element[propKey] = propValue$;
    });
    return element;
  };
  element.onClick = clickCallback => {
    element.style.cursor = 'pointer';
    element.onclick = () => clickCallback(element);
    return element;
  };
  element.onMouseEnter = mouseEnterCallback => {
    element.onmouseenter = () => mouseEnterCallback(element);
    return element;
  };
  element.onMouseLeave = mouseLeaveCallback => {
    element.onmouseleave = () => mouseLeaveCallback(element);
    return element;
  };
  element.onInput = inputCallback => {
    element.oninput = () => inputCallback(element);
    return element;
  };
  element.onChange = changeCallback => {
    element.onchange = () => changeCallback(element);
    return element;
  };
  return element;
};
const div$ = (...children) => createElement$('div', ...children);
const h1$ = (...children) => createElement$('h1', ...children);
const textArea$ = (value = '') =>
  createElement$('textarea').setProps({ value });
const br$ = () => createElement('br');
const select$ = (...children) => createElement$('select', ...children);
const button$ = (...children) => createElement$('button', ...children);
const option$ = ({ value, label }) =>
  createElement$('option', label).setProps({ value });
const input$ = (value = '') => createElement$('input').setProps({ value });
const canvas$ = ({ width, height }) => {
  const element = createElement$('canvas');
  element.width = width;
  element.height = height;
  return element;
};

module.exports = {
  createElement$,
  div$,
  h1$,
  textArea$,
  br$,
  select$,
  button$,
  option$,
  input$,
  canvas$,
};

  return module.exports;
})();

modules['src/views/dataSources/DataSources.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const DataSourcesView$ = () => div$('DataSourcesView');

module.exports = DataSourcesView$;

  return module.exports;
})();

modules['src/libraries/styled/styled.js'] = (() => {
  const module = { exports: {} };
  const styled = style => Component => (...children) =>
  Component(...children).setStyle(style);

module.exports = styled;

  return module.exports;
})();

modules['src/libraries/observableHtml/utils.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const Choose$ = (observable, element1, element2) => {
  let element = (observable instanceof Observable
  ? observable.value
  : observable)
    ? element1
    : element2;
  if (observable instanceof Observable) {
    window.addEventListener(observable.id, ({ detail }) => {
      // TODO: Make it possible to set a specific child of an observable
      newElement = (observable instanceof Observable
      ? observable.value
      : observable)
        ? element1
        : element2;

      if (newElement !== element) {
        element.parentNode.replaceChild(newElement, element);
        element = newElement;
      }
    });
  }
  return element;
};

const Switch$ = (statement$, ...clauses) => {
  const cases = clauses.filter((_, i) => i % 2 === 0);
  const elements = clauses.filter((_, i) => i % 2 !== 0);
  return div$(
    ...cases.map((theCase, i) => {
      const element = elements[i];
      // Warning: Assumes that display is not initially dynamic
      const display = element.style.display;
      return element.setStyle({
        display: choose$(eq$(statement$, theCase), display, 'none'),
      });
    })
  );
};

const Nothing$ = styled({ display: 'none' })(div$);

const If$ = (observable, element) => Choose$(observable, element, Nothing$());

module.exports = {
  Choose$,
  Switch$,
  Nothing$,
  If$,
};

  return module.exports;
})();

modules['src/components/viewContainer/ViewContainer.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const ViewContainer$ = styled({
  position: 'absolute',
  top: '0',
  left: '64px',
  right: '0',
})(div$);

module.exports = ViewContainer$;

  return module.exports;
})();

modules['src/components/mainContainer/MainContainer.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const MainContainer$ = styled({
  height: 'calc(100% - 64px)',
  background: 'GhostWhite',
  position: 'absolute',
  left: '0',
  right: '0',
})(div$);

module.exports = MainContainer$;

  return module.exports;
})();

modules['src/components/viewTitle/ViewTitle.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const ViewTitle$ = styled({
  fontSize: '32px',
  padding: '16px',
})(div$);

module.exports = ViewTitle$;

  return module.exports;
})();

modules['src/styleWrappers/withShadow.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');

const withShadow = styled({
  boxShadow: 'rgba(0, 0, 0, 0.25) 0px 0px 8px -4px',
});

module.exports = withShadow;

  return module.exports;
})();

modules['src/components/horizontalNavigator/HorizontalNavigator.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const HorizontalNavigator$ = withShadow(styled({ height: '64px' })(div$));

module.exports = HorizontalNavigator$;

  return module.exports;
})();

modules['src/components/verticalNavigator/VerticalNavigator.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const VerticalNavigator$ = withShadow(
  styled({
    height: '100%',
    width: '64px',
    position: 'absolute',
  })(div$)
);

module.exports = VerticalNavigator$;

  return module.exports;
})();

modules['src/components/leftNavigatorButton/atoms.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const Button$ = styled({
  height: '64px',
  width: '64px',
  overflow: 'hidden',
  transition: '0.5s',
  cursor: 'pointer',
})(div$);
const Icon$ = styled({
  ///TODO: continue
  fontSize: '30px',
  textAlign: 'center',
  marginTop: '15px',
  pointerEvents: 'none',
  userSelect: 'none',
})(div$);
const Label$ = styled({
  fontSize: '15px',
  textAlign: 'center',
  pointerEvents: 'none',
  userSelect: 'none',
})(div$);

module.exports = {
  Button$,
  Icon$,
  Label$,
};

  return module.exports;
})();

modules['src/components/leftNavigatorButton/LeftNavigatorButton.js'] = (() => {
  const module = { exports: {} };
  const { choose$ } = include('src/libraries/observable/utils.js');

const { Button$, Icon$, Label$ } = include(
  'src/components/leftNavigatorButton/atoms.js'
);
const LeftNavigatorButton$ = ({
  icon,
  label,
  route,
  isActive$,
  labelColor$,
  highlightLabelColor$,
  backgroundColor$,
  highlightBackgroundColor$,
}) => {
  return Button$(Icon$(icon), Label$(label))
    .setStyle({
      background: choose$(
        isActive$,
        highlightBackgroundColor$,
        backgroundColor$
      ),
      color: choose$(isActive$, highlightLabelColor$, labelColor$),
    })
    .onMouseEnter(element => {
      element.setStyle({
        background: highlightBackgroundColor$,
        color: highlightLabelColor$,
      });
    })
    .onMouseLeave(element => {
      element.setStyle({
        background: choose$(
          isActive$,
          highlightBackgroundColor$,
          backgroundColor$
        ),
        color: choose$(isActive$, highlightLabelColor$, labelColor$),
      });
    })
    .onClick(() => (location.hash = `#!${route}`));
};

module.exports = LeftNavigatorButton$;

  return module.exports;
})();

modules['src/views/home/projectPreview/ProjectPreview.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const ProjectPreview$ = styled({
  height: '64px',
  padding: '16px',
  margin: '16px',
  fontSize: '16px',
  background: 'white',
  boxShadow: 'rgba(0, 0, 0, 0.25) 0px 0px 8px -4px',
})(div$);

module.exports = ProjectPreview$;

  return module.exports;
})();

modules['src/views/home/Home.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const ProjectPreview$ = include(
  'src/views/home/projectPreview/ProjectPreview.js'
);

const Home$ = ({ model }) =>
  div$(...model.projects.value.map(({ name }) => ProjectPreview$(name)));

module.exports = Home$;

  return module.exports;
})();

modules['src/components/codeEditor/CodeEditor.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { textArea$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const CodeEditor$ = styled({
  width: '100%',
  height: 'calc(100vh - 128px)',
  padding: '20px',
  background: 'black',
  color: 'white',
  fontFamily: '"Courier New", Courier, monospace',
  fontSize: '14px',
  lineHeight: '20px',
  whiteSpace: 'nowrap',
})(textArea$);

module.exports = CodeEditor$;

  return module.exports;
})();

modules['src/components/expandCodeEditorButton/ExpandCodeEditorButton.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { choose$ } = include('src/libraries/observable/utils.js');

const ExpandCodeEditorButton$ = ({ icon, label$, isOpen$ }) => {
  const isHovered$ = new Observable(false);
  return div$(
    div$(choose$(isOpen$, 'âˆ’', '+')).setStyle({
      fontSize: '30px',
      textAlign: 'center',
      marginTop: '15px',
      pointerEvents: 'none',
      userSelect: 'none',
      transform: choose$(isOpen$, 'rotate(180deg)', 'rotate(0deg)'),
      transition: '0.5s',
    })
  )
    .setStyle({
      position: 'absolute',
      background: choose$(isHovered$, 'dodgerblue', 'royalblue'),
      borderRadius: '50%',
      color: 'white',
      height: '60px',
      width: '60px',
      margin: '10px',
      overflow: 'hidden',
      transition: '0.5s',
      cursor: 'pointer',
      zIndex: '1',
    })
    .onMouseEnter(element => {
      isHovered$.value = true;
    })
    .onMouseLeave(element => {
      isHovered$.value = false;
    });
};

module.exports = ExpandCodeEditorButton$;

  return module.exports;
})();

modules['src/components/widgetLabel/WidgetLabel.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const WidgetLabel$ = ({ label$ }) =>
  div$(label$).setStyle({
    fontSize: '20px',
    marginTop: '20px',
    textAlign: 'center',
    position: 'absolute',
    width: '100%',
  });

module.exports = WidgetLabel$;

  return module.exports;
})();

modules['src/components/widgetValue/WidgetValue.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { toFixed$ } = include('src/libraries/observable/utils.js');

const WidgetValue$ = ({ value$ }) =>
  div$(toFixed$(value$, 2)).setStyle({
    fontSize: '60px',
    textAlign: 'center',
    width: '100%',
    position: 'absolute',
    top: '50%',
    transform: 'translate(0, -50%)',
  });

module.exports = WidgetValue$;

  return module.exports;
})();

modules['src/components/widgetCard/WidgetCard.js'] = (() => {
  const module = { exports: {} };
  const withShadow = include('src/styleWrappers/withShadow.js');
const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { add$ } = include('src/libraries/observable/utils.js');

const WidgetCard$ = ({ width$, height$ }) =>
  styled({
    margin: '20px',
    width: add$(width$, 'px'),
    height: add$(height$, 'px'),
    display: 'inline-block',
    boxSizing: 'border-box',
    verticalAlign: 'top',
    background: 'white',
  })(div$);

module.exports = WidgetCard$;

  return module.exports;
})();

modules['src/components/widgetCard/SmallWidgetCard.js'] = (() => {
  const module = { exports: {} };
  const WidgetCard$ = include('src/components/widgetCard/WidgetCard.js');

const SmallWidgetCard$ = WidgetCard$({ height$: 240, width$: 360 });

module.exports = SmallWidgetCard$;

  return module.exports;
})();

modules['src/components/valueWidget/ValueWidget.js'] = (() => {
  const module = { exports: {} };
  const WidgetLabel$ = include('src/components/widgetLabel/WidgetLabel.js');
const WidgetValue$ = include('src/components/widgetValue/WidgetValue.js');
const SmallWidgetCard$ = include(
  'src/components/widgetCard/SmallWidgetCard.js'
);
const { not$ } = include('src/libraries/observable/utils.js');
const { If$ } = include('src/libraries/observableHtml/utils.js');
const withShadow = include('src/styleWrappers/withShadow.js');

const ValueWidget$ = ({ label$, value$, isEmpty$ }) =>
  If$(
    not$(isEmpty$),
    withShadow(SmallWidgetCard$)(
      WidgetLabel$({ label$ }),
      WidgetValue$({ value$ })
    ).setStyle({ position: 'relative', color: 'dimgray' })
  );

module.exports = ValueWidget$;

  return module.exports;
})();

modules['src/views/values/Values.js'] = (() => {
  const module = { exports: {} };
  const CodeEditor$ = include('src/components/codeEditor/CodeEditor.js');
const ExpandCodeEditorButton$ = include(
  'src/components/expandCodeEditorButton/ExpandCodeEditorButton.js'
);
const ValueWidget$ = include('src/components/valueWidget/ValueWidget.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { eq$, choose$ } = include('src/libraries/observable/utils.js');

const Values$ = ({ model, currentRoute$ }) => {
  const codeEditorIsOpen$ = eq$(currentRoute$, '/values/edit');
  return div$(
    ExpandCodeEditorButton$({
      icon: '{}',
      label$: choose$(codeEditorIsOpen$, 'Hide editor', 'Show editor'),
      isOpen$: codeEditorIsOpen$,
    }).onClick(() => {
      location.hash = codeEditorIsOpen$.value ? '#!/values' : '#!/values/edit';
    }),
    div$(
      CodeEditor$(model.derivedValuesCode$)
        .onInput(({ value }) => {
          model.derivedValuesCode$.value = value;
        })
        .setStyle({ paddingLeft: '80px' })
    ).setStyle({
      display: 'inline-block',
      width: choose$(codeEditorIsOpen$, '50%', '0'),
      transition: '0.5s',
      overflow: 'hidden',
    }),
    div$(
      div$(
        ...model.derivedValues.map(({ label$, value$, isEmpty$ }) =>
          ValueWidget$({ label$, value$, isEmpty$ })
        )
      ).setStyle({ position: 'relative', top: '0' })
    ).setStyle({
      display: 'inline-block',
      position: 'absolute',
      paddingLeft: choose$(codeEditorIsOpen$, '0', '80px'),
      transition: '0.5s',
    })
  ).setStyle({ width: '100%' });
};

module.exports = Values$;

  return module.exports;
})();

modules['src/components/widgetCard/MediumWidgetCard.js'] = (() => {
  const module = { exports: {} };
  const WidgetCard$ = include('src/components/widgetCard/WidgetCard.js');

const MediumWidgetCard$ = WidgetCard$({ height$: 320, width$: 480 });

module.exports = MediumWidgetCard$;

  return module.exports;
})();

modules['src/components/visualization/threeDimVisualization/camera/Camera.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

const Camera = function({
  target = new Observable([0, 0, 0]),
  horizontalRotation$ = new Observable(0),
  verticalRotation$ = new Observable(0),
  distance$ = new Observabe(100),
  focalLength$ = new Observable(100),
}) {
  this.target = target;
  this.horizontalRotation$ = horizontalRotation$;
  this.verticalRotation$ = new Observable(
    Math.max(Math.min(verticalRotation$.value, Math.PI / 4), -Math.PI / 2)
  );
  this.distance$ = new Observable(
    Math.max(distance$.value, -focalLength$.value / 2)
  );
  this.focalLength$ = focalLength$;
  this.setDistance = distance => {
    this.distance$.value = Math.max(distance, -focalLength$.value / 2);
  };
  this.setVerticalRotation = verticalRotation => {
    this.verticalRotation$.value = Math.max(
      Math.min(verticalRotation, Math.PI / 2),
      -Math.PI / 2
    );
  };
};

module.exports = Camera;

  return module.exports;
})();

modules['src/components/visualization/render/toCenterOfWidget/toCenterOfWidget.js'] = (() => {
  const module = { exports: {} };
  const toCenterOfWidget = ([x, y, z], ctx) => [
  x + ctx.canvas.width / 2,
  y - ctx.canvas.height / 2,
  z,
];

module.exports = toCenterOfWidget;

  return module.exports;
})();

modules['src/components/visualization/render/toPerspective/toPerspective.js'] = (() => {
  const module = { exports: {} };
  const toPerspective = ([x, y, z], d, focalLength) =>
  focalLength
    ? [
        x * (focalLength / (d + focalLength + z)),
        y * (focalLength / (d + focalLength + z)),
        z,
      ]
    : [x, y, z];

module.exports = toPerspective;

  return module.exports;
})();

modules['src/components/visualization/render/toCenterOfStructure/toCenterOfStructure.js'] = (() => {
  const module = { exports: {} };
  const toCenterOfStructure = ([x, y, z], transformedCenterOfStructure) => [
  x - transformedCenterOfStructure[0],
  y - transformedCenterOfStructure[1],
  z - transformedCenterOfStructure[2],
];

module.exports = toCenterOfStructure;

  return module.exports;
})();

modules['src/components/visualization/render/rotate/rotate.js'] = (() => {
  const module = { exports: {} };
  const rotate = ([x, y, z], rx, ry) => {
  const theta = rx;
  const phi = ry;

  const horizontallyRotatedVertex = [
    x * Math.cos(theta) + z * Math.sin(theta),
    y,
    z * Math.cos(theta) - x * Math.sin(theta),
  ];

  return [
    horizontallyRotatedVertex[0],
    horizontallyRotatedVertex[1] * Math.cos(phi) -
      horizontallyRotatedVertex[2] * Math.sin(phi),
    horizontallyRotatedVertex[1] * Math.sin(phi) +
      horizontallyRotatedVertex[2] * Math.cos(phi),
  ];
};

module.exports = rotate;

  return module.exports;
})();

modules['src/components/visualization/render/render.js'] = (() => {
  const module = { exports: {} };
  const toCenterOfWidget = include(
  'src/components/visualization/render/toCenterOfWidget/toCenterOfWidget.js'
);
const toPerspective = include(
  'src/components/visualization/render/toPerspective/toPerspective.js'
);
const toCenterOfStructure = include(
  'src/components/visualization/render/toCenterOfStructure/toCenterOfStructure.js'
);
const rotate = include('src/components/visualization/render/rotate/rotate.js');

/**
 * @param {number} dx
 * Defines the x coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} dy
 * Defines the y coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} dz
 * Defines the z coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} d
 * Defines the distance from the defined center of the structure, to the
 * camera.
 */
const render = (
  surfaces$,
  edges$,
  ctx,
  center,
  rx = 0,
  ry = 0,
  d = 0,
  focalLength = 0
) => {
  // Render the faces
  surfaces$.value.forEach(({ color, points }) => {
    points
      .map(point => toCenterOfStructure(point, center))
      .map(point => rotate(point, rx, ry))
      .map(point => toPerspective(point, d, focalLength))
      .map(point => toCenterOfWidget(point, ctx))
      .forEach((point, index) => {
        if (index === 0) {
          ctx.beginPath();
          ctx.moveTo(point[0], -point[1]);
          return;
        }
        if (index < points.length - 1) {
          ctx.lineTo(point[0], -point[1]);
          return;
        }
        if (index === points.length - 1) {
          ctx.lineTo(point[0], -point[1]);
          ctx.closePath();
          ctx.fillStyle = color;
          ctx.fill();
          return;
        }
      });
  });

  // Render the edges
  edges$.value.forEach(({ color, points, width }) => {
    // Draw the first vertex
    const startPoint = toCenterOfWidget(
      toPerspective(
        rotate(toCenterOfStructure(points[0], center), rx, ry),
        d,
        focalLength
      ),

      ctx
    );
    const endPoint = toCenterOfWidget(
      toPerspective(
        rotate(toCenterOfStructure(points[1], center), rx, ry),
        d,
        focalLength
      ),
      ctx
    );
    ctx.beginPath();
    ctx.lineCap = 'round';
    ctx.moveTo(startPoint[0], -startPoint[1]);
    ctx.lineTo(endPoint[0], -endPoint[1]);
    ctx.lineWidth = width;
    ctx.strokeStyle = color;
    ctx.stroke();
  });
};

module.exports = render;

  return module.exports;
})();

modules['src/components/visualization/threeDimVisualization/ThreeDimVisualization.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const { canvas$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const Camera = include(
  'src/components/visualization/threeDimVisualization/camera/Camera.js'
);
const render = include('src/components/visualization/render/render.js');

const ThreeDimVisualization$ = ({ surfaces$, edges$, center$ }) => {
  const state = { mouseDown: false };
  const canvas = canvas$({ height: 280, width: 440 }).setStyle({
    position: 'absolute',
  });
  const camera = new Camera({
    target: center$,
    horizontalRotation$: new Observable(0),
    verticalRotation$: new Observable(0),
    distance$: new Observable(100),
    focalLength$: new Observable(100),
  });
  const ctx = canvas.getContext('2d');
  const rerender = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    render(
      surfaces$,
      edges$,
      ctx,
      camera.target.value,
      camera.horizontalRotation$.value,
      camera.verticalRotation$.value,
      camera.distance$.value,
      camera.focalLength$.value
    );
  };
  rerender();
  canvas.onwheel = event => {
    camera.setDistance(camera.distance$.value + event.deltaY / 5);
  };
  window.addEventListener('mousedown', event => {
    state.mouseDown = true;
  });
  window.addEventListener(
    'mouseup',
    (canvas.onmouseup = event => {
      state.mouseDown = false;
    })
  );
  canvas.onmousemove = event => {
    if (state.mouseDown) {
      camera.horizontalRotation$.value =
        camera.horizontalRotation$.value - event.movementX / 100;
      camera.setVerticalRotation(
        camera.verticalRotation$.value - event.movementY / 100
      );
    }
  };
  window.addEventListener(camera.horizontalRotation$.id, () => rerender());
  window.addEventListener(camera.verticalRotation$.id, () => rerender());
  window.addEventListener(camera.distance$.id, () => rerender());
  window.addEventListener(camera.focalLength$.id, () => rerender());
  window.addEventListener(surfaces$.id, () => rerender());
  window.addEventListener(edges$.id, () => rerender());
  window.addEventListener(center$.id, () => rerender());
  return canvas;
};

module.exports = ThreeDimVisualization$;

  return module.exports;
})();

modules['src/components/visualization/twoDimVisualization/TwoDimVisualization.js'] = (() => {
  const module = { exports: {} };
  const { canvas$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const render = include('src/components/visualization/render/render.js');

const TwoDimVisualization$ = ({ surfaces$, edges$, center$ }) => {
  const canvas = canvas$({ height: 280, width: 440 }).setStyle({
    position: 'absolute',
  });
  const ctx = canvas.getContext('2d');
  const rerender = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    render(surfaces$, edges$, ctx, center$.value);
  };
  rerender();
  window.addEventListener(surfaces$.id, () => rerender());
  window.addEventListener(edges$.id, () => rerender());
  window.addEventListener(center$.id, () => rerender());
  return canvas;
};

module.exports = TwoDimVisualization$;

  return module.exports;
})();

modules['src/components/canvasWidget/CanvasWidget.js'] = (() => {
  const module = { exports: {} };
  const MediumWidgetCard$ = include(
  'src/components/widgetCard/MediumWidgetCard.js'
);
const ThreeDimVisualization$ = include(
  'src/components/visualization/threeDimVisualization/ThreeDimVisualization.js'
);
const TwoDimVisualization$ = include(
  'src/components/visualization/twoDimVisualization/TwoDimVisualization.js'
);
const WidgetLabel$ = include('src/components/widgetLabel/WidgetLabel.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { not$ } = include('src/libraries/observable/utils.js');
const { Choose$, If$ } = include('src/libraries/observableHtml/utils.js');

const CanvasWidget$ = ({
  label$,
  surfaces$,
  edges$,
  center$,
  is3d$,
  isEmpty$,
}) => {
  return If$(
    not$(isEmpty$),
    withShadow(MediumWidgetCard$)(
      Choose$(
        is3d$,
        ThreeDimVisualization$({ surfaces$, edges$, center$ }),
        TwoDimVisualization$({ surfaces$, edges$, center$ })
      ),
      WidgetLabel$({ label$ })
    ).setStyle({
      position: 'relative',
      color: 'dimgray',
    })
  );
};

module.exports = CanvasWidget$;

  return module.exports;
})();

modules['src/views/dashboards/Dashboards.js'] = (() => {
  const module = { exports: {} };
  const CodeEditor$ = include('src/components/codeEditor/CodeEditor.js');
const ExpandCodeEditorButton$ = include(
  'src/components/expandCodeEditorButton/ExpandCodeEditorButton.js'
);
const CanvasWidget$ = include('src/components/canvasWidget/CanvasWidget.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { eq$, choose$ } = include('src/libraries/observable/utils.js');

const Dashboards$ = ({ model, currentRoute$ }) => {
  const codeEditorIsOpen$ = eq$(currentRoute$, '/dashboards/edit');
  return div$(
    ExpandCodeEditorButton$({
      icon: '+',
      label$: choose$(codeEditorIsOpen$, 'Hide editor', 'Show editor'),
      isOpen$: codeEditorIsOpen$,
    }).onClick(() => {
      location.hash = codeEditorIsOpen$.value
        ? '#!/dashboards'
        : '#!/dashboards/edit';
    }),
    div$(
      CodeEditor$(model.widgetsCode$)
        .onInput(({ value }) => {
          model.widgetsCode$.value = value;
        })
        .setStyle({ paddingLeft: '80px' })
    ).setStyle({
      display: 'inline-block',
      width: choose$(codeEditorIsOpen$, '50%', '0'),
      transition: '0.5s',
      overflow: 'hidden',
    }),
    div$(
      div$(
        ...model.widgets.map(
          ({ label$, surfaces$, edges$, is3d$, center$, isEmpty$ }) =>
            CanvasWidget$({
              label$,
              surfaces$,
              edges$,
              is3d$,
              center$,
              isEmpty$,
            })
        )
      ).setStyle({
        position: 'relative',
        top: '0',
      })
    ).setStyle({
      display: 'inline-block',
      position: 'absolute',
      paddingLeft: choose$(codeEditorIsOpen$, '0', '80px'),
      transition: '0.5s',
    })
  ).setStyle({ width: '100%' });
};

module.exports = Dashboards$;

  return module.exports;
})();

modules['src/App.js'] = (() => {
  const module = { exports: {} };
  const { cond$, eq$, or$ } = include('src/libraries/observable/utils.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { If$ } = include('src/libraries/observableHtml/utils.js');

const HorizontalNavigator$ = include(
  'src/components/horizontalNavigator/HorizontalNavigator.js'
);
const LeftNavigatorButton$ = include(
  'src/components/leftNavigatorButton/LeftNavigatorButton.js'
);
const VerticalNavigator$ = include(
  'src/components/verticalNavigator/VerticalNavigator.js'
);
const ViewContainer$ = include('src/components/viewContainer/ViewContainer.js');
const MainContainer$ = include('src/components/mainContainer/MainContainer.js');
const ViewTitle$ = include('src/components/viewTitle/ViewTitle.js');
const Home$ = include('src/views/home/Home.js');
const DataSources$ = include('src/views/dataSources/DataSources.js');
const AlertsView$ = () => div$('AlertsView');

const Values$ = include('src/views/values/Values.js');

const Dashboards$ = include('src/views/dashboards/Dashboards.js');

const getViewTitle$ = currentRoute$ =>
  cond$(
    [eq$(currentRoute$, '/'), 'Projects'],
    [eq$(currentRoute$, '/data-sources'), 'Data sources'],
    [eq$(currentRoute$, '/values'), 'Values'],
    [eq$(currentRoute$, '/dashboards'), 'Dashboards'],
    [eq$(currentRoute$, '/dashboards/edit'), 'Edit dashboards'],
    [eq$(currentRoute$, '/alerts'), 'Alerts']
  );

const App = ({ currentRoute$, model }) => {
  const element = div$(
    HorizontalNavigator$().setStyle({ background: 'black' }),
    MainContainer$(
      VerticalNavigator$(
        LeftNavigatorButton$({
          icon: 'ðŸ ',
          label: getViewTitle$('/'),
          route: '/',
          isActive$: eq$(currentRoute$, '/'),
          labelColor$: 'whitesmoke',
          highlightLabelColor$: 'white',
          backgroundColor$: 'lightslategray',
          highlightBackgroundColor$: 'slategray',
        }),
        LeftNavigatorButton$({
          icon: 'ðŸ—',
          label: getViewTitle$('/data-sources'),
          route: '/data-sources',
          isActive$: eq$(currentRoute$, '/data-sources'),
          labelColor$: 'whitesmoke',
          highlightLabelColor$: 'white',
          backgroundColor$: 'lightslategray',
          highlightBackgroundColor$: 'slategray',
        }),
        LeftNavigatorButton$({
          icon: 'ðŸ§®',
          label: getViewTitle$('/values'),
          route: '/values',
          isActive$: or$(
            eq$(currentRoute$, '/values'),
            eq$(currentRoute$, '/values/edit')
          ),
          labelColor$: 'whitesmoke',
          highlightLabelColor$: 'white',
          backgroundColor$: 'lightslategray',
          highlightBackgroundColor$: 'slategray',
        }),
        LeftNavigatorButton$({
          icon: 'ðŸ“Š',
          label: getViewTitle$('/dashboards'),
          route: '/dashboards',
          isActive$: or$(
            eq$(currentRoute$, '/dashboards'),
            eq$(currentRoute$, '/dashboards/edit')
          ),
          labelColor$: 'whitesmoke',
          highlightLabelColor$: 'white',
          backgroundColor$: 'lightslategray',
          highlightBackgroundColor$: 'slategray',
        }),
        LeftNavigatorButton$({
          icon: 'â°',
          label: getViewTitle$('/alerts'),
          route: '/alerts',
          isActive$: eq$(currentRoute$, '/alerts'),
          labelColor$: 'whitesmoke',
          highlightLabelColor$: 'white',
          backgroundColor$: 'lightslategray',
          highlightBackgroundColor$: 'slategray',
        })
      ).setStyle({ background: 'lightslategrey' }),
      // Not sure I'm happy about this solution
      ViewContainer$(
        HorizontalNavigator$(ViewTitle$(getViewTitle$(currentRoute$))).setStyle(
          {
            background: 'white',
          }
        ),
        If$(eq$(currentRoute$, '/'), Home$({ model })),
        If$(eq$(currentRoute$, '/data-sources'), DataSources$()),
        If$(
          or$(
            eq$(currentRoute$, '/values'), // Hack, for some reason the code editor animation doesn't work without this
            eq$(currentRoute$, '/values/edit'),
            eq$(currentRoute$, '/values')
          ),
          Values$({ model, currentRoute$ })
        ),
        If$(
          or$(
            eq$(currentRoute$, '/dashboards'), // Hack, for some reason the code editor animation doesn't work without this
            eq$(currentRoute$, '/dashboards/edit'),
            eq$(currentRoute$, '/dashboards')
          ),
          Dashboards$({ model, currentRoute$ })
        ),
        If$(eq$(currentRoute$, '/alerts'), AlertsView$())
      )
    )
  );

  return element;
};

module.exports = App;

  return module.exports;
})();

window.addEventListener('load', () => {
const Router = include('src/libraries/router/Router.js');
const model = include('src/model/Model.js');
const App = include('src/App.js');

Object.assign(document.body.style, {
  margin: 0,
  fontFamily: 'sans-serif',
  height: '100%',
});
//const FIREBASE_API_KEY = 'AIzaSyCeGXLqw0MEwiSFHG1Wks1HfQHXRZoOuFY';

// Create router
const router = new Router({
  '/': 'Projects',
  '/data-sources': 'Data sources',
  '/values': 'Values',
  '/values/edit': 'Edit values',
  '/analytics/<analyticId:string>': 'Analytics',
  // TODO: It should be possible to have multiple dashboards
  '/dashboards': 'Dashboards',
  '/dashboards/edit': 'Edit dashboards',
  '/dashboards/<widgetId:string>/edit': 'Edit widget',
  '/alerts': 'Alerts',
});

document.body.appendChild(
  App({
    model,
    params: router.getParams,
    currentRoute$: router.currentRoute$,
  })
);
document.body.update = props =>
  document.body.childNodes.forEach(childNode => {
    if (typeof childNode.update === 'function') {
      childNode.update(props);
    }
  });

router.subscribe(() => document.body.update());

})
</script>
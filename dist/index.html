
<meta charset="utf-8" />
<script>
const modules = {}
const include = path => modules[path];

modules['src/libraries/observable/Observable.js'] = (() => {
  const module = { exports: {} };
  class Observable {
  constructor(value) {
    // Maybe this can cause an id collision of two observables created almost at the same time
    this._id = `${Math.random()}${+new Date()}`;
    this._value = value;
  }
  emit() {
    window.dispatchEvent(
      new CustomEvent(this._id, {
        detail: this._value,
      })
    );
  }
  get id() {
    return this._id;
  }
  get value() {
    return this._value;
  }
  set value(value) {
    // Maybe this should do a deep compare in case value is an object?
    if (value === this._value) return;
    this._value = value;
    this.emit();
  }
}

module.exports = Observable;

  return module.exports;
})();

modules['src/libraries/router/Router.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

function Router(routes) {
  /**
   * @param {string} routes
   */
  this.setRoutes = function(routes) {
    Object.entries(routes).forEach(([route, title]) => {
      this.routes[route] = route;
      this.titles[route] = title;
      if (route === '/') {
        this.routes[''] = route;
        this.titles[''] = title;
      }
    });
    this.syncWithHash();
  };
  Router.getTokens = function(hash) {
    return hash
      .split('/')
      .filter(Boolean)
      .filter(element => element !== '#')
      .filter(element => element !== '#!');
  };
  /**
   * @param {string} token
   * @returns {boolean}
   */
  Router.isParameterRouteToken = function(token) {
    if (
      token.indexOf('<') !== 0 ||
      !token.slice(2, -4).includes(':') ||
      token.indexOf('>') !== token.length - 1
    ) {
      return false;
    }
    const [parameter, type] = token
      .slice(token.indexOf('<') + 1, token.indexOf('>'))
      .split(':');

    if (!['int', 'string', 'number'].includes(type)) {
      return false;
    }
    return true;
  };
  Router.appendTokenToHash = function(hash, token) {
    return `${hash}/${token}`;
  };
  Router.parseParameterRouteToken = function(token) {
    const [parameter, type] = token
      .slice(token.indexOf('<') + 1, token.indexOf('>'))
      .split(':');
    return {
      parameter,
      type,
    };
  };
  // (hash: string, route: string) => false | { [key: string]: number | string }
  Router.getMatch = function(hash, route) {
    const hashTokens = Router.getTokens(hash);
    const routeTokens = Router.getTokens(route);
    const params = {};
    let reconstructedHash = '#!';
    if (hashTokens.length !== routeTokens.length) return false;
    for (let i of Object.keys(hashTokens)) {
      const hashToken = hashTokens[i];
      const routeToken = routeTokens[i];
      if (Router.isParameterRouteToken(routeToken)) {
        const { parameter, type } = Router.parseParameterRouteToken(routeToken);
        if (type === 'int') {
          if (!Router.isInt(hashToken)) return false;
          params[parameter] = parseInt(hashToken);
          reconstructedHash = Router.appendTokenToHash(
            reconstructedHash,
            hashToken
          );
        } else if (type === 'number' && !Router.isNumber(hasToken)) {
          if (!Router.isNumber(hashToken)) return false;
          params[parameter] = Number(hashToken);
          reconstructedHash = Router.appendTokenToHash(
            reconstructedHash,
            hashToken
          );
        } else if (type === 'string') {
          params[parameter] = hashToken;
          reconstructedHash = Router.appendTokenToHash(
            reconstructedHash,
            hashToken
          );
        }
      } else {
        if (hashToken !== routeToken) return false;
        reconstructedHash = Router.appendTokenToHash(
          reconstructedHash,
          hashToken
        );
      }
    }
    return { params, reconstructedHash };
  };
  Router.getRouteAndParamsFromHash = function(hash, routes) {
    for (let route of Object.keys(routes)) {
      const match = Router.getMatch(hash, route);
      if (match) {
        const { params, reconstructedHash } = match;
        return { route, params, reconstructedHash };
      }
    }
    return { route: '', params: {}, reconstructedHash: '' };
  };
  /**
   * @param {Object.<string, number | string>} params
   */
  this.setParams = function(params) {
    this.params = params;
    // Todo: Maybe dispatch some kind of event
  };
  this.setCurrentRoute = function(route) {
    this.currentRoute$.value = route;
  };
  this.setCurrentTitle = function(title) {
    this.currentTitle = title;
  };
  Router.removeHash = function() {
    return history.replaceState(null, null, ' ');
  };
  // Rather than passing data, this one should pass a string saying which attribute has been updated
  this.emit = function() {
    this.observers.forEach(observer => {
      if (!observer)
        console.warn('Non-existing element registered as router observer');

      observer({ currentRoute$: this.currentRoute$, params: this.params });
    });
  };
  this.syncWithHash = function() {
    const { hash } = location;
    const {
      route,
      params,
      reconstructedHash,
    } = Router.getRouteAndParamsFromHash(hash, this.routes);
    this.setParams(params);
    this.setCurrentRoute(this.routes[route]);
    this.setCurrentTitle(this.titles[route]);
    if (reconstructedHash === '#!') {
      Router.removeHash();
    } else {
      history.replaceState(undefined, undefined, reconstructedHash);
    }
    document.title = this.currentTitle;
    this.emit();
  };
  this.params = {};
  this.currentRoute$ = new Observable('');
  this.routes = {};
  this.titles = {};
  this.observers = [];
  this.hashChangeListeners = [];
  this.setRoutes(routes);
  window.addEventListener('hashchange', () => {
    this.syncWithHash();
    this.callHashChangeListeners();
  });
  /**
   * @param {string} route
   * One of the registered routes, without hashbang
   */
  this.navigateTo = route => {
    location.hash = `#!${route}`;
  };

  this.refresh = () => this.syncWithHash();

  // @possiblyNumber: string
  Router.isNumber = function(possiblyNumber) {
    return !isNaN(Number(possiblyNumber));
  };
  Router.isInt = function(possiblyInt) {
    return (
      Router.isNumber(possiblyInt) &&
      parseInt(possiblyInt) === Number(possiblyInt)
    );
  };
  this.onHashChange = callback => {
    this.hashChangeListeners.push(callback);
    this.callHashChangeListeners();
  };
  this.callHashChangeListeners = function() {
    this.hashChangeListeners.forEach(hashChangeListener =>
      hashChangeListener({
        params: this.params,
        currentRoute$: this.currentRoute$,
      })
    );
  };
  this.getParams = () => this.params;
  this.getCurrentTitle = () => this.currentTitle;
  Router.isProp = propsOrChild =>
    !(propsOrChild instanceof HTMLElement || typeof propsOrChild === 'string');

  /**
   * @param {function({ params: Object.<string, string | number> }): void} observer
   */
  this.subscribe = observer => {
    observer({
      currentRoute$: this.currentRoute$,
      params: this.params,
    });
    this.observers.push(observer);
  };
}

module.exports = Router;

  return module.exports;
})();

modules['src/data/Data.js'] = (() => {
  const module = { exports: {} };
  const getAllProjects = () => {
  const projects = JSON.parse(localStorage.getItem('projects')) || [];
  return projects.map(
    ({ id, name, apiUrl, apiInterval, derivedValuesCode, widgetsCode }) => ({
      id: id || '',
      name: name || '',
      apiUrl: apiUrl || '',
      apiInterval: apiInterval || 0,
      derivedValuesCode: derivedValuesCode || '',
      widgetsCode: widgetsCode || '',
    })
  );
};

const getExportedProject = () => [];

const getProjectById = (projectIdId) =>
  JSON.parse(localStorage.getItem('projects')).find(
    ({ id }) => id == projectId
  );

const createProject = (newProject) => {
  const projects = getAllProjects();
  const projectsUpdated = [
    ...projects,
    {
      ...newProject,
      id: `${Math.random()}${+new Date()}`,
    },
  ];
  localStorage.setItem('projects', JSON.stringify(projectsUpdated));
};

const updateProjectById = (projectId, project) => {
  const projects = getAllProjects();
  const projectIndex = projects.findIndex(({ id }) => id === projectId);
  if (projectIndex === -1) {
    console.warn('Tried to update nonexistent project');
    return;
  }
  Object.assign(projects[projectIndex], project);
  localStorage.setItem('projects', JSON.stringify(projects));
};

const deleteProjectById = (projectId) => {
  const projects = getAllProjects();
  const updatedProjects = projects.filter(({ id }) => id !== projectId);
  localStorage.setItem('projects', JSON.stringify(updatedProjects));
};

module.exports = {
  getAllProjects,
  getExportedProject,
  getProjectById,
  createProject,
  updateProjectById,
  deleteProjectById,
};

  return module.exports;
})();

modules['src/model/Model.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const {
  getExportedProject,
  getAllProjects,
  getProjectById,
  createProject,
  updateProjectById,
  deleteProjectById,
} = include('src/data/Data.js');

const MAX_AMOUNT_OF_PROJECTS = 100;
const MAX_AMOUNT_OF_VALUES = 100;
const MAX_AMOUNT_OF_WIDGETS = 100;

const evaluateCode = (apiResponse, widgetsCode) => {
  const evaluatedCode = eval(widgetsCode);
  const evaluatedCodeCalledWithApiResponse = evaluatedCode(
    JSON.parse(apiResponse)
  );
  return evaluatedCodeCalledWithApiResponse;
};

const Model = ({ router, isExported }) => {
  const dataModel = { projects: [] };
  const viewModel = {
    isExported, // When exporting the code, this will be true in the exported code

    // All values
    projects: [...new Array(MAX_AMOUNT_OF_PROJECTS).keys()].map(() => ({
      id$: new Observable(''),
      name$: new Observable(''),
      nameInputValue$: new Observable(''),
      isEditing$: new Observable(false),
      isEmpty$: new Observable(true),
    })),

    // Selected values
    selectedProjectId$: new Observable(null),
    selectedProjectName$: new Observable(null),

    lastVisitedProjectView$: new Observable(null),

    derivedValuesEditorIsOpen$: new Observable(false),

    selectedApiUrl$: new Observable(''),
    selectedApiUrlTestPreview$: new Observable(''),
    selectedApiInterval$: new Observable(''),
    apiResponse$: new Observable(''),
    selectedDerivedValuesCode$: new Observable(''),
    selectedWidgetsCode$: new Observable(''),

    widgets: [...new Array(MAX_AMOUNT_OF_WIDGETS).keys()].map(() => ({
      label$: new Observable(''),
      type$: new Observable(''),
      value$: new Observable(0),
      edges$: new Observable([]),
      surfaces$: new Observable([]),
      center$: new Observable([0, 0, 0]),
      isEmpty$: new Observable(true),
      is3d$: new Observable(false),
    })),
  };

  viewModel.loadAllProjects = () => {
    dataModel.projects = isExported ? getExportedProject() : getAllProjects();
    for (let i = 0; i < MAX_AMOUNT_OF_PROJECTS; i++) {
      viewModel.projects[i].id$.value = '';
      viewModel.projects[i].name$.value = '';
      viewModel.projects[i].nameInputValue$.value = '';
      viewModel.projects[i].isEditing$.value = false;
      viewModel.projects[i].isEmpty$.value = true;
    }
    dataModel.projects.forEach(
      ({ id, name, apiRequests, derivedValuesCode, widgetsCode }, index) => {
        viewModel.projects[index].id$.value = id;
        viewModel.projects[index].name$.value = name;
        viewModel.projects[index].nameInputValue$.value = name;
        viewModel.projects[index].isEmpty$.value = false;
        if (isExported) {
          viewModel.selectedProjectId$.value = id;
        }
      }
    );
    const selectedProject = dataModel.projects.find(
      ({ id }) => id === viewModel.selectedProjectId$.value
    );
    if (!selectedProject) {
      viewModel.selectedProjectId$.value = null;
      viewModel.selectedProjectName$.value = null;
      viewModel.selectedApiUrl$.value$ = '';
      viewModel.selectedApiInterval$.value = null;
      viewModel.selectedDerivedValuesCode$.value = '';
      viewModel.selectedWidgetsCode$.value = '';
      return;
    }
    viewModel.selectedProjectName$.value /***/ = selectedProject.name;
    viewModel.selectedApiUrl$.value /********/ = selectedProject.apiUrl;
    viewModel.selectedApiInterval$.value /***/ = selectedProject.apiInterval;
    viewModel.selectedDerivedValuesCode$.value =
      selectedProject.derivedValuesCode;
    viewModel.selectedWidgetsCode$.value /***/ = selectedProject.widgetsCode;
  };
  viewModel.loadAllProjects();

  viewModel.createNewProject = () => {
    createProject({
      name: 'Untitled project',
      apiUrl: '',
      apiInterval: 0,
      derivedValuesCode: '',
      widgetsCode: '',
    });
    viewModel.loadAllProjects();
  };

  viewModel.setProjectNameInputValue = (projectId, inputValue) => {
    const project = viewModel.projects.find(
      ({ id$ }) => id$.value === projectId
    );
    if (!project) {
      console.warn(
        'Tried to update project name input value of nonexistent project.'
      );
    }
    project.nameInputValue$.value = inputValue;
  };

  viewModel.editProjectName = (projectId) => {
    const project = viewModel.projects.find(
      ({ id$ }) => id$.value === projectId
    );
    if (!project) {
      console.warn(
        'Tried to cancel editing the name input value of nonexistent project.'
      );
    }
    project.isEditing$.value = true;
  };

  viewModel.cancelEditingProjectName = (projectId) => {
    const project = viewModel.projects.find(
      ({ id$ }) => id$.value === projectId
    );
    if (!project) {
      console.warn(
        'Tried to cancel editing the name input value of nonexistent project.'
      );
    }
    project.nameInputValue$.value = project.name$.value;
    project.isEditing$.value = false;
  };

  viewModel.saveProjectName = (projectId) => {
    const project = viewModel.projects.find(
      ({ id$ }) => id$.value === projectId
    );
    updateProjectById(projectId, {
      name: project.nameInputValue$.value,
    });
    viewModel.loadAllProjects();
  };

  viewModel.saveSelectedProject = () => {
    updateProjectById(viewModel.selectedProjectId$.value, {
      name: viewModel.selectedName$.value,
      apiUrl: viewModel.selectedApiUrl$.value,
      apiInterval: viewModel.selectedApiInterval$.value,
      derivedValuesCode: viewModel.selectedDerivedValuesCode$.value,
      widgetsCode: viewModel.selectedWidgetsCode$.value,
    });
    viewModel.loadAllProjects();
  };

  viewModel.deleteProject = (projectId) => {
    deleteProjectById(projectId);
    viewModel.loadAllProjects();
  };

  viewModel.updateApiUrl = (projectId, apiUrl) => {
    updateProjectById(projectId, { apiUrl });
    viewModel.loadAllProjects();
  };

  viewModel.updateApiInterval = (projectId, apiInterval) => {
    updateProjectById(projectId, { apiInterval });
    viewModel.loadAllProjects();
  };

  viewModel.updateDerivedValuesCode = (projectId, derivedValuesCode) => {
    updateProjectById(projectId, { derivedValuesCode });
    viewModel.loadAllProjects();
  };

  viewModel.updateWidgetsCode = (projectId, widgetsCode) => {
    updateProjectById(projectId, { widgetsCode });
    viewModel.loadAllProjects();
  };

  viewModel.testApiUrlInput = () => {
    fetch(viewModel.selectedApiUrl$.value)
      .then((response) => response.json())
      .then((jsonResponse) => {
        viewModel.selectedApiUrlTestPreview$.value = JSON.stringify(
          jsonResponse,
          null,
          2
        );
      });
  };

  const updateValues = () => {
    let evaluatedCode;
    try {
      evaluatedCode = evaluateCode(
        viewModel.apiResponse$.value,
        viewModel.selectedWidgetsCode$.value
      );
    } catch (e) {
      console.log('Failed to evaluate code: ', e);
      evaluatedCode = [];
    }

    const widgets = evaluatedCode;
    viewModel.widgets.forEach(
      (
        { label$, type$, value$, edges$, surfaces$, is3d$, center$, isEmpty$ },
        index
      ) => {
        label$.value = widgets[index] ? widgets[index].label : '';
        type$.value = widgets[index] ? widgets[index].type : '';
        value$.value = widgets[index] ? widgets[index].value : 0;
        edges$.value = widgets[index] ? widgets[index].edges || [] : [];
        surfaces$.value = widgets[index] ? widgets[index].surfaces || [] : [];
        center$.value = widgets[index]
          ? widgets[index].center || [0, 0, 0]
          : [0, 0, 0]; // TODO
        is3d$.value = widgets[index] ? widgets[index].is3d || false : false; // TODO
        isEmpty$.value = !widgets[index];
      }
    );
  };

  window.addEventListener(viewModel.apiResponse$.id, updateValues);
  window.addEventListener(
    viewModel.selectedDerivedValuesCode$.id,
    updateValues
  );
  window.addEventListener(viewModel.selectedWidgetsCode$.id, updateValues);

  const fetchDataFromApi = () => {
    fetch(viewModel.selectedApiUrl$.value)
      .then((response) => response.json())
      .then((jsonResponse) => {
        viewModel.apiResponse$.value = JSON.stringify(jsonResponse, null, 2);
      });
  };

  const repeatedlyFetchDataFromApi = (timeoutInSeconds) =>
    setTimeout(() => {
      console.log('repeatedly fetch data from api');
      if (viewModel.selectedApiInterval$.value !== 0) {
        fetchDataFromApi();
      }
      if (timeoutInSeconds === viewModel.selectedApiInterval$.value) {
        repeatedlyFetchDataFromApi(timeoutInSeconds);
      }
    }, timeoutInSeconds * 1000);
  repeatedlyFetchDataFromApi();

  addEventListener(viewModel.selectedApiInterval$.id, () =>
    setTimeout(() => {
      fetchDataFromApi();
      repeatedlyFetchDataFromApi(viewModel.selectedApiInterval$.value);
    }, 1000)
  );
  addEventListener(viewModel.selectedApiUrl$.id, () =>
    setTimeout(() => {
      fetchDataFromApi();
      repeatedlyFetchDataFromApi(viewModel.selectedApiInterval$.value);
    }, 1000)
  );

  const syncSelectedProjectWithRouter = ({ params, currentRoute$ }) => {
    if (currentRoute$.value.indexOf('/projects/<projectId:string>') === 0) {
      const selectedProject = dataModel.projects.find(
        ({ id }) => id === params.projectId
      );
      viewModel.selectedProjectId$.value = selectedProject.id;
      viewModel.selectedProjectName$.value = selectedProject.name;
      viewModel.selectedApiUrl$.value = selectedProject.apiUrl;
      viewModel.selectedApiInterval$.value = selectedProject.apiInterval;
      viewModel.selectedDerivedValuesCode$.value =
        selectedProject.derivedValuesCode;
      viewModel.selectedWidgetsCode$.value = selectedProject.widgetsCode;
      if (
        currentRoute$.value.indexOf(
          '/projects/<projectId:string>/data-sources'
        ) === 0
      ) {
        viewModel.lastVisitedProjectView$.value = 'data-sources';
      }
      if (
        currentRoute$.value.indexOf('/projects/<projectId:string>/values') === 0
      ) {
        viewModel.lastVisitedProjectView$.value = 'values';
      }
      if (
        currentRoute$.value.indexOf(
          '/projects/<projectId:string>/dashboard'
        ) === 0
      ) {
        viewModel.lastVisitedProjectView$.value = 'dashboard';
      }
    }
  };
  syncSelectedProjectWithRouter(router);
  router.onHashChange(syncSelectedProjectWithRouter);

  return viewModel;
};
module.exports = Model;

  return module.exports;
})();

modules['src/libraries/observable/utils.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

const valueOf$ = (observable$) =>
  observable$ instanceof Observable ? observable$.value : observable$;

const isObservable$ = (observable$) => observable$ instanceof Observable;

// Currently needs at least two arguments
const add$ = (...observables) => {
  const sum = observables
    .map((observable) =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a + b);
  const sum$ = new Observable(sum);
  observables
    .filter((observable) => observable instanceof Observable)
    .forEach((observable) => {
      window.addEventListener(observable.id, ({ detail }) => {
        const sum = observables
          .map((observable) =>
            observable instanceof Observable ? observable.value : observable
          )
          .reduce((a, b) => a + b);
        sum$.value = sum;
      });
    });
  return sum$;
};

// Currently needs at least two arguments
const subtract$ = (...observables) => {
  const difference = observables
    .map((observable) =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a - b);
  const difference$ = new Observable(difference);
  observables.forEach((observable) => {
    window.addEventListener(observable.id, ({ detail }) => {
      const difference = observables
        .map((observable) =>
          observable instanceof Observable ? observable.value : observable
        )
        .reduce((a, b) => a - b);
      difference$.value = difference;
    });
  });
  return difference$;
};

// Currently needs at least two arguments
const multiply$ = (...observables) => {
  const product = observables
    .map((observable) =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a * b);
  const product$ = new Observable(product);
  observables.forEach((observable) => {
    window.addEventListener(observable.id, ({ detail }) => {
      const product = observables
        .map((observable) =>
          observable instanceof Observable ? observable.value : observable
        )
        .reduce((a, b) => a * b);
      product$.value = product;
    });
  });
  return product$;
};

// Currently needs at least two arguments
const divide$ = (...observables) => {
  const quotient = observables
    .map((observable) =>
      observable instanceof Observable ? observable.value : observable
    )
    .reduce((a, b) => a / b);
  const quotient$ = new Observable(quotient);
  observables.forEach((observable) => {
    window.addEventListener(observable.id, ({ detail }) => {
      const quotient = observables
        .map((observable) =>
          observable instanceof Observable ? observable.value : observable
        )
        .reduce((a, b) => a / b);
      quotient$.value = quotient;
    });
  });
  return quotient$;
};

const choose$ = (observable, option1, option2) => {
  const result$ = new Observable(
    (observable instanceof Observable ? observable.value : observable)
      ? option1 instanceof Observable
        ? option1.value
        : option1
      : option2 instanceof Observable
      ? option2.value
      : option2
  );
  [observable, option1, option2]
    .filter((observable) => observable instanceof Observable)
    .forEach((observable) => {
      window.addEventListener(observable.id, ({ detail }) => {
        // TODO: Make it possible to set a specific child of an observable
        result$.value = (
          observable instanceof Observable ? observable.value : observable
        )
          ? option1 instanceof Observable
            ? option1.value
            : option1
          : option2 instanceof Observable
          ? option2.value
          : option2;
      });
    });
  return result$;
};

const cond$ = (...clauses) => {
  const result = clauses
    .map(([test, expression]) => [
      test instanceof Observable ? test.value : test,
      expression instanceof Observable ? expression.value : expression,
    ])
    .reduce((result, [test, expression]) => {
      if (result !== null) return result;
      if (test) return expression;
      return null;
    }, null);

  const result$ = new Observable(result);

  clauses
    .flat()
    .filter((testOrExpression) => testOrExpression instanceof Observable)
    .forEach((testOrExpression) => {
      window.addEventListener(testOrExpression.id, ({ detail }) => {
        const result = clauses
          .map(([test, expression]) => [
            test instanceof Observable ? test.value : test,
            expression instanceof Observable ? expression.value : expression,
          ])
          .reduce((result, [test, expression]) => {
            if (result !== null) return result;
            if (test) return expression;
            return null;
          }, null);
        result$.value = result;
      });
    });

  return result$;
};

const eq$ = (...observables) => {
  const equality = observables
    .map((observable) =>
      observable instanceof Observable ? observable.value : observable
    )
    .every((element, _, array) => element === array[0]);
  const equality$ = new Observable(equality);
  observables.forEach((observable) => {
    window.addEventListener(observable.id, ({ detail }) => {
      const equality = observables
        .map((observable) =>
          observable instanceof Observable ? observable.value : observable
        )
        .every((element, _, array) => element === array[0]);
      equality$.value = equality;
    });
  });
  return equality$;
};

const and$ = (...observables) => {
  const allTruthy = observables
    .map((observable) =>
      observable instanceof Observable ? observable.value : observable
    )
    .every(Boolean);
  const allTruthy$ = new Observable(allTruthy);
  observables.forEach((observable) => {
    window.addEventListener(observable.id, ({ detail }) => {
      const allTruthy = observables
        .map((observable) =>
          observable instanceof Observable ? observable.value : observable
        )
        .every(Boolean);
      allTruthy$.value = allTruthy;
    });
  });
  return allTruthy$;
};

const or$ = (...observables) => {
  const someTruthy = observables
    .map((observable) =>
      observable instanceof Observable ? observable.value : observable
    )
    .some(Boolean);
  const someTruthy$ = new Observable(someTruthy);
  observables
    .filter((observable) => observable instanceof Observable)
    .forEach((observable) => {
      window.addEventListener(observable.id, ({ detail }) => {
        const someTruthy = observables
          .map((observable) =>
            observable instanceof Observable ? observable.value : observable
          )
          .some(Boolean);
        someTruthy$.value = someTruthy;
      });
    });
  return someTruthy$;
};

const not$ = (observable) => {
  const conditional =
    observable instanceof Observable ? observable.value : observable;
  const opposite$ = new Observable(!conditional);
  if (observable instanceof Observable) {
    window.addEventListener(observable.id, ({ detail }) => {
      opposite$.value = !detail;
    });
  }
  return opposite$;
};

const Number$ = (maybeNumber$) => {
  const number$ = new Observable(Number(valueOf$(maybeNumber$)));
  if (isObservable$(maybeNumber$)) {
    window.addEventListener(maybeNumber$.id, () => {
      number$.value = Number(valueOf$(maybeNumber$));
    });
  }
  return number$;
};

const toFixed$ = (number$, decimals$) => {
  const number = number$ instanceof Observable ? number$.value : number$;
  const decimals =
    decimals$ instanceof Observable ? decimals$.value : decimals$;
  const formattedNumber = number.toFixed(decimals);
  const formattedNumber$ = new Observable(formattedNumber);
  [number$, decimals$]
    .filter((observable) => observable instanceof Observable)
    .forEach((observable) => {
      window.addEventListener(observable.id, ({ detail }) => {
        const number = number$ instanceof Observable ? number$.value : number$;
        const decimals =
          decimals$ instanceof Observable ? decimals$.value : decimals$;
        const formattedNumber = number.toFixed(decimals);
        formattedNumber$.value = formattedNumber;
      });
    });
  return formattedNumber$;
};

const slice$ = (stringOrArray$, start$, stop$) => {
  const stringOrArray =
    stringOrArray$ instanceof Observable
      ? stringOrArray$.value
      : stringOrArray$;
  const start = start$ instanceof Observable ? start$.value : start$;
  const stop = stop$ instanceof Observable ? stop$.value : stop$;
  const slicedStringOrArray$ = new Observable(stringOrArray.slice(start, stop));
  [stringOrArray$, start$, stop$]
    .filter((observable) => observable instanceof Observable)
    .forEach((observable) => {
      window.addEventListener(observable.id, ({ detail }) => {
        const stringOrArray =
          stringOrArray$ instanceof Observable
            ? stringOrArray$.value
            : stringOrArray$;
        const start = start$ instanceof Observable ? start$.value : start$;
        const stop = stop$ instanceof Observable ? stop$.value : stop$;
        slicedStringOrArray$.value = stringOrArray.slice(start, stop);
      });
    });
  return slicedStringOrArray$;
};

const length$ = (stringOrArray$) => {
  const length$ = new Observable(valueOf$(stringOrArray$).length);
  if (isObservable$(stringOrArray$)) {
    window.addEventListener(stringOrArray$.id, () => {
      lenth$.value = valueOf$(stringOrArray$).length;
    });
  }
  return length$;
};

const map$ = (array$, function$) => {
  const mappedArray$ = new Observable(
    valueOf$(array$).map(valueOf$(function$))
  );

  [array$, function$].filter(isObservable$).forEach((observable) => {
    window.addEventListener(observable.id, () => {
      mappedArray$.value = valueOf$(array$).map(valueOf$(function$));
    });
  });

  return mappedArray$;
};

const startsWith$ = (includingString$, includedString$) => {
  const includingString =
    includingString$ instanceof Observable
      ? includingString$.value
      : includingString$;

  const includedString =
    includedString$ instanceof Observable
      ? includedString$.value
      : includedString$;

  const includingStringIncludesIncludedString =
    includingString.indexOf(includedString) === 0;

  const includingStringIncludesIncludedString$ = new Observable(
    includingStringIncludesIncludedString
  );

  [includingString$, includedString$]
    .filter((string) => string instanceof Observable)
    .forEach((string) => {
      window.addEventListener(string.id, ({ detail }) => {
        const includingString =
          includingString$ instanceof Observable
            ? includingString$.value
            : includingString$;

        const includedString =
          includedString$ instanceof Observable
            ? includedString$.value
            : includedString$;

        const includingStringIncludesIncludedString =
          includingString.indexOf(includedString) === 0;

        includingStringIncludesIncludedString$.value = includingStringIncludesIncludedString;
      });
    });
  return includingStringIncludesIncludedString$;
};

module.exports = {
  valueOf$,
  isObservable$,
  add$,
  subtract$,
  multiply$,
  divide$,
  choose$,
  cond$,
  eq$,
  and$,
  or$,
  not$,
  Number$,
  toFixed$,
  slice$,
  length$,
  map$,
  startsWith$,
};

  return module.exports;
})();

modules['src/libraries/observableHtml/ObservableHtml.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

const observableToNode$ = (observable$) => {
  if (
    // If it is observable value
    observable$ instanceof Observable
  ) {
    if (['string', 'number'].includes(typeof observable$.value)) {
      const textElement = document.createElement('span');
      const textNode = document.createTextNode(observable$.value);
      textElement.appendChild(textNode);
      textElement.classList.add(observable$.id);
      window.addEventListener(observable$.id, ({ detail }) => {
        textElement.innerHTML = '';
        textElement.appendChild(document.createTextNode(detail));
      });
      return textElement;
    }
    if (Array.isArray(observable$.value)) {
      const elements = observable$.value.map(observableToNode$).flat();
      elements.forEach((element, index) => {
        element.classList.add(`${observable$.id}${index}`);
        window.addEventListener(observable$.id, ({ detail }) => {
          // Remove all the existing elements except the first
          let insertionPositions = [];
          for (let index = 0; index < 100; index++) {
            Array.from(
              document.getElementsByClassName(`${observable$.id}${index}`)
            ).forEach((elementToReplace, i) => {
              const insertionParent = elementToReplace.parentNode;
              const insertionIndex = Array.from(
                elementToReplace.parentNode.children
              ).indexOf(elementToReplace);
              insertionPositions.push({
                parent: insertionParent,
                insertionIndex: insertionIndex,
              });
              elementToReplace.parentNode.removeChild(elementToReplace);
            });
          }

          // For each of the first existing elements
          insertionPositions.forEach(({ parent, insertionIndex }, index) => {
            // Create a fragment and add all the elements inside it
            const fragment = document.createDocumentFragment();
            observable$.value.forEach((arrayElement, index) => {
              // I might need to have another level of loop here in case observableToNode$ returns more than one node
              const node = observableToNode$(arrayElement);
              node.classList.add(`${observable$.id}${index}`);
              fragment.appendChild(node);
            });
            // Repalact the first elemet with the fragments containing the new elements
            parent.insertBefore(fragment, parent.children[insertionIndex]);
          });
        });
      });
      return elements;
    }
  }
  if (
    // If it is non-observable value
    ['string', 'number'].includes(typeof observable$)
  ) {
    const textNode = document.createTextNode(observable$);
    return textNode;
  }
  // If it is a dom node
  return observable$;
};

const createElement$ = (elementType, ...observables) => {
  const element = document.createElement(elementType);
  const nodes = observables.map(observableToNode$).flat();
  nodes.forEach((node) => element.appendChild(node));

  // Note that styleObject$ is an object with observable values, not an observable object
  element.setStyle = (styleObject$) => {
    Object.entries(styleObject$).forEach(([styleProperty, styleValue$]) => {
      if (styleValue$ instanceof Observable) {
        element.style[styleProperty] = styleValue$.value;
        window.addEventListener(styleValue$.id, ({ detail }) => {
          element.style[styleProperty] = detail;
        });
        return;
      }
      element.style[styleProperty] = styleValue$;
    });
    return element;
  };
  element.setProps = (propsObject) => {
    Object.entries(propsObject).forEach(([propKey, propValue$]) => {
      if (propValue$ instanceof Observable) {
        element[propKey] = propValue$.value;
        window.addEventListener(propValue$.id, ({ detail }) => {
          element[propKey] = detail;
        });
        return;
      }
      element[propKey] = propValue$;
    });
    return element;
  };
  element.onClick = (clickCallback) => {
    element.style.cursor = 'pointer';
    element.onclick = () => clickCallback(element);
    return element;
  };
  element.onMouseEnter = (mouseEnterCallback) => {
    element.onmouseenter = () => mouseEnterCallback(element);
    return element;
  };
  element.onMouseLeave = (mouseLeaveCallback) => {
    element.onmouseleave = () => mouseLeaveCallback(element);
    return element;
  };
  element.onInput = (inputCallback) => {
    element.oninput = () => inputCallback(element);
    return element;
  };
  element.onChange = (changeCallback) => {
    element.onchange = () => changeCallback(element);
    return element;
  };
  return element;
};
const a$ = (...children) => createElement$('a', ...children);
const div$ = (...children) => createElement$('div', ...children);
const span$ = (...children) => createElement$('span', ...children);
const h1$ = (...children) => createElement$('h1', ...children);
const textArea$ = (value = '') =>
  createElement$('textarea').setProps({ value });
const br$ = () => createElement('br');
const select$ = (...children) => createElement$('select', ...children);
const button$ = (...children) => createElement$('button', ...children);
const option$ = ({ value, label }) =>
  createElement$('option', label).setProps({ value });
const input$ = (value = '') => createElement$('input').setProps({ value });
const canvas$ = ({ width$, height$ }) =>
  createElement$('canvas').setProps({
    width: width$,
    height: height$,
  });

module.exports = {
  createElement$,
  a$,
  div$,
  span$,
  h1$,
  textArea$,
  br$,
  select$,
  button$,
  option$,
  input$,
  canvas$,
};

  return module.exports;
})();

modules['src/libraries/styled/styled.js'] = (() => {
  const module = { exports: {} };
  const styled = style => Component => (...children) =>
  Component(...children).setStyle(style);

module.exports = styled;

  return module.exports;
})();

modules['src/libraries/observableHtml/utils.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const { valueOf$ } = include('src/libraries/observable/utils.js');
const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const Choose$ = (observable, element1, element2) => {
  let element = valueOf$(observable) ? element1 : element2;
  if (observable instanceof Observable) {
    window.addEventListener(observable.id, ({ detail }) => {
      // TODO: Make it possible to set a specific child of an observable
      newElement = valueOf$(observable) ? element1 : element2;

      if (newElement !== element && element.parentNode) {
        element.parentNode.replaceChild(newElement, element);
        element = newElement;
      }
    });
  }
  return element;
};

const Switch$ = (statement$, ...clauses) => {
  const cases = clauses.filter((_, i) => i % 2 === 0);
  const elements = clauses.filter((_, i) => i % 2 !== 0);
  return div$(
    ...cases.map((theCase, i) => {
      const element = elements[i];
      // Warning: Assumes that display is not initially dynamic
      const display = element.style.display;
      return element.setStyle({
        display: choose$(eq$(statement$, theCase), display, 'none'),
      });
    })
  );
};

const Nothing$ = styled({ display: 'none' })(div$);

const If$ = (observable, element) => Choose$(observable, element, Nothing$());

module.exports = {
  Choose$,
  Switch$,
  Nothing$,
  If$,
};

  return module.exports;
})();

modules['src/views/project/projectContainer/ProjectContainer.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const ProjectContainer$ = styled({
  height: 'calc(100% - 64px)',
  position: 'absolute',
  left: '0',
  right: '0',
})(div$);

module.exports = ProjectContainer$;

  return module.exports;
})();

modules['src/components/horizontalNavigator/HorizontalNavigator.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const HorizontalNavigator$ = styled({ height: '64px' })(div$);

module.exports = HorizontalNavigator$;

  return module.exports;
})();

modules['src/app/titleBar/atoms.js'] = (() => {
  const module = { exports: {} };
  const { div$, a$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const styled = include('src/libraries/styled/styled.js');

const ViewTitle$ = styled({
  fontSize: '32px',
  padding: '16px',
  display: 'inline-block',
})(div$);

const ExportButton$ = styled({
  fontSize: '16px',
  padding: '0 16px',
  float: 'right',
  lineHeight: '64px',
})(div$);

module.exports = { ViewTitle$, ExportButton$ };

  return module.exports;
})();

modules['src/styleWrappers/withShadow.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');

const withShadow = styled({
  boxShadow: 'rgba(0, 0, 0, 0.25) 0px 0px 8px -4px',
});

module.exports = withShadow;

  return module.exports;
})();

modules['src/app/titleBar/TitleBar.js'] = (() => {
  const module = { exports: {} };
  const HorizontalNavigator$ = include(
  'src/components/horizontalNavigator/HorizontalNavigator.js'
);
const { ViewTitle$, ExportButton$ } = include('src/app/titleBar/atoms.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { add$, startsWith$, choose$, not$ } = include(
  'src/libraries/observable/utils.js'
);
const { If$ } = include('src/libraries/observableHtml/utils.js');
const { span$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const TitleBar$ = ({ currentRoute$, viewModel }) => {
  const { isExported } = viewModel;
  return withShadow(HorizontalNavigator$)(
    ViewTitle$(
      If$(
        not$(isExported),
        span$('Projects').onClick(() => (location.hash = '#!/projects'))
      ),
      span$(
        choose$(
          viewModel.selectedProjectName$,
          isExported
            ? viewModel.selectedProjectName$
            : add$(' / ', viewModel.selectedProjectName$),
          ''
        )
      )
        .setStyle({
          color: isExported
            ? 'darkslategray'
            : choose$(
                startsWith$(currentRoute$, '/projects/<projectId:string>'),
                'darkslategray',
                'lightgray'
              ),
        })
        .onClick(() => {
          if (isExported) {
            location.hash = '#!/';
            return;
          }
          location.hash = `#!/projects/${viewModel.selectedProjectId$.value}/${
            viewModel.lastVisitedProjectView$.value || ''
          }`;
        })
    ),
    If$(
      not$(isExported),
      ExportButton$('Export').onClick(() => {
        const element = document.createElement('a');
        // SInce just the first occurrence of the code will be replaced, we need to make sure that this code does not replace itself, so we construct the match on call time
        const fileContent = document.head.innerHTML
          .replace(
            '*c*o*n*s*t* *i*s*E*x*p*o*r*t*e*d* *=* *f*a*l*s*e*;*'
              .split('*')
              .join(''),
            '*c*o*n*s*t* *i*s*E*x*p*o*r*t*e*d* *=* *t*r*u*e*;*'
              .split('*')
              .join('')
          )
          .replace(
            '*c*o*n*s*t* *g*e*t*E*x*p*o*r*t*e*d*P*r*o*j*e*c*t* *=* *(*)* *=*>* *[*]*;*'
              .split('*')
              .join(''),
            `*c*o*n*s*t* *g*e*t*E*x*p*o*r*t*e*d*P*r*o*j*e*c*t* *=* *(*)* *=*>*`
              .split('*')
              .join('') +
              JSON.stringify([
                {
                  id: viewModel.selectedProjectId$.value,
                  name: viewModel.selectedProjectName$.value,
                  apiUrl: viewModel.selectedApiUrl$.value,
                  apiInterval: viewModel.selectedApiInterval$.value,
                  derivedValuesCode: viewModel.selectedDerivedValuesCode$.value,
                  widgetsCode: viewModel.selectedWidgetsCode$.value,
                },
              ])
          );
        const file = new Blob([fileContent], { type: 'text/plain' });
        element.href = URL.createObjectURL(file);
        element.download = `${viewModel.selectedProjectName$.value
          .toLowerCase()
          .split(' ')
          .join('-')}.html`;
        document.body.appendChild(element); // Required for this to work in FireFox
        element.click();
      })
    )
  ).setStyle({
    background: 'white',
    color: 'darkslategray',
  });
};

module.exports = TitleBar$;

  return module.exports;
})();

modules['src/views/projects/newProject/NewProject.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const { span$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const NewProject$ = ({ viewModel }) => {
  const color$ = new Observable('slategray');
  return span$('New project')
    .setStyle({
      color: color$,
      margin: '32px',
      padding: '0 16px',
      height: '64px',
      background: 'none',
      lineHeight: '64px',
      fontSize: '16px',
      display: 'inline-block',
    })
    .onMouseEnter(() => (color$.value = 'darkslategray'))
    .onMouseLeave(() => (color$.value = 'slategray'))
    .onClick(viewModel.createNewProject);
};

module.exports = NewProject$;

  return module.exports;
})();

modules['src/libraries/simpleHTML/SimpleHTML.js'] = (() => {
  const module = { exports: {} };
  const doAddInnerShadow = (element) => {
  element.style.boxShadow = 'inset rgba(0, 0, 0, 0.25) 0 0 10px -5px';
};

const doAddShadow = (element) => {
  element.style.boxShadow = 'rgba(0, 0, 0, 0.25) 0 0 10px -5px';
};

const doUpdateChildren = (element, newChildren) => {
  newChildren.forEach((newChild, index) => {
    if (element.childNodes[index] === newChild) return;
    while (
      element.childNodes[index] &&
      !newChildren.includes(element.childNodes[index])
    ) {
      element.removeChild(element.childNodes[index]);
    }
    if (element.childNodes[index]) {
      element.insertBefore(newChild, element.childNodes[index]);
      return;
    }
    element.appendChild(newChild);
    return;
  });
  while (newChildren.length < element.childNodes.length) {
    element.removeChild(element.childNodes[newChildren.length]);
  }
};

module.exports = { doAddInnerShadow, doAddShadow, doUpdateChildren };

  return module.exports;
})();

modules['src/libraries/simpleUI/HorizontalNavigator.js'] = (() => {
  const module = { exports: {} };
  const { doUpdateChildren } = include('src/libraries/simpleHTML/SimpleHTML.js');

const HorizontalNavigator = () => {
  // Create base element
  const divElement = document.createElement('div');

  // Define setters
  Object.defineProperty(divElement, 'heightUnits', {
    set: (heightUnits) => {
      divElement.style.height = `${heightUnits * 20}px`;
    },
  });
  Object.defineProperty(divElement, 'children', {
    set: (children) => {
      doUpdateChildren(divElement, children);
    },
  });
  return divElement;
};

module.exports = HorizontalNavigator;

  return module.exports;
})();

modules['src/libraries/simpleUI/Container.js'] = (() => {
  const module = { exports: {} };
  const { doUpdateChildren } = include('src/libraries/simpleHTML/SimpleHTML.js');

const Container = () => {
  // Create base element
  const divElement = document.createElement('div');
  Object.assign(divElement.style, {
    display: 'inline-block',
    width: '100%',
  });

  // Define setters
  Object.defineProperty(divElement, 'widthUnits', {
    set: (widthUnits) => {
      divElement.style.maxWidth = `${widthUnits * 20}px`;
    },
  });
  Object.defineProperty(divElement, 'children', {
    set: (children) => {
      doUpdateChildren(divElement, children);
    },
  });
  return divElement;
};

module.exports = Container;

  return module.exports;
})();

modules['src/libraries/simpleUI/Constants.js'] = (() => {
  const module = { exports: {} };
  const Colors = {
  TextColor: 'slategray',
  HighlightedTextColor: 'darkslategray',
  DisabledTextColor: 'lightgray',
};

const Sizes = {
  FontSize: 15,
  Padding: 10,
  Unit: 20,
};

module.exports = {
  Colors,
  Sizes,
};

  return module.exports;
})();

modules['src/libraries/simpleUI/NavigationButton.js'] = (() => {
  const module = { exports: {} };
  const { Colors } = include('src/libraries/simpleUI/Constants.js');

const NavigationButton = () => {
  // Create base element
  const spanElement = document.createElement('span');
  const aElement = document.createElement('a');
  Object.assign(spanElement.style, {
    display: 'inline-block',
    textAlign: 'center',
    boxSizing: 'border-box',
  });
  Object.assign(aElement.style, {
    textDecoration: 'none',
    display: 'inline-block',
    width: '100%',
  });
  spanElement.appendChild(aElement);

  const state = {};

  // Define setters
  Object.defineProperty(spanElement, 'widthUnits', {
    set: (widthUnits) => {
      state.widthUnits = widthUnits;
      spanElement.style.width = `${widthUnits * 20}px`;
    },
  });
  Object.defineProperty(spanElement, 'heightUnits', {
    set: (heightUnits) => {
      state.heightUnits = heightUnits;
      spanElement.style.height = `${heightUnits * 20}px`;
      spanElement.style.lineHeight = `${heightUnits * 20}px`;
      aElement.style.fontSize = `${(heightUnits / 2) * 15}px`;
    },
  });
  Object.defineProperty(spanElement, 'title', {
    set: (title) => {
      state.title = title;
      aElement.innerText = title;
    },
  });
  Object.defineProperty(spanElement, 'href', {
    set: (href) => {
      state.href = href;
      aElement.href = href;
    },
  });
  Object.defineProperty(spanElement, 'isSelected', {
    set: (isSelected) => {
      state.isSelected = isSelected;
      spanElement.style.borderBottom = isSelected
        ? '2px solid limegreen'
        : 'none';
      aElement.style.color = isSelected
        ? Colors.HighlightedTextColor
        : Colors.TextColor;
    },
  });

  // Define event listeners
  aElement.onmouseenter = () => {
    aElement.style.color = Colors.HighlightedTextColor;
  };
  aElement.onmouseleave = () => {
    aElement.style.color = state.isSelected
      ? Colors.HighlightedTextColor
      : Colors.TextColor;
  };
  return spanElement;
};

module.exports = NavigationButton;

  return module.exports;
})();

modules['src/views/project/projectNavigator/ProjectNavigator.js'] = (() => {
  const module = { exports: {} };
  const NavigationButton = include('src/libraries/simpleUI/NavigationButton.js');
const HorizontalNavigator = include(
  'src/libraries/simpleUI/HorizontalNavigator.js'
);

const button = (title) =>
  Object.assign(NavigationButton(), {
    widthUnits: 8,
    heightUnits: 2,
    title,
  });

const Navigator = (children) =>
  Object.assign(HorizontalNavigator(), {
    heightUnits: 2,
    children,
  });

const ProjectNavigator$ = ({ currentRoute$, viewModel }) => {
  const dataSourcesButton = button('Data sources');
  const dashboardEditorButton = button('Dashboard editor');
  const dashboardButton = button('Dashboard');
  const navigator = Navigator([
    dataSourcesButton,
    dashboardEditorButton,
    dashboardButton,
  ]);

  const doUpdateIsSelected = (currentRoute) => {
    dataSourcesButton.isSelected = [
      '/projects/<projectId:string>',
      '/projects/<projectId:string>/data-sources',
    ].includes(currentRoute);
    dashboardEditorButton.isSelected =
      currentRoute === '/projects/<projectId:string>/dashboard/edit';
    dashboardButton.isSelected =
      currentRoute === '/projects/<projectId:string>/dashboard';
  };

  const doUpdateHref = (selectedProjectId) => {
    dataSourcesButton.href = `#!/projects/${selectedProjectId}/data-sources`;
    dashboardEditorButton.href = `#!/projects/${selectedProjectId}/dashboard/edit`;
    dashboardButton.href = `#!/projects/${selectedProjectId}/dashboard`;
  };

  addEventListener(currentRoute$.id, () => {
    doUpdateIsSelected(currentRoute$.value);
  });

  addEventListener(viewModel.selectedProjectId$.id, () => {
    doUpdateHref(viewModel.selectedProjectId$.value);
  });

  // When this component becomes purely imperative, these will no longer be needed
  doUpdateIsSelected(currentRoute$.value);
  doUpdateHref(viewModel.selectedProjectId$.value);

  return navigator;
};

module.exports = ProjectNavigator$;

  return module.exports;
})();

modules['src/libraries/simpleUI/TextArea.js'] = (() => {
  const module = { exports: {} };
  const { doAddInnerShadow } = include('src/libraries/simpleHTML/SimpleHTML.js');
const { Sizes } = include('src/libraries/simpleUI/Constants.js');

const TextArea = () => {
  const textArea = document.createElement('textarea');

  Object.assign(textArea.style, {
    borderRadius: '5px',
    fontFamily: `"Courier New", Courier, monospace`,
    background: 'rgba(0, 0, 0, 0.05)',
    outline: 'none',
    fontSize: `${Sizes.FontSize}px`,
    padding: `${Sizes.Padding}px`,
    border: 'none',
    resize: 'none',
    width: '100%',
  });

  doAddInnerShadow(textArea);

  Object.defineProperty(textArea, 'widthUnits', {
    set: (widthUnits) => {
      textArea.style.maxWidth = `${widthUnits * Sizes.Unit}px`;
    },
  });
  Object.defineProperty(textArea, 'heightUnits', {
    set: (heightUnits) => {
      textArea.style.height = `${heightUnits * Sizes.Unit}px`;
    },
  });
  return textArea;
};

module.exports = TextArea;

  return module.exports;
})();

modules['src/libraries/simpleUI/PaddedContainer.js'] = (() => {
  const module = { exports: {} };
  const { doUpdateChildren } = include('src/libraries/simpleHTML/SimpleHTML.js');
const { Sizes } = include('src/libraries/simpleUI/Constants.js');

const PaddedContainer = () => {
  // Create base element
  const divElement = document.createElement('div');
  Object.assign(divElement.style, {
    padding: `${Sizes.Padding}px`,
    display: 'inline-block',
    width: '100%',
  });

  // Define setters
  Object.defineProperty(divElement, 'widthUnits', {
    set: (widthUnits) => {
      divElement.style.width = `${widthUnits * 20}px`;
    },
  });
  Object.defineProperty(divElement, 'children', {
    set: (children) => {
      doUpdateChildren(divElement, children);
    },
  });
  return divElement;
};

module.exports = PaddedContainer;

  return module.exports;
})();

modules['src/views/projects/projectPreviewContainer/ProjectPreviewContainer.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const ProjectPreviewContainer$ = withShadow(
  styled({
    color: 'dimgray',
    margin: '32px 32px 0 32px',
    height: '64px',
    background: 'white',
    lineHeight: '64px',
    fontSize: '16px',
  })(div$)
);

module.exports = ProjectPreviewContainer$;

  return module.exports;
})();

modules['src/views/projects/projectPreviewButton/ProjectPreviewButton.js'] = (() => {
  const module = { exports: {} };
  const { button$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const Observable = include('src/libraries/observable/Observable.js');
const { choose$ } = include('src/libraries/observable/utils.js');

const ProjectPreviewButton$ = (value$) => {
  const isHovered$ = new Observable(false);
  return button$(value$)
    .setStyle({
      color: choose$(isHovered$, 'darkslategray', 'slategray'),
      height: '64px',
      background: 'white',
      lineHeight: '64px',
      fontSize: '16px',
      width: '64px',
      textAlign: 'center',
      border: 'none',
      outline: 'none',
      cursor: 'pointer',
    })
    .onMouseEnter(() => (isHovered$.value = true))
    .onMouseLeave((element) => (isHovered$.value = false));
};

module.exports = ProjectPreviewButton$;

  return module.exports;
})();

modules['src/views/projects/projectPreview/ProjectPreview.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const ProjectPreviewContainer$ = include(
  'src/views/projects/projectPreviewContainer/ProjectPreviewContainer.js'
);
const ProjectPreviewButton$ = include(
  'src/views/projects/projectPreviewButton/ProjectPreviewButton.js'
);

const ProjectPreview$ = ({ viewModel, id$, name$ }) =>
  ProjectPreviewContainer$(
    styled({
      padding: '0 16px',
      width: 'calc(100% - 128px)',
      boxSizing: 'border-box',
      display: 'inline-block',
    })(div$)(name$).onClick(
      () =>
        (location.hash = `#!/projects/${id$.value}/${
          viewModel.lastVisitedProjectView$.value || ''
        }`)
    ),
    ProjectPreviewButton$('Delete').onClick(() =>
      viewModel.deleteProject(id$.value)
    ),
    ProjectPreviewButton$('Edit').onClick(() =>
      viewModel.editProjectName(id$.value)
    )
  );
module.exports = ProjectPreview$;

  return module.exports;
})();

modules['src/components/input/Input.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { input$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const Input$ = styled({
  color: 'darkslategray',
  background: 'ghostwhite',
  height: '100%',
  padding: '0 8px',
  lineHeight: '64px',
  fontSize: '16px',
  width: '100%',
  border: 'none',
})(input$);

module.exports = Input$;

  return module.exports;
})();

modules['src/views/projects/projectNameInputContainer/ProjectNameInputContainer.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { span$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const ProjectNameInputContainer$ = styled({
  // TODO: Make this one align nicely next to the input
  color: 'dimgray',
  height: '64px',
  padding: '8px',
  lineHeight: '64px',
  fontSize: '16px',
  width: 'calc(100% - 128px)',
  display: 'inline-block',
  boxSizing: 'border-box',
})(span$);

module.exports = ProjectNameInputContainer$;

  return module.exports;
})();

modules['src/views/projects/projectNameInput/ProjectNameInput.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { input$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const ProjectPreviewButton$ = include(
  'src/views/projects/projectPreviewButton/ProjectPreviewButton.js'
);
const ProjectPreviewContainer$ = include(
  'src/views/projects/projectPreviewContainer/ProjectPreviewContainer.js'
);
const Input$ = include('src/components/input/Input.js');
const ProjectNameInputContainer$ = include(
  'src/views/projects/projectNameInputContainer/ProjectNameInputContainer.js'
);

const ProjectNameInput$ = ({ viewModel, id$, nameInputValue$ }) =>
  ProjectPreviewContainer$(
    ProjectNameInputContainer$(
      Input$(nameInputValue$).onInput(({ value }) => {
        viewModel.setProjectNameInputValue(id$.value, value);
      })
    ),
    ProjectPreviewButton$('Cancel').onClick(() =>
      viewModel.cancelEditingProjectName(id$.value)
    ),
    ProjectPreviewButton$('Save').onClick(() =>
      viewModel.saveProjectName(id$.value)
    )
  );

module.exports = ProjectNameInput$;

  return module.exports;
})();

modules['src/views/projects/Projects.js'] = (() => {
  const module = { exports: {} };
  const { Choose$, If$ } = include('src/libraries/observableHtml/utils.js');
const { div$, input$ } = include(
  'src/libraries/observableHtml/ObservableHtml.js'
);
const { not$, or$, map$, startsWith$, choose$ } = include(
  'src/libraries/observable/utils.js'
);
const ProjectPreview$ = include(
  'src/views/projects/projectPreview/ProjectPreview.js'
);
const ProjectNameInput$ = include(
  'src/views/projects/projectNameInput/ProjectNameInput.js'
);
const NewProject$ = include('src/views/projects/newProject/NewProject.js');

const Projects$ = ({ viewModel }) => {
  return div$(
    ...viewModel.projects.map(
      ({ id$, name$, nameInputValue$, isEditing$, isEmpty$ }) => [
        ProjectNameInput$({ viewModel, id$, nameInputValue$ }).setStyle({
          display: choose$(or$(isEmpty$, not$(isEditing$)), 'none', 'block'),
        }),
        ProjectPreview$({ viewModel, id$, name$ }).setStyle({
          display: choose$(or$(isEmpty$, isEditing$), 'none', 'block'),
        }),
      ]
    ),
    NewProject$({ viewModel })
  );
};

module.exports = Projects$;

  return module.exports;
})();

modules['src/views/dataSources/apiInputLabel/ApiInputLabel.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { span$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const ApiInputLabel$ = styled({
  // TODO: Make this one align nicely next to the input
  color: 'dimgray',
  height: '64px',
  padding: '0 16px',
  lineHeight: '64px',
  fontSize: '16px',
  width: '192px',
  border: 'none',
  outline: 'none',
  display: 'inline-block',
  boxSizing: 'border-box',
})(span$);

module.exports = ApiInputLabel$;

  return module.exports;
})();

modules['src/views/dataSources/apiInputContainer/ApiInputContainer.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { span$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const ApiInputContainer$ = styled({
  // TODO: Make this one align nicely next to the input
  color: 'dimgray',
  height: '64px',
  padding: '8px',
  lineHeight: '64px',
  fontSize: '16px',
  width: 'calc(100% - 192px)',
  display: 'inline-block',
  boxSizing: 'border-box',
})(span$);

module.exports = ApiInputContainer$;

  return module.exports;
})();

modules['src/views/dataSources/apiIntervalInput/ApiIntervalInput.js'] = (() => {
  const module = { exports: {} };
  const ProjectPreviewContainer$ = include(
  'src/views/projects/projectPreviewContainer/ProjectPreviewContainer.js'
);
const ApiInputLabel$ = include(
  'src/views/dataSources/apiInputLabel/ApiInputLabel.js'
);
const Input$ = include('src/components/input/Input.js');
const ApiInputContainer$ = include(
  'src/views/dataSources/apiInputContainer/ApiInputContainer.js'
);

const ApiIntervalInput$ = ({ viewModel }) =>
  ProjectPreviewContainer$(
    ApiInputLabel$('Fetch interval (s)'),
    ApiInputContainer$(
      Input$(viewModel.selectedApiInterval$)
        .setProps({ type: 'number', min: '0' })
        .onInput(({ value }) => {
          viewModel.updateApiInterval(
            viewModel.selectedProjectId$.value,
            value
          );
        })
    )
  );

module.exports = ApiIntervalInput$;

  return module.exports;
})();

modules['src/components/fullWidthCard/FullWidthCard.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const FullWidthCard$ = withShadow(
  styled({
    color: 'dimgray',
    margin: '32px 32px 0 32px',
    background: 'white',
    lineHeight: '64px',
    fontSize: '16px',
  })(div$)
);

module.exports = FullWidthCard$;

  return module.exports;
})();

modules['src/components/textButton/TextButton.js'] = (() => {
  const module = { exports: {} };
  const { button$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const Observable = include('src/libraries/observable/Observable.js');
const { choose$ } = include('src/libraries/observable/utils.js');

const TextButton$ = (value$) => {
  const isHovered$ = new Observable(false);
  return button$(value$)
    .setStyle({
      color: choose$(isHovered$, 'darkslategray', 'slategray'),
      height: '64px',
      background: 'white',
      lineHeight: '64px',
      fontSize: '16px',
      width: '100%',
      textAlign: 'center',
      border: 'none',
      outline: 'none',
      cursor: 'pointer',
      padding: '0 16px',
    })
    .onMouseEnter(() => (isHovered$.value = true))
    .onMouseLeave(() => (isHovered$.value = false));
};

module.exports = TextButton$;

  return module.exports;
})();

modules['src/views/dataSources/apiUrlTestPreview/ApiUrlTestPreview.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const ApiUrlTestPreview$ = styled({
  color: 'lightslategray',
  background: 'ghostwhite',
  lineHeight: '32px',
  fontSize: '0 16px',
  width: '100%',
  margin: '8px',
  padding: '8px',
  display: 'inline-block',
  boxSizing: 'border-box',
  fontFamily: '"Courier New", Courier, monospace',
  whiteSpace: 'pre-wrap',
  maxHeight: '448px',
  minHeight: '48px',
  overflow: 'auto',
})(div$);

module.exports = ApiUrlTestPreview$;

  return module.exports;
})();

modules['src/views/dataSources/apiUrlInput/ApiUrlInput.js'] = (() => {
  const module = { exports: {} };
  const FullWidthCard$ = include('src/components/fullWidthCard/FullWidthCard.js');
const ApiInputLabel$ = include(
  'src/views/dataSources/apiInputLabel/ApiInputLabel.js'
);
const Input$ = include('src/components/input/Input.js');
const ApiInputContainer$ = include(
  'src/views/dataSources/apiInputContainer/ApiInputContainer.js'
);
const TextButton$ = include('src/components/textButton/TextButton.js');
const ApiUrlTestPreview$ = include(
  'src/views/dataSources/apiUrlTestPreview/ApiUrlTestPreview.js'
);
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const ApiUrlInput$ = ({ viewModel }) =>
  FullWidthCard$(
    div$(
      ApiInputLabel$('API URL'),
      ApiInputContainer$(
        Input$(viewModel.selectedApiUrl$).onInput(({ value }) => {
          viewModel.updateApiUrl(viewModel.selectedProjectId$.value, value);
        })
      ),
      TextButton$('Test API URL')
        .setStyle({
          textAlign: 'left',
          width: '192px',
          height: '64px',
          float: 'left',
        })
        .onClick(viewModel.testApiUrlInput),
      ApiUrlTestPreview$(viewModel.selectedApiUrlTestPreview$).setStyle({
        width: 'calc(100% - 208px)',
      })
    ).setStyle({ minHeight: '128px' })
  );

module.exports = ApiUrlInput$;

  return module.exports;
})();

modules['src/views/dataSources/DataSources.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const ApiIntervalInput$ = include(
  'src/views/dataSources/apiIntervalInput/ApiIntervalInput.js'
);
const ApiUrlInput$ = include(
  'src/views/dataSources/apiUrlInput/ApiUrlInput.js'
);

const DataSourcesView$ = ({ viewModel }) =>
  div$(ApiUrlInput$({ viewModel }), ApiIntervalInput$({ viewModel }));

module.exports = DataSourcesView$;

  return module.exports;
})();

modules['src/components/widgetCard/WidgetCard.js'] = (() => {
  const module = { exports: {} };
  const styled = include('src/libraries/styled/styled.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { add$ } = include('src/libraries/observable/utils.js');

const WidgetCard$ = ({ width$, height$ }) =>
  styled({
    margin: '32px 0 0 32px',
    width: add$(width$, 'px'),
    height: add$(height$, 'px'),
    display: 'inline-block',
    verticalAlign: 'top',
    background: 'white',
  })(div$);

module.exports = WidgetCard$;

  return module.exports;
})();

modules['src/components/widgetLabel/WidgetLabel.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');

const WidgetLabel$ = ({ label$ }) =>
  div$(label$).setStyle({
    fontSize: '20px',
    marginTop: '20px',
    textAlign: 'center',
    position: 'absolute',
    width: '100%',
    pointerEvents: 'none',
    userSelect: 'none',
  });

module.exports = WidgetLabel$;

  return module.exports;
})();

modules['src/components/widgetValue/WidgetValue.js'] = (() => {
  const module = { exports: {} };
  const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { Number$, toFixed$ } = include('src/libraries/observable/utils.js');

const WidgetValue$ = ({ value$ }) =>
  div$(toFixed$(Number$(value$), 2)).setStyle({
    fontSize: '60px',
    textAlign: 'center',
    width: '100%',
    position: 'absolute',
    top: '50%',
    transform: 'translate(0, -50%)',
  });

module.exports = WidgetValue$;

  return module.exports;
})();

modules['src/components/valueWidget/ValueWidget.js'] = (() => {
  const module = { exports: {} };
  const WidgetLabel$ = include('src/components/widgetLabel/WidgetLabel.js');
const WidgetValue$ = include('src/components/widgetValue/WidgetValue.js');
const WidgetCard$ = include('src/components/widgetCard/WidgetCard.js');
const { not$ } = include('src/libraries/observable/utils.js');
const { If$ } = include('src/libraries/observableHtml/utils.js');
const withShadow = include('src/styleWrappers/withShadow.js');

const ValueWidget$ = ({ label$, value$ }) => {
  If$(
    not$(isEmpty$),
    // Height + margin = 5 x navigator buttons
    // Width + margin = 7.5 x navigator buttons
    withShadow(WidgetCard$({ height$: 288, width$: 448 }))(
      WidgetLabel$({ label$ }),
      WidgetValue$({ value$ })
    ).setStyle({ position: 'relative', color: 'dimgray' })
  );
};

module.exports = ValueWidget$;

  return module.exports;
})();

modules['src/components/widget/WidgetContainer.js'] = (() => {
  const module = { exports: {} };
  const Container = include('src/libraries/simpleUI/Container.js');

const WidgetContainer = () => {
  const widgetContainer = Container();
  Object.assign(widgetContainer.style, {
    display: 'inline-block',
    verticalAlign: 'top',
    background: 'white',
  });
  return widgetContainer;
};

module.exports = WidgetContainer;

  return module.exports;
})();

modules['src/components/widget/valueWidget/ValueWidget.js'] = (() => {
  const module = { exports: {} };
  const WidgetLabel$ = include('src/components/widgetLabel/WidgetLabel.js');
const WidgetValue$ = include('src/components/widgetValue/WidgetValue.js');
const Observable = include('src/libraries/observable/Observable.js');
const Container = include('src/libraries/simpleUI/Container.js');

const ValueWidget = () => {
  const valueContainer = Container();
  Object.assign(valueContainer.style, {
    position: 'relative',
    color: 'dimgray',
    // 24 x SizeUnit
    width: '480px',
    // 16 x SizeUnit
    height: '320px',
  });
  const label$ = new Observable('');
  const value$ = new Observable('');

  Object.defineProperty(valueContainer, 'widgetDescription', {
    set: ({ label, value }) => {
      label$.value = label;
      value$.value = value;
    },
  });

  valueContainer.children = [
    WidgetLabel$({ label$ }),
    WidgetValue$({ value$ }),
  ];
  return valueContainer;
};

module.exports = ValueWidget;

  return module.exports;
})();

modules['src/components/visualization/threeDimVisualization/camera/Camera.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');

const Camera = function({
  target = new Observable([0, 0, 0]),
  horizontalRotation$ = new Observable(0),
  verticalRotation$ = new Observable(0),
  distance$ = new Observabe(100),
  focalLength$ = new Observable(100),
}) {
  this.target = target;
  this.horizontalRotation$ = horizontalRotation$;
  this.verticalRotation$ = new Observable(
    Math.max(Math.min(verticalRotation$.value, Math.PI / 4), -Math.PI / 2)
  );
  this.distance$ = new Observable(
    Math.max(distance$.value, -focalLength$.value / 2)
  );
  this.focalLength$ = focalLength$;
  this.setDistance = distance => {
    this.distance$.value = Math.max(distance, -focalLength$.value / 2);
  };
  this.setVerticalRotation = verticalRotation => {
    this.verticalRotation$.value = Math.max(
      Math.min(verticalRotation, Math.PI / 2),
      -Math.PI / 2
    );
  };
};

module.exports = Camera;

  return module.exports;
})();

modules['src/components/visualization/render/toCenterOfWidget/toCenterOfWidget.js'] = (() => {
  const module = { exports: {} };
  const toCenterOfWidget = ([x, y, z], ctx) => [
  x + ctx.canvas.width / 2,
  y - ctx.canvas.height / 2,
  z,
];

module.exports = toCenterOfWidget;

  return module.exports;
})();

modules['src/components/visualization/render/toPerspective/toPerspective.js'] = (() => {
  const module = { exports: {} };
  const toPerspective = ([x, y, z], d, focalLength) =>
  focalLength
    ? [
        x * (focalLength / (d + focalLength + z)),
        y * (focalLength / (d + focalLength + z)),
        z,
      ]
    : [x, y, z];

module.exports = toPerspective;

  return module.exports;
})();

modules['src/components/visualization/render/toCenterOfStructure/toCenterOfStructure.js'] = (() => {
  const module = { exports: {} };
  const toCenterOfStructure = ([x, y, z], transformedCenterOfStructure) => [
  x - transformedCenterOfStructure[0],
  y - transformedCenterOfStructure[1],
  z - transformedCenterOfStructure[2],
];

module.exports = toCenterOfStructure;

  return module.exports;
})();

modules['src/components/visualization/render/rotate/rotate.js'] = (() => {
  const module = { exports: {} };
  const rotate = ([x, y, z], rx, ry) => {
  const theta = rx;
  const phi = ry;

  const horizontallyRotatedVertex = [
    x * Math.cos(theta) + z * Math.sin(theta),
    y,
    z * Math.cos(theta) - x * Math.sin(theta),
  ];

  return [
    horizontallyRotatedVertex[0],
    horizontallyRotatedVertex[1] * Math.cos(phi) -
      horizontallyRotatedVertex[2] * Math.sin(phi),
    horizontallyRotatedVertex[1] * Math.sin(phi) +
      horizontallyRotatedVertex[2] * Math.cos(phi),
  ];
};

module.exports = rotate;

  return module.exports;
})();

modules['src/components/visualization/render/render.js'] = (() => {
  const module = { exports: {} };
  const toCenterOfWidget = include(
  'src/components/visualization/render/toCenterOfWidget/toCenterOfWidget.js'
);
const toPerspective = include(
  'src/components/visualization/render/toPerspective/toPerspective.js'
);
const toCenterOfStructure = include(
  'src/components/visualization/render/toCenterOfStructure/toCenterOfStructure.js'
);
const rotate = include('src/components/visualization/render/rotate/rotate.js');

/**
 * @param {number} dx
 * Defines the x coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} dy
 * Defines the y coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} dz
 * Defines the z coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} d
 * Defines the distance from the defined center of the structure, to the
 * camera.
 */
const render = (
  surfaces$,
  edges$,
  ctx,
  center,
  rx = 0,
  ry = 0,
  d = 0,
  focalLength = 0
) => {
  // Render the faces
  surfaces$.value.forEach(({ color, points }) => {
    points
      .map((point) => toCenterOfStructure(point, center))
      .map((point) => rotate(point, rx, ry))
      .map((point) => toPerspective(point, d, focalLength))
      .map((point) => toCenterOfWidget(point, ctx))
      .forEach((point, index) => {
        if (index === 0) {
          ctx.beginPath();
          ctx.moveTo(point[0], -point[1]);
          return;
        }
        if (index < points.length - 1) {
          ctx.lineTo(point[0], -point[1]);
          return;
        }
        if (index === points.length - 1) {
          ctx.lineTo(point[0], -point[1]);
          ctx.closePath();
          ctx.fillStyle = color;
          ctx.fill();
          return;
        }
      });
  });

  // Render the edges
  edges$.value.forEach(({ color, points, width }) => {
    // Draw the first vertex
    const startPoint = toCenterOfWidget(
      toPerspective(
        rotate(toCenterOfStructure(points[0], center), rx, ry),
        d,
        focalLength
      ),

      ctx
    );
    const endPoint = toCenterOfWidget(
      toPerspective(
        rotate(toCenterOfStructure(points[1], center), rx, ry),
        d,
        focalLength
      ),
      ctx
    );
    ctx.beginPath();
    ctx.lineCap = 'round';
    ctx.moveTo(startPoint[0], -startPoint[1]);
    ctx.lineTo(endPoint[0], -endPoint[1]);
    ctx.lineWidth = width;
    ctx.strokeStyle = color;
    ctx.stroke();
  });
};

module.exports = render;

  return module.exports;
})();

modules['src/components/visualization/threeDimVisualization/ThreeDimVisualization.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const { canvas$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const Camera = include(
  'src/components/visualization/threeDimVisualization/camera/Camera.js'
);
const render = include('src/components/visualization/render/render.js');

const ThreeDimVisualization$ = ({
  height$,
  width$,
  surfaces$,
  edges$,
  center$,
}) => {
  const state = { mouseDown: false };
  const canvas = canvas$({ height$, width$ }).setStyle({
    position: 'absolute',
  });
  const camera = new Camera({
    target: center$,
    horizontalRotation$: new Observable(0),
    verticalRotation$: new Observable(0),
    distance$: new Observable(100),
    focalLength$: new Observable(100),
  });
  const ctx = canvas.getContext('2d');
  const rerender = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    render(
      surfaces$,
      edges$,
      ctx,
      camera.target.value,
      camera.horizontalRotation$.value,
      camera.verticalRotation$.value,
      camera.distance$.value,
      camera.focalLength$.value
    );
  };
  rerender();
  canvas.onwheel = (event) => {
    camera.setDistance(camera.distance$.value + event.deltaY / 5);
  };
  window.addEventListener('mousedown', (event) => {
    state.mouseDown = true;
  });
  window.addEventListener(
    'mouseup',
    (canvas.onmouseup = (event) => {
      state.mouseDown = false;
    })
  );
  canvas.onmousemove = (event) => {
    if (state.mouseDown) {
      camera.horizontalRotation$.value =
        camera.horizontalRotation$.value - event.movementX / 100;
      camera.setVerticalRotation(
        camera.verticalRotation$.value - event.movementY / 100
      );
    }
  };
  window.addEventListener(camera.horizontalRotation$.id, () => rerender());
  window.addEventListener(camera.verticalRotation$.id, () => rerender());
  window.addEventListener(camera.distance$.id, () => rerender());
  window.addEventListener(camera.focalLength$.id, () => rerender());
  window.addEventListener(surfaces$.id, () => rerender());
  window.addEventListener(edges$.id, () => rerender());
  window.addEventListener(center$.id, () => rerender());
  return canvas;
};

module.exports = ThreeDimVisualization$;

  return module.exports;
})();

modules['src/components/visualization/twoDimVisualization/TwoDimVisualization.js'] = (() => {
  const module = { exports: {} };
  const { canvas$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const render = include('src/components/visualization/render/render.js');

const TwoDimVisualization$ = ({
  height$,
  width$,
  surfaces$,
  edges$,
  center$,
}) => {
  const canvas = canvas$({ height$, width$ }).setStyle({
    position: 'absolute',
  });
  const ctx = canvas.getContext('2d');
  const rerender = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    render(surfaces$, edges$, ctx, center$.value);
  };
  rerender();
  window.addEventListener(surfaces$.id, () => rerender());
  window.addEventListener(edges$.id, () => rerender());
  window.addEventListener(center$.id, () => rerender());
  return canvas;
};

module.exports = TwoDimVisualization$;

  return module.exports;
})();

modules['src/components/canvasWidget/CanvasWidget.js'] = (() => {
  const module = { exports: {} };
  const WidgetCard$ = include('src/components/widgetCard/WidgetCard.js');
const ThreeDimVisualization$ = include(
  'src/components/visualization/threeDimVisualization/ThreeDimVisualization.js'
);
const TwoDimVisualization$ = include(
  'src/components/visualization/twoDimVisualization/TwoDimVisualization.js'
);
const WidgetLabel$ = include('src/components/widgetLabel/WidgetLabel.js');
const withShadow = include('src/styleWrappers/withShadow.js');
const { not$ } = include('src/libraries/observable/utils.js');
const { Choose$, If$ } = include('src/libraries/observableHtml/utils.js');

const CanvasWidget$ = ({
  label$,
  surfaces$,
  edges$,
  center$,
  is3d$,
  isEmpty$,
}) => {
  return If$(
    not$(isEmpty$),
    // Height + margin = 5 x navigator buttons
    // Width + margin = 7.5 x navigator buttons
    withShadow(WidgetCard$({ height$: 288, width$: 448 }))(
      Choose$(
        is3d$,
        ThreeDimVisualization$({
          height$: 288,
          width$: 448,
          surfaces$,
          edges$,
          center$,
        }),
        TwoDimVisualization$({
          height$: 288,
          width$: 448,
          surfaces$,
          edges$,
          center$,
        })
      ),
      WidgetLabel$({ label$ })
    ).setStyle({
      position: 'relative',
      color: 'dimgray',
    })
  );
};

module.exports = CanvasWidget$;

  return module.exports;
})();

modules['src/components/widget/doRenderVisualization/doRenderVisualization.js'] = (() => {
  const module = { exports: {} };
  const toCenterOfWidget = include(
  'src/components/visualization/render/toCenterOfWidget/toCenterOfWidget.js'
);
const toPerspective = include(
  'src/components/visualization/render/toPerspective/toPerspective.js'
);
const toCenterOfStructure = include(
  'src/components/visualization/render/toCenterOfStructure/toCenterOfStructure.js'
);
const rotate = include('src/components/visualization/render/rotate/rotate.js');

/**
 * @param {number} dx
 * Defines the x coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} dy
 * Defines the y coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} dz
 * Defines the z coordinate which will be displayed in the center of the
 * visualization
 *
 * @param {number} d
 * Defines the distance from the defined center of the structure, to the
 * camera.
 */
const doRenderVisualization = ({
  surfaces,
  edges,
  ctx,
  center,
  rx = 0,
  ry = 0,
  d = 0,
  focalLength = 0,
}) => {
  // Render the faces
  surfaces.forEach(({ color, points }) => {
    points
      .map((point) => toCenterOfStructure(point, center))
      .map((point) => rotate(point, rx, ry))
      .map((point) => toPerspective(point, d, focalLength))
      .map((point) => toCenterOfWidget(point, ctx))
      .forEach((point, index) => {
        if (index === 0) {
          ctx.beginPath();
          ctx.moveTo(point[0], -point[1]);
          return;
        }
        if (index < points.length - 1) {
          ctx.lineTo(point[0], -point[1]);
          return;
        }
        if (index === points.length - 1) {
          ctx.lineTo(point[0], -point[1]);
          ctx.closePath();
          ctx.fillStyle = color;
          ctx.fill();
          return;
        }
      });
  });

  // Render the edges
  edges.forEach(({ color, points, width }) => {
    // Draw the first vertex
    const startPoint = toCenterOfWidget(
      toPerspective(
        rotate(toCenterOfStructure(points[0], center), rx, ry),
        d,
        focalLength
      ),

      ctx
    );
    const endPoint = toCenterOfWidget(
      toPerspective(
        rotate(toCenterOfStructure(points[1], center), rx, ry),
        d,
        focalLength
      ),
      ctx
    );
    ctx.beginPath();
    ctx.lineCap = 'round';
    ctx.moveTo(startPoint[0], -startPoint[1]);
    ctx.lineTo(endPoint[0], -endPoint[1]);
    ctx.lineWidth = width;
    ctx.strokeStyle = color;
    ctx.stroke();
  });
};

module.exports = doRenderVisualization;

  return module.exports;
})();

modules['src/components/widget/canvas3dWidget/Canvas3dWidget.js'] = (() => {
  const module = { exports: {} };
  const Observable = include('src/libraries/observable/Observable.js');
const Camera = include(
  'src/components/visualization/threeDimVisualization/camera/Camera.js'
);
const doRenderVisualization = include(
  'src/components/widget/doRenderVisualization/doRenderVisualization.js'
);

const ThreeDimVisualization$ = () => {
  const state = { mouseDown: false };
  const canvasElement = document.createElement('canvas');
  // 16 x SizeUnit
  canvasElement.height = 320;
  // 24 x SizeUnit
  canvasElement.width = 480;
  Object.assign(canvasElement.style, {
    position: 'absolute',
  });
  const camera = new Camera({
    horizontalRotation$: new Observable(0),
    verticalRotation$: new Observable(0),
    distance$: new Observable(100),
    focalLength$: new Observable(100),
  });
  const ctx = canvasElement.getContext('2d');
  const rerender = ({ surfaces, edges, center }) => {
    ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);
    doRenderVisualization({
      surfaces,
      edges,
      ctx,
      center,
      rx: camera.horizontalRotation$.value,
      ry: camera.verticalRotation$.value,
      d: camera.distance$.value,
      focalLength: camera.focalLength$.value,
    });
  };
  canvasElement.onwheel = (event) => {
    camera.setDistance(camera.distance$.value + event.deltaY / 5);
  };
  window.addEventListener('mousedown', (event) => {
    state.mouseDown = true;
  });
  window.addEventListener(
    'mouseup',
    (canvasElement.onmouseup = (event) => {
      state.mouseDown = false;
    })
  );
  canvasElement.onmousemove = (event) => {
    if (state.mouseDown) {
      camera.horizontalRotation$.value =
        camera.horizontalRotation$.value - event.movementX / 100;
      camera.setVerticalRotation(
        camera.verticalRotation$.value - event.movementY / 100
      );
    }
  };
  Object.defineProperty(canvasElement, 'widgetDescription', {
    set: ({ surfaces, edges, center }) => {
      Object.assign(canvasElement, {
        _surfaces: surfaces,
        _edges: edges,
        _center: center,
      });
      rerender({ surfaces, edges, center });
    },
  });
  window.addEventListener(camera.horizontalRotation$.id, () =>
    rerender({
      surfaces: canvasElement._surfaces,
      edges: canvasElement._edges,
      center: canvasElement._center,
    })
  );
  window.addEventListener(camera.verticalRotation$.id, () =>
    rerender({
      surfaces: canvasElement._surfaces,
      edges: canvasElement._edges,
      center: canvasElement._center,
    })
  );
  window.addEventListener(camera.distance$.id, () =>
    rerender({
      surfaces: canvasElement._surfaces,
      edges: canvasElement._edges,
      center: canvasElement._center,
    })
  );
  window.addEventListener(camera.focalLength$.id, () =>
    rerender({
      surfaces: canvasElement._surfaces,
      edges: canvasElement._edges,
      center: canvasElement._center,
    })
  );
  return canvasElement;
};

module.exports = ThreeDimVisualization$;

  return module.exports;
})();

modules['src/components/widget/canvas2dWidget/Canvas2dWidget.js'] = (() => {
  const module = { exports: {} };
  const doRenderVisualization = include(
  'src/components/widget/doRenderVisualization/doRenderVisualization.js'
);

const TwoDimVisualization$ = () => {
  const canvasElement = document.createElement('canvas');
  Object.assign(canvasElement, {
    // 16 x SizeUnit
    height: 320,
    // 24 x SizeUnit
    width: 480,
  });
  canvasElement.position = 'absolute';
  const ctx = canvasElement.getContext('2d');
  const rerender = ({ surfaces, edges, center }) => {
    ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);
    doRenderVisualization({ surfaces, edges, center, ctx });
  };
  Object.defineProperty(canvasElement, 'widgetDescription', {
    set: ({ surfaces, edges, center }) => {
      rerender({ surfaces, edges, center });
    },
  });
  return canvasElement;
};

module.exports = TwoDimVisualization$;

  return module.exports;
})();

modules['src/components/widget/Widget.js'] = (() => {
  const module = { exports: {} };
  const WidgetContainer = include('src/components/widget/WidgetContainer.js');
const Canvas3dWidget = include(
  'src/components/widget/canvas3dWidget/Canvas3dWidget.js'
);
const Canvas2dWidget = include(
  'src/components/widget/canvas2dWidget/Canvas2dWidget.js'
);
const ValueWidget = include('src/components/widget/valueWidget/ValueWidget.js');
const { doUpdateChildren } = include('src/libraries/simpleHTML/SimpleHTML.js');

const Widget = () => {
  const widgetContainer = document.createElement('span');
  Object.assign(widgetContainer.style, {
    display: 'inline-block',
    verticalAlign: 'top',
    background: 'white',
    // 24 x SizeUnit
    width: '480px',
    // 16 x SizeUnit
    height: '320px',
  });

  Object.defineProperty(widgetContainer, 'widgetDescription', {
    set: (widgetDescription) => {
      if (
        widgetDescription.type === 'canvas-widget' &&
        widgetDescription.is3d
      ) {
        const canvas3dWidget = Canvas3dWidget();
        canvas3dWidget.widgetDescription = widgetDescription;
        doUpdateChildren(widgetContainer, [canvas3dWidget]);
      }
      if (
        widgetDescription.type === 'canvas-widget' &&
        !widgetDescription.is3d
      ) {
        const canvas2dWidget = Canvas2dWidget();
        canvas2dWidget.widgetDescription = widgetDescription;
        doUpdateChildren(widgetContainer, [canvas2dWidget]);
      }
      if (widgetDescription.type === 'value-widget') {
        const valueWidget = ValueWidget();
        valueWidget.widgetDescription = widgetDescription;
        doUpdateChildren(widgetContainer, [valueWidget]);
      }
    },
  });
  return widgetContainer;
};

module.exports = Widget;

  return module.exports;
})();

modules['src/views/dashboard/Dashboard.js'] = (() => {
  const module = { exports: {} };
  const CanvasWidget$ = include('src/components/canvasWidget/CanvasWidget.js');
const ValueWidget$ = include('src/components/valueWidget/ValueWidget.js');
const { eq$ } = include('src/libraries/observable/utils.js');
const { Choose$ } = include('src/libraries/observableHtml/utils.js');
const TextArea = include('src/libraries/simpleUI/TextArea.js');
const { doUpdateChildren } = include('src/libraries/simpleHTML/SimpleHTML.js');
const PaddedContainer = include('src/libraries/simpleUI/PaddedContainer.js');
const Container = include('src/libraries/simpleUI/Container.js');
const Widget = include('src/components/widget/Widget.js');
const { doAddShadow } = include('src/libraries/simpleHTML/SimpleHTML.js');

const Dashboard$ = ({ viewModel, currentRoute$ }) => {
  const { isExported } = viewModel;
  const codeEditorIsOpen$ = eq$(
    currentRoute$,
    '/projects/<projectId:string>/dashboard/edit'
  );
  const codeEditor = Object.assign(TextArea(), {
    value: viewModel.selectedWidgetsCode$.value,
    heightUnits: 15,
  });

  codeEditor.addEventListener('input', ({ target }) => {
    viewModel.updateWidgetsCode(
      viewModel.selectedProjectId$.value,
      target.value
    );
  });

  const codeEditorContainer = Object.assign(PaddedContainer(), {
    children: [codeEditor],
  });

  const widgetsContainer = Container();

  const updateWidgets = () => {
    const widgets = [
      ...viewModel.widgets
        .filter(({ isEmpty$ }) => !isEmpty$.value)
        .map(
          ({
            label$,
            type$,
            value$,
            surfaces$,
            edges$,
            is3d$,
            center$,
            isEmpty$,
          }) => {
            const widget = Widget();
            doAddShadow(widget);
            const paddedContainer = document.createElement('span');
            paddedContainer.appendChild(widget);
            Object.assign(paddedContainer.style, {
              padding: '10px',
              display: 'inline-block',
            });
            widget.widgetDescription = {
              type: type$.value,
              label: label$.value,
              value: value$.value,
              surfaces: surfaces$.value,
              edges: edges$.value,
              is3d: is3d$.value,
              center: center$.value,
              isEmpty: isEmpty$.value,
            };
            return paddedContainer;
          }
        ),
    ];
    Object.assign(widgetsContainer, {
      children: [...widgets],
    });
  };

  // This should replaced with a single setter
  viewModel.widgets.forEach(
    ({
      label$,
      type$,
      value$,
      surfaces$,
      edges$,
      is3d$,
      center$,
      isEmpty$,
    }) => {
      addEventListener(type$.id, updateWidgets);
      addEventListener(label$.id, updateWidgets);
      addEventListener(value$.id, updateWidgets);
      addEventListener(surfaces$.id, updateWidgets);
      addEventListener(edges$.id, updateWidgets);
      addEventListener(is3d$.id, updateWidgets);
      addEventListener(center$.id, updateWidgets);
      addEventListener(isEmpty$.id, updateWidgets);
    }
  );

  const getDashboardChildren = () =>
    codeEditorIsOpen$.value && !isExported
      ? [codeEditorContainer, widgetsContainer]
      : [widgetsContainer];

  const dashboardContainer = Object.assign(PaddedContainer(), {
    children: getDashboardChildren(),
  });

  addEventListener(codeEditorIsOpen$.id, () => {
    doUpdateChildren(dashboardContainer, getDashboardChildren());
  });
  addEventListener(viewModel.selectedWidgetsCode$.id, () => {
    codeEditor.value = viewModel.selectedWidgetsCode$.value;
  });

  return dashboardContainer;
};

module.exports = Dashboard$;

  return module.exports;
})();

modules['src/app/App.js'] = (() => {
  const module = { exports: {} };
  const { eq$, or$, startsWith$ } = include('src/libraries/observable/utils.js');
const { div$ } = include('src/libraries/observableHtml/ObservableHtml.js');
const { If$ } = include('src/libraries/observableHtml/utils.js');
const ProjectNavigator$ = include(
  'src/views/project/projectNavigator/ProjectNavigator.js'
);
const ProjectContainer$ = include(
  'src/views/project/projectContainer/ProjectContainer.js'
);
const TitleBar$ = include('src/app/titleBar/TitleBar.js');
const Projects$ = include('src/views/projects/Projects.js');
const DataSources$ = include('src/views/dataSources/DataSources.js');
const Dashboard$ = include('src/views/dashboard/Dashboard.js');

const App = ({ currentRoute$, viewModel }) => {
  return viewModel.isExported
    ? div$(
        TitleBar$({ currentRoute$, viewModel }),
        ProjectContainer$(Dashboard$({ viewModel, currentRoute$ }))
      )
    : div$(
        TitleBar$({ currentRoute$, viewModel }),
        If$(eq$(currentRoute$, '/'), Projects$({ viewModel })),
        If$(
          startsWith$(currentRoute$, '/projects/<projectId:string>'),
          ProjectContainer$(
            ProjectNavigator$({ currentRoute$, viewModel }),
            If$(
              or$(
                eq$(currentRoute$, '/projects/<projectId:string>/data-sources'),
                eq$(currentRoute$, '/projects/<projectId:string>')
              ),
              DataSources$({ viewModel })
            ),
            /*If$(
              startsWith$(currentRoute$, '/projects/<projectId:string>/values'),
              Values$({ viewModel, currentRoute$ })
            ),*/
            If$(
              startsWith$(
                currentRoute$,
                '/projects/<projectId:string>/dashboard'
              ),
              Dashboard$({ viewModel, currentRoute$ })
            )
          )
        )
      );
};

module.exports = App;

  return module.exports;
})();

window.addEventListener('load', () => {
const Router = include('src/libraries/router/Router.js');
const Model = include('src/model/Model.js');
const App = include('src/app/App.js');

Object.assign(document.body.style, {
  margin: 0,
  fontFamily: 'sans-serif',
  background: 'GhostWhite',
  height: '100%',
});
//const FIREBASE_API_KEY = 'AIzaSyCeGXLqw0MEwiSFHG1Wks1HfQHXRZoOuFY';

const isExported = false;

// Create router
const router = isExported
  ? new Router({
      '/': 'Dashboard',
      '/values': 'Values',
      '/dashboard': 'Dashboard',
    })
  : new Router({
      '/': 'Projects',
      '/projects/<projectId:string>': 'Data sources',
      '/projects/<projectId:string>/data-sources': 'Data sources',
      '/projects/<projectId:string>/values': 'Values',
      '/projects/<projectId:string>/values/edit': 'Edit values',
      '/projects/<projectId:string>/dashboard': 'Dashboard',
      '/projects/<projectId:string>/dashboard/edit': 'Edit dashboard',
    });

const viewModel = Model({ router, isExported });

document.body.appendChild(
  App({
    viewModel,
    params: router.getParams,
    currentRoute$: router.currentRoute$,
  })
);
document.body.update = (props) =>
  document.body.childNodes.forEach((childNode) => {
    if (typeof childNode.update === 'function') {
      childNode.update(props);
    }
  });

router.subscribe(() => document.body.update());

})
</script>